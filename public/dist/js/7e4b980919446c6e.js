"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7614],{5714:(s,t,i)=>{i.d(t,{ZP:()=>w,l0:()=>y});var e=i(9669),n=i.n(e),o=Object.defineProperty,r=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.propertyIsEnumerable,c=(s,t,i)=>t in s?o(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,d=(s,t)=>{for(var i in t||(t={}))r.call(t,i)&&c(s,i,t[i]);if(a)for(var i of a(t))l.call(t,i)&&c(s,i,t[i]);return s};const u=s=>void 0===s,v=s=>Array.isArray(s),p=s=>s&&"number"==typeof s.size&&"string"==typeof s.type&&"function"==typeof s.slice,m=(s,t,i,e)=>((t=t||{}).indices=!u(t.indices)&&t.indices,t.nullsAsUndefineds=!u(t.nullsAsUndefineds)&&t.nullsAsUndefineds,t.booleansAsIntegers=!u(t.booleansAsIntegers)&&t.booleansAsIntegers,t.allowEmptyArrays=!u(t.allowEmptyArrays)&&t.allowEmptyArrays,i=i||new FormData,u(s)||(null===s?t.nullsAsUndefineds||i.append(e,""):(s=>"boolean"==typeof s)(s)?t.booleansAsIntegers?i.append(e,s?1:0):i.append(e,s):v(s)?s.length?s.forEach(((s,n)=>{const o=e+"["+(t.indices?n:"")+"]";m(s,t,i,o)})):t.allowEmptyArrays&&i.append(e+"[]",""):(s=>s instanceof Date)(s)?i.append(e,s.toISOString()):!(s=>s===Object(s))(s)||(s=>p(s)&&"string"==typeof s.name&&("object"==typeof s.lastModifiedDate||"number"==typeof s.lastModified))(s)||p(s)?i.append(e,s):Object.keys(s).forEach((n=>{const o=s[n];if(v(o))for(;n.length>2&&n.lastIndexOf("[]")===n.length-2;)n=n.substring(0,n.length-2);m(o,t,i,e?e+"["+n+"]":n)}))),i);var _={serialize:m};function f(s){if(null===s||"object"!=typeof s)return s;const t=Array.isArray(s)?[]:{};return Object.keys(s).forEach((i=>{t[i]=f(s[i])})),t}function h(s){return Array.isArray(s)?s:[s]}function b(s){return s instanceof File||s instanceof Blob||s instanceof FileList||"object"==typeof s&&null!==s&&void 0!==Object.values(s).find((s=>b(s)))}class g{constructor(){this.errors={},this.errors={}}set(s,t){"object"==typeof s?this.errors=s:this.set(d(d({},this.errors),{[s]:h(t)}))}all(){return this.errors}has(s){return Object.prototype.hasOwnProperty.call(this.errors,s)}hasAny(...s){return s.some((s=>this.has(s)))}any(){return Object.keys(this.errors).length>0}get(s){if(this.has(s))return this.getAll(s)[0]}getAll(s){return h(this.errors[s]||[])}only(...s){const t=[];return s.forEach((s=>{const i=this.get(s);i&&t.push(i)})),t}flatten(){return Object.values(this.errors).reduce(((s,t)=>s.concat(t)),[])}clear(s){const t={};s&&Object.keys(this.errors).forEach((i=>{i!==s&&(t[i]=this.errors[i])})),this.set(t)}}class y{constructor(s={}){this.originalData={},this.busy=!1,this.successful=!1,this.recentlySuccessful=!1,this.recentlySuccessfulTimeoutId=void 0,this.errors=new g,this.progress=void 0,this.update(s)}static make(s){return new this(s)}update(s){this.originalData=Object.assign({},this.originalData,f(s)),Object.assign(this,s)}fill(s={}){this.keys().forEach((t=>{this[t]=s[t]}))}data(){return this.keys().reduce(((s,t)=>d(d({},s),{[t]:this[t]})),{})}keys(){return Object.keys(this).filter((s=>!y.ignore.includes(s)))}startProcessing(){this.errors.clear(),this.busy=!0,this.successful=!1,this.progress=void 0,this.recentlySuccessful=!1,clearTimeout(this.recentlySuccessfulTimeoutId)}finishProcessing(){this.busy=!1,this.successful=!0,this.progress=void 0,this.recentlySuccessful=!0,this.recentlySuccessfulTimeoutId=setTimeout((()=>{this.recentlySuccessful=!1}),y.recentlySuccessfulTimeout)}clear(){this.errors.clear(),this.successful=!1,this.recentlySuccessful=!1,this.progress=void 0,clearTimeout(this.recentlySuccessfulTimeoutId)}reset(){Object.keys(this).filter((s=>!y.ignore.includes(s))).forEach((s=>{this[s]=f(this.originalData[s])}))}get(s,t={}){return this.submit("get",s,t)}post(s,t={}){return this.submit("post",s,t)}patch(s,t={}){return this.submit("patch",s,t)}put(s,t={}){return this.submit("put",s,t)}delete(s,t={}){return this.submit("delete",s,t)}submit(s,t,i={}){return this.startProcessing(),i=d({data:{},params:{},url:this.route(t),method:s,onUploadProgress:this.handleUploadProgress.bind(this)},i),"get"===s.toLowerCase()?i.params=d(d({},this.data()),i.params):(i.data=d(d({},this.data()),i.data),b(i.data)&&!i.transformRequest&&(i.transformRequest=[s=>_.serialize(s)])),new Promise(((s,t)=>{(y.axios||n()).request(i).then((t=>{this.finishProcessing(),s(t)})).catch((s=>{this.handleErrors(s),t(s)}))}))}handleErrors(s){this.busy=!1,this.progress=void 0,s.response&&this.errors.set(this.extractErrors(s.response))}extractErrors(s){return s.data&&"object"==typeof s.data?s.data.errors?d({},s.data.errors):s.data.message?{error:s.data.message}:d({},s.data):{error:y.errorMessage}}handleUploadProgress(s){this.progress={total:s.total,loaded:s.loaded,percentage:Math.round(100*s.loaded/s.total)}}route(s,t={}){let i=s;return Object.prototype.hasOwnProperty.call(y.routes,s)&&(i=decodeURI(y.routes[s])),"object"!=typeof t&&(t={id:t}),Object.keys(t).forEach((s=>{i=i.replace(`{${s}}`,t[s])})),i}onKeydown(s){const t=s.target;t.name&&this.errors.clear(t.name)}}y.routes={},y.errorMessage="Something went wrong. Please try again.",y.recentlySuccessfulTimeout=2e3,y.ignore=["busy","successful","errors","progress","originalData","recentlySuccessful","recentlySuccessfulTimeoutId"];const w=y},7614:(s,t,i)=>{i.r(t),i.d(t,{default:()=>u});var e=i(2097),n=i(629),o=i(2661),r=i(5714);function a(s){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},a(s)}function l(s,t){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(s);t&&(e=e.filter((function(t){return Object.getOwnPropertyDescriptor(s,t).enumerable}))),i.push.apply(i,e)}return i}function c(s,t,i){return(t=function(s){var t=function(s,t){if("object"!==a(s)||null===s)return s;var i=s[Symbol.toPrimitive];if(void 0!==i){var e=i.call(s,t||"default");if("object"!==a(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(s)}(s,"string");return"symbol"===a(t)?t:String(t)}(t))in s?Object.defineProperty(s,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[t]=i,s}const d={layout:"backend",middleware:["auth"],components:{NLDatatable:e.Z},data:function(){var s,t,i;return{controllersList:[],rowSelected:null,config:{data:null,namespace:"missions",state_key:"processes",rowKey:"id",columns:[{label:"Famille",field:"familly"},{label:"Domaine",field:"domain"},{label:"Processus",field:"name"},{label:"Total points de contrôle",field:"control_points_count"},{label:"Moyenne",field:"avg_score",methods:{style:function(s){var t=s.avg_score;return 1==t?"bg-success text-white text-bold":2==t?"bg-info text-white text-bold":3==t?"bg-warning text-bold":4==t?"bg-danger text-white text-bold":void 0}}},{label:"Progression",field:"progress_status",methods:{showField:function(s){return s.progress_status+"%"}}},{label:"Date d'exécution",field:"executed_at"},{label:"Date de traitement",field:"processed_at",hide:!(null!==(s=this.currentUser)&&void 0!==s&&s.authorizations.process_mission||null!==(t=this.currentUser)&&void 0!==t&&t.authorizations.assign_mission_processing||null!==(i=this.currentUser)&&void 0!==i&&i.authorizations.create_control_campaign)}],actions:{show:!0}},modals:{opinion:!1,report:!1,dispatch:!1},forms:{opinion:new r.l0({opinion:null,id:null,type:"Avis contrôleur",validated:!1,edit_mode:!0}),report:new r.l0({report:null,id:null,type:"Rapport",validated:!1,edit_mode:!0}),dispatch:new r.l0({controllers:null}),validations:{opinion:new r.l0({type:"Avis contrôleur"}),report:new r.l0({type:"Rapport"})}}}},breadcrumb:function(){var s,t;return{label:"Mission "+(null===(s=this.mission)||void 0===s||null===(t=s.current)||void 0===t?void 0:t.reference)}},computed:function(s){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){c(s,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(i,t))}))}return s}({currentUser:function(){return localStorage.getItem("user")}},(0,n.Se)({mission:"missions/current",processes:"missions/processes",users:"users/all"})),created:function(){this.initData()},methods:{validateMission:function(s){var t=this;swal.confirm({title:"Mission "+this.mission.current.reference,message:"Vous êtes sur de vouloir valider la mission "+this.mission.current.reference}).then((function(i){i.isConfirmed&&o.Z.post("missions/"+t.mission.current.id+"/validate/"+s).then((function(s){swal.toast_success(s.data.message),t.initData()})).catch((function(s){console.log(s)}))}))},dispatchMission:function(){var s=this;this.forms.dispatch.put("/api/missions/"+this.mission.current.id+"/assign").then((function(t){t.data.status?(swal.toast_success(t.data.message),s.forms.dispatch.reset(),s.initData()):swal.alert_error(t.data.message)})).catch((function(s){console.log(s)}))},showDispatchForm:function(){var s=this;this.$store.dispatch("users/fetchAll",{roles_codes:"cc"}).then((function(){s.controllersList=s.users.all,s.forms.dispatch.controllers=s.mission.current.dcp_controllers.map((function(s){return s.id})),s.modals.dispatch=!0}))},saveReport:function(){var s=this;this.forms.report.post("/api/missions/reports/"+this.mission.current.id).then((function(t){t.data.status?(swal.toast_success(t.data.message),s.forms.opinion.reset(),s.initData()):swal.alert_error(t.data.message)})).catch((function(s){console.log(s)}))},validateReport:function(){var s=this;swal.confirm({title:"Mission "+this.mission.current.reference,message:"Vous êtes sur de vouloir valider la mission "+this.mission.current.reference}).then((function(t){t.isConfirmed&&s.forms.validations.report.put("/api/missions/reports/"+s.mission.current.id).then((function(t){t.data.status?(swal.toast_success(t.data.message),s.initData()):swal.alert_error(t.data.message)})).catch((function(s){console.log(s)}))}))},showReport:function(){this.modals.report=!0},showOpinion:function(){this.modals.opinion=!0},saveOpinion:function(){var s=this;this.forms.opinion.post("/api/missions/reports/"+this.mission.current.id).then((function(t){t.data.status?(swal.toast_success(t.data.message),s.forms.opinion.reset(),s.initData()):swal.alert_error(t.data.message)})).catch((function(s){console.log(s)}))},validateOpinion:function(){var s=this;swal.confirm({title:"Mission "+this.mission.current.reference,message:"Vous êtes sur de vouloir valider la mission "+this.mission.current.reference}).then((function(t){t.isConfirmed&&s.forms.validations.opinion.put("/api/missions/reports/"+s.mission.current.id).then((function(t){t.data.status?(swal.toast_success(t.data.message),s.initData()):swal.alert_error(t.data.message)})).catch((function(s){console.log(s)}))}))},enableEdition:function(s){"opinion"==s?(this.forms.opinion.edit_mode=!0,this.forms.opinion.opinion=this.mission.current.opinion.content,this.forms.opinion.id=this.mission.current.opinion.id):"report"==s&&(this.forms.report.edit_mode=!0,this.forms.report.report=this.mission.current.dre_report.content,this.forms.report.id=this.mission.current.dre_report.id)},initData:function(){var s=this;this.close(),this.$store.dispatch("missions/fetch",{missionId:this.$route.params.missionId}),this.$store.dispatch("missions/fetch",{missionId:this.$route.params.missionId,onlyProcesses:!0}).then((function(){return s.config.data=s.processes.processes})),this.forms.opinion.edit_mode=!1,this.forms.report.edit_mode=!1,this.modals.dispatch=!1},details:function(s){var t,i,e,n="mission-details";(s=null!==(t=s)&&void 0!==t&&null!==(i=t.item)&&void 0!==i&&i.id?s.item:s).progress_status<100&&(null===(e=this.mission)||void 0===e||!e.current.opinion)&&(n="mission-details-execute"),this.$router.push({name:n,params:{missionId:this.mission.current.id,processId:s.id}})},destroy:function(){var s=this;swal.confirm_destroy().then((function(t){var i;t.isConfirmed&&o.Z.delete("missions/"+(null===(i=s.mission)||void 0===i?void 0:i.current.id)).then((function(t){t.data.status?(s.initData(),swal.toast_success(t.data.message)):swal.alert_error(t.data.message)})).catch((function(s){console.log(s)}))}))},show:function(s){this.rowSelected=s},close:function(){this.rowSelected=null}}};const u=(0,i(1900).Z)(d,(function(){var s,t,i,e,n,o,r,a,l,c,d,u,v,p,m,_,f,h,b,g,y,w,C,k,x,O,S,j,D,N,P,A,E,R,M,I,L,T,V,U,$,F,z,q,K,B,Z,H,W,G,J,Q,X,Y,ss,ts,is,es,ns,os,rs=this,as=rs._self._c;return as("ContentBody",{directives:[{name:"can",rawName:"v-can",value:"view_mission",expression:"'view_mission'"}]},[as("div",{staticClass:"d-flex justify-end align-center gap-3 my-2"},[as("router-link",{directives:[{name:"can",rawName:"v-can",value:"view_mission",expression:"'view_mission'"}],staticClass:"btn",attrs:{to:{name:"campaign",params:{campaignId:null===(s=rs.mission)||void 0===s?void 0:s.current.campaign.id}}}},[rs._v("\n      Campagne de contrôle\n    ")]),rs._v(" "),(null===(t=rs.mission)||void 0===t||null===(i=t.current)||void 0===i?void 0:i.remaining_days_before_start)>5?as("router-link",{directives:[{name:"can",rawName:"v-can",value:"edit_mission",expression:"'edit_mission'"}],staticClass:"btn btn-warning",attrs:{to:{name:"missions-edit",params:{missionId:null===(e=rs.mission)||void 0===e?void 0:e.current.id}}}},[as("i",{staticClass:"las la-edit icon"})]):rs._e()],1),rs._v(" "),as("div",{staticClass:"box border-primary-dark border-1 mb-10"},[as("div",{staticClass:"grid gap-6"},[as("div",{staticClass:"col-4"},[as("div",{staticClass:"grid gap-6"},[as("div",{staticClass:"col-12"},[as("span",{staticClass:"text-bold"},[rs._v("\n              Mission:\n            ")]),rs._v(" "),as("span",[rs._v("\n              "+rs._s(null===(n=rs.mission)||void 0===n||null===(o=n.current)||void 0===o?void 0:o.reference)+"\n            ")])]),rs._v(" "),as("div",{staticClass:"col-12"},[as("span",{staticClass:"text-bold"},[rs._v("\n              DRE:\n            ")]),rs._v(" "),as("span",[rs._v("\n              "+rs._s(null===(r=rs.mission)||void 0===r||null===(a=r.current)||void 0===a?void 0:a.dre.full_name)+"\n            ")])]),rs._v(" "),as("div",{staticClass:"col-12"},[as("span",{staticClass:"text-bold"},[rs._v("\n              Agence:\n            ")]),rs._v(" "),as("span",[rs._v("\n              "+rs._s(null===(l=rs.mission)||void 0===l||null===(c=l.current)||void 0===c?void 0:c.agency.full_name)+"\n            ")])])])]),rs._v(" "),as("div",{staticClass:"col-4"},[as("div",{staticClass:"grid gap-6"},[as("div",{staticClass:"col-12"},[as("span",{staticClass:"text-bold"},[rs._v("\n              Campagne:\n            ")]),rs._v(" "),as("span",[rs._v("\n              "+rs._s(null===(d=rs.mission)||void 0===d||null===(u=d.current)||void 0===u?void 0:u.campaign.reference)+"\n            ")])]),rs._v(" "),as("div",{staticClass:"col-12"},[as("span",{staticClass:"text-bold"},[rs._v("\n              Début:\n            ")]),rs._v(" "),as("span",[rs._v("\n              "+rs._s((null===(v=rs.mission)||void 0===v||null===(p=v.current)||void 0===p?void 0:p.start)+" / "+(null===(m=rs.mission)||void 0===m||null===(_=m.current)||void 0===_?void 0:_.remaining_days_before_start_str))+"\n            ")])]),rs._v(" "),as("div",{staticClass:"col-12"},[as("span",{staticClass:"text-bold"},[rs._v("\n              Fin:\n            ")]),rs._v(" "),as("span",[rs._v("\n              "+rs._s((null===(f=rs.mission)||void 0===f||null===(h=f.current)||void 0===h?void 0:h.end)+" / "+(null===(b=rs.mission)||void 0===b||null===(g=b.current)||void 0===g?void 0:g.remaining_days_before_end_str))+"\n            ")])])])]),rs._v(" "),as("div",{staticClass:"col-4"},[as("div",{staticClass:"grid gap-6"},[as("div",{staticClass:"col-12"},[as("span",{staticClass:"text-bold"},[rs._v("\n              Contrôleurs dre:\n            ")]),rs._v(" "),as("span",[as("ul",{staticClass:"d-inline-block ml-6"},rs._l(null===(y=rs.mission)||void 0===y||null===(w=y.current)||void 0===w?void 0:w.agency_controllers,(function(s){return as("li",{key:"dre_controller-"+s.id},[rs._v("\n                  "+rs._s(s.full_name)+"\n                ")])})),0)])]),rs._v(" "),as("div",{staticClass:"col-12"},[as("span",{staticClass:"text-bold"},[rs._v("\n              Contrôleurs dcp:\n            ")]),rs._v(" "),as("span",[as("ul",{staticClass:"d-inline-block ml-6"},rs._l(null===(C=rs.mission)||void 0===C||null===(k=C.current)||void 0===k?void 0:k.dcp_controllers,(function(s){return as("li",{key:"dcp-controller-"+s.id},[rs._v("\n                  "+rs._s(s.full_name)+"\n                ")])})),0)])])])]),rs._v(" "),as("div",{staticClass:"col-12 col-lg-4"},[as("span",{staticClass:"text-bold"},[rs._v("\n          Moyenne:\n        ")]),rs._v(" "),as("span",[rs._v("\n          "+rs._s(null===(x=rs.mission)||void 0===x||null===(O=x.current)||void 0===O?void 0:O.avg_score)+"\n        ")])]),rs._v(" "),as("div",{staticClass:"col-12 col-lg-4"},[as("span",{staticClass:"text-bold"},[rs._v("\n          Progression:\n        ")]),rs._v(" "),as("span",[rs._v("\n          "+rs._s(null===(S=rs.mission)||void 0===S||null===(j=S.current)||void 0===j?void 0:j.progress_status)+"%\n        ")])]),rs._v(" "),as("div",{staticClass:"col-12 col-lg-4"},[as("span",{staticClass:"text-bold"},[rs._v("\n          Statut:\n        ")]),rs._v(" "),as("span",[rs._v("\n          "+rs._s(null===(D=rs.mission)||void 0===D||null===(N=D.current)||void 0===N?void 0:N.realisation_state)+"\n        ")])]),rs._v(" "),as("div",{staticClass:"col-12"},[as("span",{staticClass:"text-bold"},[rs._v("\n          Note:\n        ")]),rs._v(" "),as("span",[rs._v("\n          "+rs._s((null===(P=rs.mission)||void 0===P||null===(A=P.current)||void 0===A?void 0:A.note)||"-")+"\n        ")])])])]),rs._v(" "),as("div",{staticClass:"d-flex align-items"},[as("div",{directives:[{name:"can",rawName:"v-can",value:"create_dre_report",expression:"'create_dre_report'"}]},[100!=(null===(E=rs.mission)||void 0===E?void 0:E.current.progress_status)||null!==(R=rs.mission)&&void 0!==R&&R.current.dre_report||null===(M=rs.mission)||void 0===M||null===(I=M.current.opinion)||void 0===I||!I.is_validated?rs._e():as("button",{staticClass:"btn btn-info",on:{click:rs.showReport}},[rs._v("\n        Ajouter votre rapport\n      ")]),rs._v(" "),100!=(null===(L=rs.mission)||void 0===L?void 0:L.current.progress_status)||null===(T=rs.mission)||void 0===T||null===(V=T.current.opinion)||void 0===V||!V.is_validated||null!==(U=rs.mission)&&void 0!==U&&null!==($=U.current.dre_report)&&void 0!==$&&$.is_validated||null===(F=rs.mission)||void 0===F||!F.current.dre_report?rs._e():as("button",{staticClass:"btn btn-success",on:{click:function(s){return s.preventDefault(),rs.validateReport.apply(null,arguments)}}},[rs._v("\n        Valider la mission\n      ")]),rs._v(" "),null!==(z=rs.mission)&&void 0!==z&&z.current.dre_report?as("button",{directives:[{name:"can",rawName:"v-can",value:"create_dre_report",expression:"'create_dre_report'"}],staticClass:"btn btn-info",on:{click:rs.showReport}},[rs._v("\n        Rapport de la mission\n      ")]):rs._e(),rs._v(" "),null!==(q=rs.mission)&&void 0!==q&&null!==(K=q.current.opinion)&&void 0!==K&&K.is_validated?as("button",{directives:[{name:"can",rawName:"v-can",value:"view_opinion",expression:"'view_opinion'"}],staticClass:"btn btn-info",on:{click:rs.showOpinion}},[rs._v("\n        Avis sur la mission\n      ")]):rs._e()]),rs._v(" "),as("div",{directives:[{name:"can",rawName:"v-can",value:"create_opinion",expression:"'create_opinion'"}]},[null!==(B=rs.mission)&&void 0!==B&&B.current.controller_opinion_exist||null!==(Z=rs.mission)&&void 0!==Z&&Z.dre_report_exist||100!=(null===(H=rs.mission)||void 0===H?void 0:H.current.progress_status)?rs._e():as("button",{directives:[{name:"can",rawName:"v-can",value:"create_opinion",expression:"'create_opinion'"}],staticClass:"btn btn-info",on:{click:rs.showOpinion}},[rs._v("\n        Ajouter votre avis\n      ")]),rs._v(" "),100!=(null===(W=rs.mission)||void 0===W?void 0:W.current.progress_status)||null!==(G=rs.mission)&&void 0!==G&&G.current.controller_opinion_validated||null===(J=rs.mission)||void 0===J||!J.controller_opinion_exist?rs._e():as("button",{directives:[{name:"can",rawName:"v-can",value:"validate_opinion",expression:"'validate_opinion'"}],staticClass:"btn btn-success",on:{click:function(s){return s.preventDefault(),rs.validateOpinion.apply(null,arguments)}}},[rs._v("\n        Valider la mission\n      ")]),rs._v(" "),null!==(Q=rs.mission)&&void 0!==Q&&Q.controller_opinion_exist?as("button",{directives:[{name:"can",rawName:"v-can",value:"validate_opinion",expression:"'validate_opinion'"}],staticClass:"btn btn-info",on:{click:rs.showOpinion}},[rs._v("\n        Avis sur la mission\n      ")]):rs._e()]),rs._v(" "),as("div",{directives:[{name:"can",rawName:"v-can",value:"make_first_validation",expression:"'make_first_validation'"}]},[null!==(X=rs.mission)&&void 0!==X&&X.current.cdcr_validation_at?rs._e():as("button",{directives:[{name:"can",rawName:"v-can",value:"make_first_validation",expression:"'make_first_validation'"}],staticClass:"btn btn-success",on:{click:function(s){return s.preventDefault(),rs.validateMission(1)}}},[rs._v("\n        Valider la mission\n      ")]),rs._v(" "),null!==(Y=rs.mission)&&void 0!==Y&&Y.current.cdcr_validation_at?rs._e():as("button",{directives:[{name:"can",rawName:"v-can",value:"assign_mission_processing",expression:"'assign_mission_processing'"}],staticClass:"btn btn-success",on:{click:function(s){return s.preventDefault(),rs.showDispatchForm.apply(null,arguments)}}},[rs._v("\n        Assigné\n      ")]),rs._v(" "),null!==(ss=rs.mission)&&void 0!==ss&&null!==(ts=ss.current.dre_report)&&void 0!==ts&&ts.is_validated?as("button",{directives:[{name:"can",rawName:"v-can",value:"make_first_validation",expression:"'make_first_validation'"}],staticClass:"btn btn-info",on:{click:rs.showReport}},[rs._v("\n        Rapport de la mission\n      ")]):rs._e()]),rs._v(" "),as("div",{directives:[{name:"can",rawName:"v-can",value:"make_second_validation",expression:"'make_second_validation'"}]},[null===(is=rs.mission)||void 0===is||!is.current.cdcr_validation_at||null!==(es=rs.mission)&&void 0!==es&&es.current.dcp_validation_at?rs._e():as("button",{directives:[{name:"can",rawName:"v-can",value:"make_second_validation",expression:"'make_second_validation'"}],staticClass:"btn btn-success",on:{click:function(s){return s.preventDefault(),rs.validateMission(2)}}},[rs._v("\n        Valider la mission\n      ")]),rs._v(" "),null!==(ns=rs.mission)&&void 0!==ns&&ns.current.cdcr_validation_at?as("button",{directives:[{name:"can",rawName:"v-can",value:"make_second_validation",expression:"'make_second_validation'"}],staticClass:"btn btn-info",on:{click:rs.showReport}},[rs._v("\n        Rapport de la mission\n      ")]):rs._e()]),rs._v(" "),as("div",{directives:[{name:"has-role",rawName:"v-has-role",value:"dg,cdrcp,da,cc",expression:"'dg,cdrcp,da,cc'"}]},[null!==(os=rs.mission)&&void 0!==os&&os.current.cdcr_validation_at?as("button",{staticClass:"btn btn-info",on:{click:rs.showReport}},[rs._v("\n        Rapport de la mission\n      ")]):rs._e()])]),rs._v(" "),as("NLDatatable",{attrs:{title:"Processus de la mission",namespace:"missions",stateKey:"processes",config:rs.config},on:{show:rs.show},scopedSlots:rs._u([{key:"actions",fn:function(s){var t;return[as("button",{directives:[{name:"can",rawName:"v-can",value:"control_agency,view_mission_detail",expression:"'control_agency,view_mission_detail'"}],staticClass:"btn btn-info has-icon",on:{click:function(t){return t.stopPropagation(),rs.details(s)}}},[s.item.progress_status<100&&(null===(t=rs.mission)||void 0===t||!t.current.opinion)?as("i",{staticClass:"las la-tasks icon"}):as("i",{staticClass:"las la-list-alt icon"})])]}}])}),rs._v(" "),as("NLModal",{attrs:{show:rs.rowSelected},on:{close:rs.close},scopedSlots:rs._u([{key:"title",fn:function(){var s,t,i;return[as("small",{staticClass:"tag is-info text-small"},[rs._v("\n        "+rs._s(null===(s=rs.rowSelected)||void 0===s?void 0:s.familly)+"\n      ")]),rs._v(" "),as("small",{staticClass:"tag is-primary-dark text-small mx-1"},[rs._v("\n        "+rs._s(null===(t=rs.rowSelected)||void 0===t?void 0:t.domain)+"\n      ")]),rs._v(" "),as("small",{staticClass:"tag is-warning text-small"},[rs._v("\n        "+rs._s(null===(i=rs.rowSelected)||void 0===i?void 0:i.name)+"\n      ")])]},proxy:!0},{key:"default",fn:function(){var s;return[as("p",{staticClass:"text-bold mb-6"},[rs._v("\n        Points de contrôle\n      ")]),rs._v(" "),as("div",{staticClass:"grid list"},rs._l(null===(s=rs.rowSelected)||void 0===s?void 0:s.controlPoints,(function(s){return as("div",{key:s.id,staticClass:"col-12 list-item"},[as("div",{staticClass:"list-item-content"},[rs._v("\n            "+rs._s(s.name)+"\n          ")])])})),0)]},proxy:!0},{key:"footer",fn:function(){var s;return[100==(null===(s=rs.rowSelected)||void 0===s?void 0:s.progress_status)?as("button",{directives:[{name:"can",rawName:"v-can",value:"view_mission",expression:"'view_mission'"}],staticClass:"btn btn-info has-icon",on:{click:function(s){return s.stopPropagation(),rs.details(rs.rowSelected)}}},[as("i",{staticClass:"las la-tasks icon"}),rs._v("\n        Afficher\n      ")]):as("button",{directives:[{name:"can",rawName:"v-can",value:"control_agency",expression:"'control_agency'"}],staticClass:"btn btn-info has-icon",on:{click:function(s){return s.stopPropagation(),rs.details(rs.rowSelected)}}},[as("i",{staticClass:"las la-tasks icon"}),rs._v("\n        Éffectuer\n      ")])]},proxy:!0}])}),rs._v(" "),as("NLModal",{attrs:{show:rs.modals.opinion},on:{close:function(s){rs.modals.opinion=!1}},scopedSlots:rs._u([{key:"title",fn:function(){return[as("h2",[rs._v("Avis du contrôleur")])]},proxy:!0},{key:"default",fn:function(){var s,t,i,e,n;return[null===(s=rs.mission)||void 0===s||!s.current.opinion||rs.forms.opinion.edit_mode?as("form",{on:{submit:function(s){return s.preventDefault(),rs.saveOpinion.apply(null,arguments)},keydown:function(s){return rs.forms.opinion.onKeydown(s)}}},[as("div",{staticClass:"grid"},[as("div",{staticClass:"col-12"},[as("NLWyswyg",{attrs:{name:"opinion",form:rs.forms.opinion,label:"Avis du contrôleur",labelRequired:""},model:{value:rs.forms.opinion.opinion,callback:function(s){rs.$set(rs.forms.opinion,"opinion",s)},expression:"forms.opinion.opinion"}})],1),rs._v(" "),as("div",{staticClass:"col-12"},[as("NLCheckbox",{attrs:{name:"validated",form:rs.forms.opinion,label:"Validé la mission"},model:{value:rs.forms.opinion.validated,callback:function(s){rs.$set(rs.forms.opinion,"validated",s)},expression:"forms.opinion.validated"}})],1)]),rs._v(" "),as("div",{staticClass:"d-flex justify-end align-center"},[as("NLButton",{attrs:{loading:rs.forms.opinion.busy,label:"Save"}})],1)]):as("div",{staticClass:"grid"},[as("div",{staticClass:"col-12",domProps:{innerHTML:rs._s(null===(t=rs.mission)||void 0===t?void 0:t.current.opinion.content)}}),rs._v(" "),null!==(i=rs.mission)&&void 0!==i&&null!==(e=i.current.opinion)&&void 0!==e&&e.is_validated?as("div",{staticClass:"col-12"},[as("b",[rs._v("Validé le:")]),rs._v(" "),as("time",[rs._v(rs._s(null===(n=rs.mission)||void 0===n?void 0:n.current.opinion.validated_at))])]):rs._e()])]},proxy:!0},{key:"footer",fn:function(){var s,t,i,e,n,o;return[null!==(s=rs.mission)&&void 0!==s&&null!==(t=s.current.opinion)&&void 0!==t&&t.is_validated||null===(i=rs.mission)||void 0===i||!i.current.opinion||rs.forms.opinion.edit_mode?rs._e():as("button",{directives:[{name:"can",rawName:"v-can",value:"create_opinion",expression:"'create_opinion'"}],staticClass:"btn btn-success has-icon",on:{click:function(s){return s.preventDefault(),rs.validateOpinion.apply(null,arguments)}}},[as("i",{staticClass:"las la-check-circle icon"}),rs._v("\n        Valider la mission\n      ")]),rs._v(" "),null!==(e=rs.mission)&&void 0!==e&&null!==(n=e.current.opinion)&&void 0!==n&&n.is_validated||null===(o=rs.mission)||void 0===o||!o.current.opinion||rs.forms.opinion.edit_mode?rs._e():as("button",{directives:[{name:"can",rawName:"v-can",value:"create_opinion",expression:"'create_opinion'"}],staticClass:"btn btn-warning has-icon",on:{click:function(s){return s.preventDefault(),rs.enableEdition("opinion")}}},[as("i",{staticClass:"las la-edit icon"}),rs._v("\n        Editer l'avis\n      ")])]},proxy:!0}])}),rs._v(" "),as("NLModal",{attrs:{show:rs.modals.report},on:{close:function(s){rs.modals.report=!1}},scopedSlots:rs._u([{key:"title",fn:function(){return[as("h2",[rs._v("Rapport du chef de département")])]},proxy:!0},{key:"default",fn:function(){var s,t,i,e,n;return[null===(s=rs.mission)||void 0===s||!s.current.dre_report||rs.forms.report.edit_mode?as("form",{on:{submit:function(s){return s.preventDefault(),rs.saveReport.apply(null,arguments)},keydown:function(s){return rs.forms.report.onKeydown(s)}}},[as("div",{staticClass:"grid"},[as("div",{staticClass:"col-12"},[as("NLWyswyg",{attrs:{name:"report",form:rs.forms.report,label:"Rapport du chef de département",labelRequired:""},model:{value:rs.forms.report.report,callback:function(s){rs.$set(rs.forms.report,"report",s)},expression:"forms.report.report"}})],1),rs._v(" "),as("div",{staticClass:"col-12"},[as("NLCheckbox",{attrs:{name:"validated",form:rs.forms.report,label:"Validé la mission"},model:{value:rs.forms.report.validated,callback:function(s){rs.$set(rs.forms.report,"validated",s)},expression:"forms.report.validated"}})],1)]),rs._v(" "),as("div",{staticClass:"d-flex justify-end align-center"},[as("NLButton",{attrs:{loading:rs.forms.report.busy,label:"Save"}})],1)]):as("div",{staticClass:"grid"},[as("div",{staticClass:"col-12",domProps:{innerHTML:rs._s(null===(t=rs.mission)||void 0===t?void 0:t.current.dre_report.content)}}),rs._v(" "),null!==(i=rs.mission)&&void 0!==i&&null!==(e=i.current.dre_report)&&void 0!==e&&e.is_validated?as("div",{staticClass:"col-12"},[as("b",[rs._v("Validé le:")]),rs._v(" "),as("time",[rs._v(rs._s(null===(n=rs.mission)||void 0===n?void 0:n.current.dre_report.validated_at))])]):rs._e()])]},proxy:!0},{key:"footer",fn:function(){var s,t,i,e,n,o,r,a,l,c;return[null===(s=rs.mission)||void 0===s||null===(t=s.current.opinion)||void 0===t||!t.is_validated||null===(i=rs.mission)||void 0===i||!i.current.dre_report||null!==(e=rs.mission)&&void 0!==e&&null!==(n=e.current.dre_report)&&void 0!==n&&n.is_validated||rs.forms.report.edit_mode?rs._e():as("button",{directives:[{name:"can",rawName:"v-can",value:"validate_dre_report",expression:"'validate_dre_report'"}],staticClass:"btn btn-success has-icon",on:{click:function(s){return s.preventDefault(),rs.validateReport.apply(null,arguments)}}},[as("i",{staticClass:"las la-check-circle icon"}),rs._v("\n        Valider la mission\n      ")]),rs._v(" "),null===(o=rs.mission)||void 0===o||null===(r=o.current.opinion)||void 0===r||!r.is_validated||null===(a=rs.mission)||void 0===a||!a.current.dre_report||null!==(l=rs.mission)&&void 0!==l&&null!==(c=l.current.dre_report)&&void 0!==c&&c.is_validated||rs.forms.report.edit_mode?rs._e():as("button",{directives:[{name:"can",rawName:"v-can",value:"create_dre_report",expression:"'create_dre_report'"}],staticClass:"btn btn-warning has-icon",on:{click:function(s){return s.preventDefault(),rs.enableEdition("report")}}},[as("i",{staticClass:"las la-edit icon"}),rs._v("\n        Editer le rapport\n      ")])]},proxy:!0}])}),rs._v(" "),as("NLModal",{attrs:{show:rs.modals.dispatch},on:{close:function(s){rs.modals.dispatch=!1}},scopedSlots:rs._u([{key:"title",fn:function(){return[as("h2",[rs._v("Assigné le traitement de la mission")])]},proxy:!0},{key:"default",fn:function(){return[as("form",{on:{submit:function(s){return s.preventDefault(),rs.dispatchMission.apply(null,arguments)},keydown:function(s){return rs.forms.dispatch.onKeydown(s)}}},[as("div",{staticClass:"grid"},[as("div",{staticClass:"col-12"},[as("NLSelect",{attrs:{name:"controllers",form:rs.forms.dispatch,options:rs.controllersList,label:"Contrôleurs",placeholder:"Choisissez un ou plusieurs contrôleurs",multiple:"",labelRequired:""},model:{value:rs.forms.dispatch.controllers,callback:function(s){rs.$set(rs.forms.dispatch,"controllers",s)},expression:"forms.dispatch.controllers"}})],1)]),rs._v(" "),as("div",{staticClass:"d-flex justify-end align-center"},[as("NLButton",{attrs:{loading:rs.forms.dispatch.busy,label:"Save"}})],1)])]},proxy:!0}])})],1)}),[],!1,null,null,null).exports}}]);