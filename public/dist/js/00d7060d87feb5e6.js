"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2278],{2278:(t,e,n)=>{n.r(e),n.d(e,{default:()=>d});var i=n(6828),a=n(2904),s=n(629),l=n(7565);function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(t,e,n){return(e=function(t){var e=function(t,e){if("object"!==r(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===r(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const c={components:{ContentHeader:i.Z,ContentBody:a.Z},layout:"backend",middleware:["auth"],metaInfo:function(){return{title:"Suivi des réalisations des missions"}},data:function(){var t,e=this;return{rowSelected:null,campaignId:null,config:{data:null,columns:[{label:"CDC-ID",field:"campaign"},{label:"Référence",field:"reference"},{label:"Dre",field:"dre"},{label:"Agence",field:"agency"},{label:"Contrôle sur place par",field:"agency_controllers_str"},{label:"Date début",field:"start"},{label:"Date fin",field:"end"},{label:"Moyenne",field:"avg_score",hide:!(0,l.nu)(["dcp","cdcr","cc"]),isHtml:!0,methods:{showField:function(t){var e=t.avg_score;return'<div class="container">\n                  <div class="has-border-radius py-1 text-center '.concat(1==e?"bg-success text-white text-bold":2==e?"bg-info text-white text-bold":3==e?"bg-warning text-bold":4==e?"bg-danger text-white text-bold":"bg-grey text-dark text-bold",'">').concat(e,"</div>\n                </div>")}}},{label:"État",field:"state",isHtml:!0,methods:{showField:function(t){var e="done";return"En cours"==t.state?e="inProgress":"À réaliser"==t.state?e="todo":"Réliser"==t.state?e="done":"En retard"==t.state?e="late":"Validé et envoyé"==t.state?e="validated":"En attente de validation"==t.state?e="pending-validation":"1ère validation"==t.state?e="first-validation":"2ème validation"==t.state&&(e="second-validation"),'<div class="container" title="'.concat(t.state,'">\n                  <div class="mission-state ').concat(e,'"></div>\n                </div>')}}},{label:"Taux de progression",field:"progress_status",methods:{showField:function(t){return t.progress_status+"%"}}}],actions:{show:function(t){return(0,l.nu)(["cdc","ci"])?e.can("view_mission"):(0,l.nu)(["dcp","cdcr"])?e.can("view_mission")&&100==t.progress_status&&(null==t||null===(n=t.dre_report)||void 0===n?void 0:n.is_validated):(0,l.nu)(["da","dg","cdrcp","ig","der"])?e.can("view_mission")&&100==t.progress_status&&(null==t?void 0:t.dcp_validation_at):e.can("view_mission")&&100==t.progress_status;var n},edit:function(t){return e.can("edit_mission")&&t.remaining_days_before_start>5},delete:function(t){return e.can("delete_mission")&&t.remaining_days_before_start>5}}},filters:{campaign:{label:"Campagne de contrôle",cols:"col-lg-3",multiple:!0,data:null,value:null},dre:{label:"DRE",cols:"col-lg-3",multiple:!0,data:null,value:null},agency:{label:"Agence",cols:"col-lg-3",multiple:!0,data:null,value:null},dre_controllers:{label:"Contrôleurs",cols:"col-lg-3",multiple:!0,data:null,value:null},between:(t={cols:"col-lg-3",value:[],type:"date-range"},o(t,"cols","col-lg-6"),o(t,"attributes",{start:{cols:"col-lg-6",label:"De",value:null},end:{cols:"col-lg-6",label:"À",value:null}}),t)}}},computed:(0,s.Se)({missions:"missions/paginated",filtersData:"missions/filters"}),created:function(){this.initFilters(),this.initData()},methods:{resetData:function(){this.initData()},initData:function(){var t=this;(this.$route.params.campaignId?this.$store.dispatch("missions/fetchPaginated",this.$route.params.campaignId):this.$store.dispatch("missions/fetchPaginated")).then((function(){return t.config.data=t.missions.paginated}))},initFilters:function(){var t=this;this.$store.dispatch("missions/fetchFilters").then((function(){t.filters.campaign.data=t.filtersData.filters.campaigns,t.filters.dre.data=t.filtersData.filters.dres,t.filters.agency.data=t.filtersData.filters.agencies,t.filters.dre_controllers.data=t.filtersData.filters.dre_controllers}))},show:function(t){this.$router.push({name:"mission",params:{missionId:t.id}})},edit:function(t){this.$router.push({name:"missions-edit",params:{missionId:t.id}})},destroy:function(t){var e=this;swal.confirm_destroy().then((function(n){n.isConfirmed&&api.delete("missions/"+t.id).then((function(t){t.data.status?(e.initData(),swal.toast_success(t.data.message)):swal.alert_error(t.data.message)})).catch((function(t){console.log(t)}))}))}}};const d=(0,n(1900).Z)(c,(function(){var t=this,e=t._self._c;return t.can("view_mission")?e("div",[t.campaignId?e("ContentHeader",{scopedSlots:t._u([{key:"actions",fn:function(){return[t.can("create_mission")?e("router-link",{staticClass:"btn btn-info",attrs:{to:{name:"missions-create",params:{campaignId:t.campaignId}}}},[t._v("\n        Ajouter\n      ")]):t._e()]},proxy:!0}],null,!1,188342256)}):t._e(),t._v(" "),e("ContentBody",[e("NLDatatable",{attrs:{filters:t.filters,namespace:"missions",config:t.config},on:{show:t.show,delete:t.destroy,edit:t.edit,filterReset:t.resetData}})],1)],1):t._e()}),[],!1,null,null,null).exports}}]);