"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9249],{5714:(t,s,n)=>{n.d(s,{ZP:()=>C,l0:()=>y});var i=n(9669),o=n.n(i),e=Object.defineProperty,r=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.propertyIsEnumerable,c=(t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,d=(t,s)=>{for(var n in s||(s={}))r.call(s,n)&&c(t,n,s[n]);if(a)for(var n of a(s))l.call(s,n)&&c(t,n,s[n]);return t};const u=t=>void 0===t,v=t=>Array.isArray(t),p=t=>t&&"number"==typeof t.size&&"string"==typeof t.type&&"function"==typeof t.slice,m=(t,s,n,i)=>((s=s||{}).indices=!u(s.indices)&&s.indices,s.nullsAsUndefineds=!u(s.nullsAsUndefineds)&&s.nullsAsUndefineds,s.booleansAsIntegers=!u(s.booleansAsIntegers)&&s.booleansAsIntegers,s.allowEmptyArrays=!u(s.allowEmptyArrays)&&s.allowEmptyArrays,n=n||new FormData,u(t)||(null===t?s.nullsAsUndefineds||n.append(i,""):(t=>"boolean"==typeof t)(t)?s.booleansAsIntegers?n.append(i,t?1:0):n.append(i,t):v(t)?t.length?t.forEach(((t,o)=>{const e=i+"["+(s.indices?o:"")+"]";m(t,s,n,e)})):s.allowEmptyArrays&&n.append(i+"[]",""):(t=>t instanceof Date)(t)?n.append(i,t.toISOString()):!(t=>t===Object(t))(t)||(t=>p(t)&&"string"==typeof t.name&&("object"==typeof t.lastModifiedDate||"number"==typeof t.lastModified))(t)||p(t)?n.append(i,t):Object.keys(t).forEach((o=>{const e=t[o];if(v(e))for(;o.length>2&&o.lastIndexOf("[]")===o.length-2;)o=o.substring(0,o.length-2);m(e,s,n,i?i+"["+o+"]":o)}))),n);var _={serialize:m};function f(t){if(null===t||"object"!=typeof t)return t;const s=Array.isArray(t)?[]:{};return Object.keys(t).forEach((n=>{s[n]=f(t[n])})),s}function h(t){return Array.isArray(t)?t:[t]}function b(t){return t instanceof File||t instanceof Blob||t instanceof FileList||"object"==typeof t&&null!==t&&void 0!==Object.values(t).find((t=>b(t)))}class g{constructor(){this.errors={},this.errors={}}set(t,s){"object"==typeof t?this.errors=t:this.set(d(d({},this.errors),{[t]:h(s)}))}all(){return this.errors}has(t){return Object.prototype.hasOwnProperty.call(this.errors,t)}hasAny(...t){return t.some((t=>this.has(t)))}any(){return Object.keys(this.errors).length>0}get(t){if(this.has(t))return this.getAll(t)[0]}getAll(t){return h(this.errors[t]||[])}only(...t){const s=[];return t.forEach((t=>{const n=this.get(t);n&&s.push(n)})),s}flatten(){return Object.values(this.errors).reduce(((t,s)=>t.concat(s)),[])}clear(t){const s={};t&&Object.keys(this.errors).forEach((n=>{n!==t&&(s[n]=this.errors[n])})),this.set(s)}}class y{constructor(t={}){this.originalData={},this.busy=!1,this.successful=!1,this.recentlySuccessful=!1,this.recentlySuccessfulTimeoutId=void 0,this.errors=new g,this.progress=void 0,this.update(t)}static make(t){return new this(t)}update(t){this.originalData=Object.assign({},this.originalData,f(t)),Object.assign(this,t)}fill(t={}){this.keys().forEach((s=>{this[s]=t[s]}))}data(){return this.keys().reduce(((t,s)=>d(d({},t),{[s]:this[s]})),{})}keys(){return Object.keys(this).filter((t=>!y.ignore.includes(t)))}startProcessing(){this.errors.clear(),this.busy=!0,this.successful=!1,this.progress=void 0,this.recentlySuccessful=!1,clearTimeout(this.recentlySuccessfulTimeoutId)}finishProcessing(){this.busy=!1,this.successful=!0,this.progress=void 0,this.recentlySuccessful=!0,this.recentlySuccessfulTimeoutId=setTimeout((()=>{this.recentlySuccessful=!1}),y.recentlySuccessfulTimeout)}clear(){this.errors.clear(),this.successful=!1,this.recentlySuccessful=!1,this.progress=void 0,clearTimeout(this.recentlySuccessfulTimeoutId)}reset(){Object.keys(this).filter((t=>!y.ignore.includes(t))).forEach((t=>{this[t]=f(this.originalData[t])}))}get(t,s={}){return this.submit("get",t,s)}post(t,s={}){return this.submit("post",t,s)}patch(t,s={}){return this.submit("patch",t,s)}put(t,s={}){return this.submit("put",t,s)}delete(t,s={}){return this.submit("delete",t,s)}submit(t,s,n={}){return this.startProcessing(),n=d({data:{},params:{},url:this.route(s),method:t,onUploadProgress:this.handleUploadProgress.bind(this)},n),"get"===t.toLowerCase()?n.params=d(d({},this.data()),n.params):(n.data=d(d({},this.data()),n.data),b(n.data)&&!n.transformRequest&&(n.transformRequest=[t=>_.serialize(t)])),new Promise(((t,s)=>{(y.axios||o()).request(n).then((s=>{this.finishProcessing(),t(s)})).catch((t=>{this.handleErrors(t),s(t)}))}))}handleErrors(t){this.busy=!1,this.progress=void 0,t.response&&this.errors.set(this.extractErrors(t.response))}extractErrors(t){return t.data&&"object"==typeof t.data?t.data.errors?d({},t.data.errors):t.data.message?{error:t.data.message}:d({},t.data):{error:y.errorMessage}}handleUploadProgress(t){this.progress={total:t.total,loaded:t.loaded,percentage:Math.round(100*t.loaded/t.total)}}route(t,s={}){let n=t;return Object.prototype.hasOwnProperty.call(y.routes,t)&&(n=decodeURI(y.routes[t])),"object"!=typeof s&&(s={id:s}),Object.keys(s).forEach((t=>{n=n.replace(`{${t}}`,s[t])})),n}onKeydown(t){const s=t.target;s.name&&this.errors.clear(s.name)}}y.routes={},y.errorMessage="Something went wrong. Please try again.",y.recentlySuccessfulTimeout=2e3,y.ignore=["busy","successful","errors","progress","originalData","recentlySuccessful","recentlySuccessfulTimeoutId"];const C=y},9249:(t,s,n)=>{n.r(s),n.d(s,{default:()=>v});var i=n(330),o=n(629),e=n(2661),r=n(5714),a=n(7565);function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function c(t,s){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);s&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.push.apply(n,i)}return n}function d(t,s,n){return(s=function(t){var s=function(t,s){if("object"!==l(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,s||"default");if("object"!==l(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(t)}(t,"string");return"symbol"===l(s)?s:String(s)}(s))in t?Object.defineProperty(t,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[s]=n,t}const u={layout:"backend",middleware:["auth"],components:{NLDatatable:i.Z},data:function(){return{controllersList:[],rowSelected:null,config:{data:null,namespace:"missions",state_key:"processes",rowKey:"id",columns:[{label:"Famille",field:"familly"},{label:"Domaine",field:"domain"},{label:"Processus",field:"name"},{label:"Total points de contrôle",field:"control_points_count"},{label:"Moyenne",field:"avg_score",hide:!(0,a.nu)(["dcp","cdcr","cc"]),isHtml:!0,methods:{showField:function(t){var s=t.avg_score;return'<div class="container">\n                  <div class="has-border-radius py-1 text-center '.concat(1==s?"bg-success text-white text-bold":2==s?"bg-info text-white text-bold":3==s?"bg-warning text-bold":4==s?"bg-danger text-white text-bold":"bg-grey text-dark text-bold",'">').concat(s,"</div>\n                </div>")}}}],actions:{show:!0}},modals:{opinion:!1,report:!1,dispatch:!1},forms:{opinion:new r.l0({opinion:null,id:null,type:"Avis contrôleur",validated:!1,edit_mode:!0}),report:new r.l0({report:null,id:null,type:"Rapport",validated:!1,edit_mode:!0}),dispatch:new r.l0({controllers:null}),validations:{opinion:new r.l0({type:"Avis contrôleur"}),report:new r.l0({type:"Rapport"})}}}},breadcrumb:function(){var t,s;return{label:"Mission "+(null===(t=this.mission)||void 0===t||null===(s=t.current)||void 0===s?void 0:s.reference)}},computed:function(t){for(var s=1;s<arguments.length;s++){var n=null!=arguments[s]?arguments[s]:{};s%2?c(Object(n),!0).forEach((function(s){d(t,s,n[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))}))}return t}({},(0,o.Se)({mission:"missions/current",processes:"missions/processes",controlPoints:"processes/controlPoints",users:"users/all"})),created:function(){this.initData()},methods:{exportReport:function(t){var s="/api/missions/"+this.mission.current.id+"/export?type=pdf";s+=t?"&mode=preview":"&mode=download",window.open(s)},validateMission:function(t){var s=this;swal.confirm({title:"Mission "+this.mission.current.reference,message:"Vous êtes sur de vouloir valider la mission "+this.mission.current.reference}).then((function(n){n.isConfirmed&&e.Z.post("missions/"+s.mission.current.id+"/validate/"+t).then((function(t){swal.toast_success(t.data.message),s.initData()})).catch((function(t){console.log(t)}))}))},dispatchMission:function(){var t=this;this.forms.dispatch.put("/api/missions/"+this.mission.current.id+"/assign").then((function(s){s.data.status?(swal.toast_success(s.data.message),t.forms.dispatch.reset(),t.initData()):swal.alert_error(s.data.message)})).catch((function(t){console.log(t)}))},showDispatchForm:function(){var t=this;this.$store.dispatch("users/fetchAll",{roles_codes:"cc"}).then((function(){t.controllersList=t.users.all,t.forms.dispatch.controllers=t.mission.current.dcp_controllers.map((function(t){return t.id})),t.modals.dispatch=!0}))},saveReport:function(){var t=this;this.forms.report.post("/api/missions/reports/"+this.mission.current.id).then((function(s){s.data.status?(swal.toast_success(s.data.message),t.forms.opinion.reset(),t.initData()):swal.alert_error(s.data.message)})).catch((function(t){console.log(t)}))},validateReport:function(){var t=this;swal.confirm({title:"Mission "+this.mission.current.reference,message:"Vous êtes sur de vouloir valider la mission "+this.mission.current.reference}).then((function(s){s.isConfirmed&&t.forms.validations.report.put("/api/missions/reports/"+t.mission.current.id).then((function(s){s.data.status?(swal.toast_success(s.data.message),t.initData()):swal.alert_error(s.data.message)})).catch((function(t){console.log(t)}))}))},showReport:function(){this.modals.report=!0},showOpinion:function(){this.modals.opinion=!0},saveOpinion:function(){var t=this;this.forms.opinion.post("/api/missions/reports/"+this.mission.current.id).then((function(s){s.data.status?(swal.toast_success(s.data.message),t.forms.opinion.reset(),t.initData()):swal.alert_error(s.data.message)})).catch((function(t){console.log(t)}))},validateOpinion:function(){var t=this;swal.confirm({title:"Mission "+this.mission.current.reference,message:"Vous êtes sur de vouloir valider la mission "+this.mission.current.reference}).then((function(s){s.isConfirmed&&t.forms.validations.opinion.put("/api/missions/reports/"+t.mission.current.id).then((function(s){s.data.status?(swal.toast_success(s.data.message),t.initData()):swal.alert_error(s.data.message)})).catch((function(t){console.log(t)}))}))},enableEdition:function(t){"opinion"==t?(this.forms.opinion.edit_mode=!0,this.forms.opinion.opinion=this.mission.current.opinion.content,this.forms.opinion.id=this.mission.current.opinion.id):"report"==t&&(this.forms.report.edit_mode=!0,this.forms.report.report=this.mission.current.dre_report.content,this.forms.report.id=this.mission.current.dre_report.id)},initData:function(){var t=this;this.close(),this.$store.dispatch("missions/fetch",{missionId:this.$route.params.missionId}).catch((function(t){return swal.alert_error(t)})),this.$store.dispatch("missions/fetch",{missionId:this.$route.params.missionId,onlyProcesses:!0}).then((function(){var s;t.config.data=null===(s=t.processes)||void 0===s?void 0:s.processes})).catch((function(t){return swal.alert_error(t)})),this.forms.opinion.edit_mode=!1,this.forms.report.edit_mode=!1,this.modals.dispatch=!1},details:function(t){var s,n,i,o="mission-details";(t=null!==(s=t)&&void 0!==s&&null!==(n=s.item)&&void 0!==n&&n.id?t.item:t).progress_status<100&&(null===(i=this.mission)||void 0===i||!i.current.opinion)&&(o="mission-details-execute"),this.$router.push({name:o,params:{missionId:this.mission.current.id,processId:t.id}})},destroy:function(){var t=this;swal.confirm_destroy().then((function(s){var n;s.isConfirmed&&e.Z.delete("missions/"+(null===(n=t.mission)||void 0===n?void 0:n.current.id)).then((function(s){s.data.status?(t.initData(),swal.toast_success(s.data.message)):swal.alert_error(s.data.message)})).catch((function(t){console.log(t)}))}))},show:function(t){var s=this;this.$store.dispatch("processes/fetch",{id:t.id,onlyControlPoints:!0}).then((function(){t.controlPoints=s.controlPoints.controlPoints,s.rowSelected=t}))},close:function(){this.rowSelected=null}}};const v=(0,n(1900).Z)(u,(function(){var t,s,n,i,o,e,r,a,l,c,d,u,v,p,m,_,f,h,b,g,y,C,w,k,x,O,S,j,P,D,A,R,E,M,I,L,N,T,V,$,F,U,q,K,B,Z,z,H,W,G,J,Q,X,Y,tt,st,nt,it,ot,et,rt,at,lt,ct,dt,ut,vt,pt,mt,_t,ft,ht,bt,gt,yt,Ct,wt,kt,xt,Ot,St,jt,Pt,Dt,At,Rt,Et,Mt,It,Lt,Nt=this,Tt=Nt._self._c;return Nt.can("view_mission")?Tt("ContentBody",[Tt("div",{staticClass:"d-flex justify-end align-center gap-3 my-2"},[Nt.can("view_control_campaign,view_page_control_campaigns")?Tt("router-link",{staticClass:"btn",attrs:{to:{name:"campaign",params:{campaignId:null===(t=Nt.mission)||void 0===t?void 0:t.current.campaign.id}}}},[Nt._v("\n      Campagne de contrôle\n    ")]):Nt._e(),Nt._v(" "),(null===(s=Nt.mission)||void 0===s||null===(n=s.current)||void 0===n?void 0:n.remaining_days_before_start)>5&&Nt.can("edit_mission")?Tt("router-link",{staticClass:"btn btn-warning",attrs:{to:{name:"missions-edit",params:{missionId:null===(i=Nt.mission)||void 0===i?void 0:i.current.id}}}},[Tt("i",{staticClass:"las la-edit icon"})]):Nt._e()],1),Nt._v(" "),Tt("div",{staticClass:"box border-primary-dark border-1 mb-10"},[Tt("div",{staticClass:"grid gap-6"},[Tt("div",{staticClass:"col-4"},[Tt("div",{staticClass:"grid gap-6"},[Tt("div",{staticClass:"col-12"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n              Mission:\n            ")]),Nt._v(" "),Tt("span",[Nt._v("\n              "+Nt._s(null===(o=Nt.mission)||void 0===o||null===(e=o.current)||void 0===e?void 0:e.reference)+"\n            ")])]),Nt._v(" "),Tt("div",{staticClass:"col-12"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n              DRE:\n            ")]),Nt._v(" "),Tt("span",[Nt._v("\n              "+Nt._s(null===(r=Nt.mission)||void 0===r||null===(a=r.current)||void 0===a?void 0:a.dre.full_name)+"\n            ")])]),Nt._v(" "),Tt("div",{staticClass:"col-12"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n              Agence:\n            ")]),Nt._v(" "),Tt("span",[Nt._v("\n              "+Nt._s(null===(l=Nt.mission)||void 0===l||null===(c=l.current)||void 0===c?void 0:c.agency.full_name)+"\n            ")])])])]),Nt._v(" "),Tt("div",{staticClass:"col-4"},[Tt("div",{staticClass:"grid gap-6"},[Tt("div",{staticClass:"col-12"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n              Campagne:\n            ")]),Nt._v(" "),Tt("span",[Nt._v("\n              "+Nt._s(null===(d=Nt.mission)||void 0===d||null===(u=d.current)||void 0===u?void 0:u.campaign.reference)+"\n            ")])]),Nt._v(" "),Tt("div",{staticClass:"col-12"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n              Début:\n            ")]),Nt._v(" "),Tt("span",[Nt._v("\n              "+Nt._s((null===(v=Nt.mission)||void 0===v||null===(p=v.current)||void 0===p?void 0:p.start)+" / "+(null===(m=Nt.mission)||void 0===m||null===(_=m.current)||void 0===_?void 0:_.remaining_days_before_start_str))+"\n            ")])]),Nt._v(" "),Tt("div",{staticClass:"col-12"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n              Fin:\n            ")]),Nt._v(" "),Tt("span",[Nt._v("\n              "+Nt._s((null===(f=Nt.mission)||void 0===f||null===(h=f.current)||void 0===h?void 0:h.end)+" / "+(null===(b=Nt.mission)||void 0===b||null===(g=b.current)||void 0===g?void 0:g.remaining_days_before_end_str))+"\n            ")])])])]),Nt._v(" "),Tt("div",{staticClass:"col-4"},[Tt("div",{staticClass:"grid gap-6"},[Tt("div",{staticClass:"col-12"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n              Contrôleurs dre:\n            ")]),Nt._v(" "),Tt("span",[Tt("ul",{staticClass:"d-inline-block ml-6"},Nt._l(null===(y=Nt.mission)||void 0===y||null===(C=y.current)||void 0===C?void 0:C.agency_controllers,(function(t){return Tt("li",{key:"dre_controller-"+t.id},[Nt._v("\n                  "+Nt._s(t.full_name)+"\n                ")])})),0)])]),Nt._v(" "),Tt("div",{staticClass:"col-12"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n              Contrôleurs dcp:\n            ")]),Nt._v(" "),Tt("span",[Tt("ul",{staticClass:"d-inline-block ml-6"},Nt._l(null===(w=Nt.mission)||void 0===w||null===(k=w.current)||void 0===k?void 0:k.dcp_controllers,(function(t){return Tt("li",{key:"dcp-controller-"+t.id},[Nt._v("\n                  "+Nt._s(t.full_name)+"\n                ")])})),0)])])])]),Nt._v(" "),Tt("div",{staticClass:"col-12 col-lg-4"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n          Taux de progression:\n        ")]),Nt._v(" "),Tt("span",[Nt._v("\n          "+Nt._s(null===(x=Nt.mission)||void 0===x||null===(O=x.current)||void 0===O?void 0:O.progress_status)+"%\n        ")])]),Nt._v(" "),Tt("div",{staticClass:"col-12 col-lg-4"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n          Statut:\n        ")]),Nt._v(" "),Tt("span",[Nt._v("\n          "+Nt._s(null===(S=Nt.mission)||void 0===S||null===(j=S.current)||void 0===j?void 0:j.realisation_state)+"\n        ")])]),Nt._v(" "),Tt("div",{directives:[{name:"has-role",rawName:"v-has-role",value:"cdc,cdcr,cc",expression:"'cdc,cdcr,cc'"}],staticClass:"col-12 col-lg-4"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n          Moyenne:\n        ")]),Nt._v(" "),Tt("span",[Nt._v("\n          "+Nt._s(null===(P=Nt.mission)||void 0===P||null===(D=P.current)||void 0===D?void 0:D.avg_score)+"\n        ")])]),Nt._v(" "),null!==(A=Nt.mission)&&void 0!==A&&null!==(R=A.current)&&void 0!==R&&R.cdcr_validation_at?Tt("div",{staticClass:"col-12 col-lg-4"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n          1"),Tt("sup",[Nt._v("ère")]),Nt._v(" validation\n        ")]),Nt._v(" "),Tt("span",[Nt._v("\n          "+Nt._s(null===(E=Nt.mission)||void 0===E||null===(M=E.current)||void 0===M?void 0:M.cdcr_validation_at)+"\n        ")])]):Nt._e(),Nt._v(" "),null!==(I=Nt.mission)&&void 0!==I&&null!==(L=I.current)&&void 0!==L&&L.cdcr_validation_at?Tt("div",{staticClass:"col-12 col-lg-4"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n          Validé par:\n        ")]),Nt._v(" "),Tt("span",[Nt._v("\n          "+Nt._s(null===(N=Nt.mission)||void 0===N||null===(T=N.current)||void 0===T||null===(V=T.cdcr_validator)||void 0===V?void 0:V.full_name)+"\n        ")])]):Nt._e(),Nt._v(" "),Tt("div",{staticClass:"col-12 col-lg-4 d-none d-lg-block"}),Nt._v(" "),null!==($=Nt.mission)&&void 0!==$&&null!==(F=$.current)&&void 0!==F&&F.dcp_validation_at?Tt("div",{staticClass:"col-12 col-lg-4"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n          2"),Tt("sup",[Nt._v("ème")]),Nt._v(" validation\n        ")]),Nt._v(" "),Tt("span",[Nt._v("\n          "+Nt._s(null===(U=Nt.mission)||void 0===U||null===(q=U.current)||void 0===q?void 0:q.dcp_validation_at)+"\n        ")])]):Nt._e(),Nt._v(" "),null!==(K=Nt.mission)&&void 0!==K&&null!==(B=K.current)&&void 0!==B&&B.dcp_validation_at?Tt("div",{staticClass:"col-12 col-lg-4"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n          Validé par:\n        ")]),Nt._v(" "),Tt("span",[Nt._v("\n          "+Nt._s(null===(Z=Nt.mission)||void 0===Z||null===(z=Z.current)||void 0===z||null===(H=z.dcp_validator)||void 0===H?void 0:H.full_name)+"\n        ")])]):Nt._e(),Nt._v(" "),Tt("div",{staticClass:"col-12"},[Tt("span",{staticClass:"text-bold"},[Nt._v("\n          Note:\n        ")]),Nt._v(" "),Tt("span",[Nt._v("\n          "+Nt._s((null===(W=Nt.mission)||void 0===W||null===(G=W.current)||void 0===G?void 0:G.note)||"-")+"\n        ")])])])]),Nt._v(" "),(null===(J=Nt.mission)||void 0===J||null===(Q=J.current)||void 0===Q?void 0:Q.remaining_days_before_start)>0?Tt("div",{staticClass:"box is-info"},[Nt._v("\n    Nous vous informons que la mission débutera le "),Tt("b",[Nt._v(Nt._s(null===(X=Nt.mission)||void 0===X||null===(Y=X.current)||void 0===Y?void 0:Y.start))]),Nt._v(" dans exactement "),Tt("b",[Nt._v(Nt._s(null===(tt=Nt.mission)||void 0===tt||null===(st=tt.current)||void 0===st?void 0:st.remaining_days_before_start_str))])]):Nt._e(),Nt._v(" "),Tt("div",{staticClass:"d-flex align-items gap-2"},[Tt("button",{staticClass:"btn btn-danger has-icon",on:{click:function(t){return Nt.exportReport(!1)}}},[Tt("i",{staticClass:"las la-file-pdf icon"}),Nt._v("\n      Exporter le rapport\n    ")]),Nt._v(" "),Tt("button",{staticClass:"btn btn-danger has-icon",on:{click:function(t){return Nt.exportReport(!0)}}},[Tt("i",{staticClass:"las la-eye icon"}),Nt._v("\n      Aperçu du rapport\n    ")]),Nt._v(" "),100!=(null===(nt=Nt.mission)||void 0===nt?void 0:nt.current.progress_status)||null!==(it=Nt.mission)&&void 0!==it&&it.current.dre_report||null===(ot=Nt.mission)||void 0===ot||null===(et=ot.current.opinion)||void 0===et||!et.is_validated||!Nt.can("create_dre_report")?Nt._e():Tt("button",{staticClass:"btn btn-info",on:{click:Nt.showReport}},[Nt._v("\n      Ajouter votre rapport\n    ")]),Nt._v(" "),100==(null===(rt=Nt.mission)||void 0===rt?void 0:rt.current.progress_status)&&null!==(at=Nt.mission)&&void 0!==at&&null!==(lt=at.current.opinion)&&void 0!==lt&&lt.is_validated&&(null===(ct=Nt.mission)||void 0===ct||null===(dt=ct.current.dre_report)||void 0===dt||!dt.is_validated)&&null!==(ut=Nt.mission)&&void 0!==ut&&ut.current.dre_report&&Nt.can("validate_dre_report")?Tt("button",{staticClass:"btn btn-success",on:{click:function(t){return t.preventDefault(),Nt.validateReport.apply(null,arguments)}}},[Nt._v("\n      Valider la mission\n    ")]):Nt._e(),Nt._v(" "),null!==(vt=Nt.mission)&&void 0!==vt&&vt.current.dre_report&&Nt.can("create_dre_report")?Tt("button",{staticClass:"btn btn-info",on:{click:Nt.showReport}},[Nt._v("\n      Rapport de la mission\n    ")]):Nt._e(),Nt._v(" "),100!=(null===(pt=Nt.mission)||void 0===pt?void 0:pt.current.progress_status)||null!==(mt=Nt.mission)&&void 0!==mt&&mt.current.controller_opinion_is_validated||null===(_t=Nt.mission)||void 0===_t||null===(ft=_t.current)||void 0===ft||!ft.controller_opinion_exist||!Nt.can("validate_opinion")?Nt._e():Tt("button",{staticClass:"btn btn-success",on:{click:function(t){return t.preventDefault(),Nt.validateOpinion.apply(null,arguments)}}},[Nt._v("\n      Valider la mission\n    ")]),Nt._v(" "),null!==(ht=Nt.mission)&&void 0!==ht&&ht.current.controller_opinion_exist||null!==(bt=Nt.mission)&&void 0!==bt&&null!==(gt=bt.current)&&void 0!==gt&&gt.dre_report_exist||100!=(null===(yt=Nt.mission)||void 0===yt?void 0:yt.current.progress_status)||!Nt.can("create_opinion")?Nt._e():Tt("button",{staticClass:"btn btn-info",on:{click:Nt.showOpinion}},[Nt._v("\n      Ajouter votre avis\n    ")]),Nt._v(" "),null!==(Ct=Nt.mission)&&void 0!==Ct&&null!==(wt=Ct.current.opinion)&&void 0!==wt&&wt.is_validated&&Nt.can("view_opinion")?Tt("button",{staticClass:"btn btn-info",on:{click:Nt.showOpinion}},[Nt._v("\n      Avis sur la mission\n    ")]):Nt._e(),Nt._v(" "),null===(kt=Nt.mission)||void 0===kt||null===(xt=kt.current)||void 0===xt||!xt.controller_opinion_exist||null!==(Ot=Nt.mission)&&void 0!==Ot&&null!==(St=Ot.current.opinion)&&void 0!==St&&St.is_validated||!Nt.can("create_opinion")?Nt._e():Tt("button",{staticClass:"btn btn-info",on:{click:Nt.showOpinion}},[Nt._v("\n      Avis sur la mission\n    ")]),Nt._v(" "),null!==(jt=Nt.mission)&&void 0!==jt&&jt.current.cdcr_validation_at||!Nt.can("make_first_validation")?Nt._e():Tt("button",{staticClass:"btn btn-success",on:{click:function(t){return t.preventDefault(),Nt.validateMission(1)}}},[Nt._v("\n      Valider la mission\n    ")]),Nt._v(" "),null!==(Pt=Nt.mission)&&void 0!==Pt&&Pt.current.cdcr_validation_at||!Nt.can("assign_mission_processing")?Nt._e():Tt("button",{staticClass:"btn btn-success",on:{click:function(t){return t.preventDefault(),Nt.showDispatchForm.apply(null,arguments)}}},[Nt._v("\n      Assigné\n    ")]),Nt._v(" "),null!==(Dt=Nt.mission)&&void 0!==Dt&&null!==(At=Dt.current.dre_report)&&void 0!==At&&At.is_validated&&Nt.can("make_first_validation,process_mission")?Tt("button",{staticClass:"btn btn-info",on:{click:Nt.showReport}},[Nt._v("\n      Rapport de la mission\n    ")]):Nt._e(),Nt._v(" "),null===(Rt=Nt.mission)||void 0===Rt||!Rt.current.cdcr_validation_at||null!==(Et=Nt.mission)&&void 0!==Et&&Et.current.dcp_validation_at||!Nt.can("make_second_validation")?Nt._e():Tt("button",{staticClass:"btn btn-success",on:{click:function(t){return t.preventDefault(),Nt.validateMission(2)}}},[Nt._v("\n      Valider la mission\n    ")]),Nt._v(" "),null!==(Mt=Nt.mission)&&void 0!==Mt&&null!==(It=Mt.current.dre_report)&&void 0!==It&&It.is_validated&&Nt.can("make_second_validation")?Tt("button",{staticClass:"btn btn-info",on:{click:Nt.showReport}},[Nt._v("\n      Rapport de la mission\n    ")]):Nt._e(),Nt._v(" "),Tt("div",{directives:[{name:"has-role",rawName:"v-has-role",value:"dg,cdrcp,da,cc",expression:"'dg,cdrcp,da,cc'"}]},[null!==(Lt=Nt.mission)&&void 0!==Lt&&Lt.current.cdcr_validation_at?Tt("button",{staticClass:"btn btn-info",on:{click:Nt.showReport}},[Nt._v("\n        Rapport de la mission\n      ")]):Nt._e()])]),Nt._v(" "),Tt("NLDatatable",{attrs:{title:"Processus de la mission",namespace:"missions",stateKey:"processes",config:Nt.config},on:{show:Nt.show},scopedSlots:Nt._u([{key:"actions",fn:function(t){var s,n,i;return[Nt.can("control_agency,view_mission_detail")&&(null===(s=Nt.mission)||void 0===s||null===(n=s.current)||void 0===n?void 0:n.remaining_days_before_start)<=0?Tt("button",{staticClass:"btn btn-info has-icon",on:{click:function(s){return s.stopPropagation(),Nt.details(t)}}},[t.item.progress_status<100&&(null===(i=Nt.mission)||void 0===i||!i.current.opinion)?Tt("i",{staticClass:"las la-tasks icon"}):Tt("i",{staticClass:"las la-list-alt icon"})]):Nt._e()]}}],null,!1,3042604947)}),Nt._v(" "),Tt("NLModal",{attrs:{show:Nt.rowSelected},on:{close:Nt.close},scopedSlots:Nt._u([{key:"title",fn:function(){var t,s,n;return[Tt("small",{staticClass:"tag is-info text-small"},[Nt._v("\n        "+Nt._s(null===(t=Nt.rowSelected)||void 0===t?void 0:t.familly)+"\n      ")]),Nt._v(" "),Tt("small",{staticClass:"tag is-primary-dark text-small mx-1"},[Nt._v("\n        "+Nt._s(null===(s=Nt.rowSelected)||void 0===s?void 0:s.domain)+"\n      ")]),Nt._v(" "),Tt("small",{staticClass:"tag is-warning text-small"},[Nt._v("\n        "+Nt._s(null===(n=Nt.rowSelected)||void 0===n?void 0:n.name)+"\n      ")])]},proxy:!0},{key:"default",fn:function(){var t;return[Tt("p",{staticClass:"text-bold mb-6"},[Nt._v("\n        Points de contrôle\n      ")]),Nt._v(" "),Tt("div",{staticClass:"grid list"},Nt._l(null===(t=Nt.rowSelected)||void 0===t?void 0:t.controlPoints,(function(t){return Tt("div",{key:t.id,staticClass:"col-12 list-item"},[Tt("div",{staticClass:"list-item-content"},[Nt._v("\n            "+Nt._s(t.label)+"\n          ")])])})),0)]},proxy:!0},Nt.can("edit_mission")?{key:"footer",fn:function(){var t;return[100==(null===(t=Nt.rowSelected)||void 0===t?void 0:t.progress_status)&&Nt.can("view_mission")?Tt("button",{staticClass:"btn btn-info has-icon",on:{click:function(t){return t.stopPropagation(),Nt.details(Nt.rowSelected)}}},[Tt("i",{staticClass:"las la-tasks icon"}),Nt._v("\n        Afficher\n      ")]):Nt.can("control_agency")?Tt("button",{staticClass:"btn btn-info has-icon",on:{click:function(t){return t.stopPropagation(),Nt.details(Nt.rowSelected)}}},[Tt("i",{staticClass:"las la-tasks icon"}),Nt._v("\n        Éffectuer\n      ")]):Nt._e()]},proxy:!0}:null],null,!0)}),Nt._v(" "),Tt("NLModal",{attrs:{show:Nt.modals.opinion},on:{close:function(t){Nt.modals.opinion=!1}},scopedSlots:Nt._u([{key:"title",fn:function(){return[Tt("h2",[Nt._v("Avis du contrôleur")])]},proxy:!0},{key:"default",fn:function(){var t,s,n,i,o;return[null===(t=Nt.mission)||void 0===t||!t.current.opinion||Nt.forms.opinion.edit_mode?Tt("form",{on:{submit:function(t){return t.preventDefault(),Nt.saveOpinion.apply(null,arguments)},keydown:function(t){return Nt.forms.opinion.onKeydown(t)}}},[Tt("div",{staticClass:"grid"},[Tt("div",{staticClass:"col-12"},[Tt("NLWyswyg",{attrs:{name:"opinion",form:Nt.forms.opinion,label:"Avis du contrôleur",labelRequired:""},model:{value:Nt.forms.opinion.opinion,callback:function(t){Nt.$set(Nt.forms.opinion,"opinion",t)},expression:"forms.opinion.opinion"}})],1),Nt._v(" "),Tt("div",{staticClass:"col-12"},[Tt("NLCheckbox",{attrs:{name:"validated",form:Nt.forms.opinion,label:"Validé la mission"},model:{value:Nt.forms.opinion.validated,callback:function(t){Nt.$set(Nt.forms.opinion,"validated",t)},expression:"forms.opinion.validated"}})],1)]),Nt._v(" "),Tt("div",{staticClass:"d-flex justify-end align-center"},[Tt("NLButton",{attrs:{loading:Nt.forms.opinion.busy,label:"Save"}})],1)]):Tt("div",{staticClass:"grid"},[Tt("div",{staticClass:"col-12",domProps:{innerHTML:Nt._s(null===(s=Nt.mission)||void 0===s?void 0:s.current.opinion.content)}}),Nt._v(" "),null!==(n=Nt.mission)&&void 0!==n&&null!==(i=n.current.opinion)&&void 0!==i&&i.is_validated?Tt("div",{staticClass:"col-12"},[Tt("b",[Nt._v("Validé le:")]),Nt._v(" "),Tt("time",[Nt._v(Nt._s(null===(o=Nt.mission)||void 0===o?void 0:o.current.opinion.validated_at))])]):Nt._e()])]},proxy:!0},{key:"footer",fn:function(){var t,s,n,i,o,e;return[null!==(t=Nt.mission)&&void 0!==t&&null!==(s=t.current.opinion)&&void 0!==s&&s.is_validated||null===(n=Nt.mission)||void 0===n||!n.current.opinion||Nt.forms.opinion.edit_mode||!Nt.can("create_opinion")?Nt._e():Tt("button",{staticClass:"btn btn-success has-icon",on:{click:function(t){return t.preventDefault(),Nt.validateOpinion.apply(null,arguments)}}},[Tt("i",{staticClass:"las la-check-circle icon"}),Nt._v("\n        Valider la mission\n      ")]),Nt._v(" "),null!==(i=Nt.mission)&&void 0!==i&&null!==(o=i.current.opinion)&&void 0!==o&&o.is_validated||null===(e=Nt.mission)||void 0===e||!e.current.opinion||Nt.forms.opinion.edit_mode||!Nt.can("create_opinion")?Nt._e():Tt("button",{staticClass:"btn btn-warning has-icon",on:{click:function(t){return t.preventDefault(),Nt.enableEdition("opinion")}}},[Tt("i",{staticClass:"las la-edit icon"}),Nt._v("\n        Editer l'avis\n      ")])]},proxy:!0}],null,!1,3674825186)}),Nt._v(" "),Tt("NLModal",{attrs:{show:Nt.modals.report},on:{close:function(t){Nt.modals.report=!1}},scopedSlots:Nt._u([{key:"title",fn:function(){return[Tt("h2",[Nt._v("Rapport du chef de département")])]},proxy:!0},{key:"default",fn:function(){var t,s,n,i,o;return[null===(t=Nt.mission)||void 0===t||!t.current.dre_report||Nt.forms.report.edit_mode?Tt("form",{on:{submit:function(t){return t.preventDefault(),Nt.saveReport.apply(null,arguments)},keydown:function(t){return Nt.forms.report.onKeydown(t)}}},[Tt("div",{staticClass:"grid"},[Tt("div",{staticClass:"col-12"},[Tt("NLWyswyg",{attrs:{name:"report",form:Nt.forms.report,label:"Rapport du chef de département",labelRequired:""},model:{value:Nt.forms.report.report,callback:function(t){Nt.$set(Nt.forms.report,"report",t)},expression:"forms.report.report"}})],1),Nt._v(" "),Tt("div",{staticClass:"col-12"},[Tt("NLCheckbox",{attrs:{name:"validated",form:Nt.forms.report,label:"Validé la mission"},model:{value:Nt.forms.report.validated,callback:function(t){Nt.$set(Nt.forms.report,"validated",t)},expression:"forms.report.validated"}})],1)]),Nt._v(" "),Tt("div",{staticClass:"d-flex justify-end align-center"},[Tt("NLButton",{attrs:{loading:Nt.forms.report.busy,label:"Save"}})],1)]):Tt("div",{staticClass:"grid"},[Tt("div",{staticClass:"col-12",domProps:{innerHTML:Nt._s(null===(s=Nt.mission)||void 0===s?void 0:s.current.dre_report.content)}}),Nt._v(" "),null!==(n=Nt.mission)&&void 0!==n&&null!==(i=n.current.dre_report)&&void 0!==i&&i.is_validated?Tt("div",{staticClass:"col-12"},[Tt("b",[Nt._v("Validé le:")]),Nt._v(" "),Tt("time",[Nt._v(Nt._s(null===(o=Nt.mission)||void 0===o?void 0:o.current.dre_report.validated_at))])]):Nt._e()])]},proxy:!0},{key:"footer",fn:function(){var t,s,n,i,o,e,r,a,l,c;return[null===(t=Nt.mission)||void 0===t||null===(s=t.current.opinion)||void 0===s||!s.is_validated||null===(n=Nt.mission)||void 0===n||!n.current.dre_report||null!==(i=Nt.mission)&&void 0!==i&&null!==(o=i.current.dre_report)&&void 0!==o&&o.is_validated||Nt.forms.report.edit_mode||!Nt.can("validate_dre_report")?Nt._e():Tt("button",{staticClass:"btn btn-success has-icon",on:{click:function(t){return t.preventDefault(),Nt.validateReport.apply(null,arguments)}}},[Tt("i",{staticClass:"las la-check-circle icon"}),Nt._v("\n        Valider la mission\n      ")]),Nt._v(" "),null===(e=Nt.mission)||void 0===e||null===(r=e.current.opinion)||void 0===r||!r.is_validated||null===(a=Nt.mission)||void 0===a||!a.current.dre_report||null!==(l=Nt.mission)&&void 0!==l&&null!==(c=l.current.dre_report)&&void 0!==c&&c.is_validated||Nt.forms.report.edit_mode||!Nt.can("create_dre_report")?Nt._e():Tt("button",{staticClass:"btn btn-warning has-icon",on:{click:function(t){return t.preventDefault(),Nt.enableEdition("report")}}},[Tt("i",{staticClass:"las la-edit icon"}),Nt._v("\n        Editer le rapport\n      ")])]},proxy:!0}],null,!1,2514394549)}),Nt._v(" "),Tt("NLModal",{attrs:{show:Nt.modals.dispatch},on:{close:function(t){Nt.modals.dispatch=!1}},scopedSlots:Nt._u([{key:"title",fn:function(){return[Tt("h2",[Nt._v("Assigné le traitement de la mission")])]},proxy:!0},{key:"default",fn:function(){return[Tt("form",{on:{submit:function(t){return t.preventDefault(),Nt.dispatchMission.apply(null,arguments)},keydown:function(t){return Nt.forms.dispatch.onKeydown(t)}}},[Tt("div",{staticClass:"grid"},[Tt("div",{staticClass:"col-12"},[Tt("NLSelect",{attrs:{name:"controllers",form:Nt.forms.dispatch,options:Nt.controllersList,label:"Contrôleurs",placeholder:"Choisissez un ou plusieurs contrôleurs",multiple:"",labelRequired:""},model:{value:Nt.forms.dispatch.controllers,callback:function(t){Nt.$set(Nt.forms.dispatch,"controllers",t)},expression:"forms.dispatch.controllers"}})],1)]),Nt._v(" "),Tt("div",{staticClass:"d-flex justify-end align-center"},[Tt("NLButton",{attrs:{loading:Nt.forms.dispatch.busy,label:"Save"}})],1)])]},proxy:!0}],null,!1,1055958166)})],1):Nt._e()}),[],!1,null,null,null).exports}}]);