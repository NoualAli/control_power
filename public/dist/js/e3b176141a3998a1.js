"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1277],{5714:(s,t,e)=>{e.d(t,{ZP:()=>w,l0:()=>g});var i=e(9669),n=e.n(i),o=Object.defineProperty,r=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.propertyIsEnumerable,c=(s,t,e)=>t in s?o(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,d=(s,t)=>{for(var e in t||(t={}))r.call(t,e)&&c(s,e,t[e]);if(a)for(var e of a(t))l.call(t,e)&&c(s,e,t[e]);return s};const u=s=>void 0===s,v=s=>Array.isArray(s),p=s=>s&&"number"==typeof s.size&&"string"==typeof s.type&&"function"==typeof s.slice,m=(s,t,e,i)=>((t=t||{}).indices=!u(t.indices)&&t.indices,t.nullsAsUndefineds=!u(t.nullsAsUndefineds)&&t.nullsAsUndefineds,t.booleansAsIntegers=!u(t.booleansAsIntegers)&&t.booleansAsIntegers,t.allowEmptyArrays=!u(t.allowEmptyArrays)&&t.allowEmptyArrays,e=e||new FormData,u(s)||(null===s?t.nullsAsUndefineds||e.append(i,""):(s=>"boolean"==typeof s)(s)?t.booleansAsIntegers?e.append(i,s?1:0):e.append(i,s):v(s)?s.length?s.forEach(((s,n)=>{const o=i+"["+(t.indices?n:"")+"]";m(s,t,e,o)})):t.allowEmptyArrays&&e.append(i+"[]",""):(s=>s instanceof Date)(s)?e.append(i,s.toISOString()):!(s=>s===Object(s))(s)||(s=>p(s)&&"string"==typeof s.name&&("object"==typeof s.lastModifiedDate||"number"==typeof s.lastModified))(s)||p(s)?e.append(i,s):Object.keys(s).forEach((n=>{const o=s[n];if(v(o))for(;n.length>2&&n.lastIndexOf("[]")===n.length-2;)n=n.substring(0,n.length-2);m(o,t,e,i?i+"["+n+"]":n)}))),e);var f={serialize:m};function _(s){if(null===s||"object"!=typeof s)return s;const t=Array.isArray(s)?[]:{};return Object.keys(s).forEach((e=>{t[e]=_(s[e])})),t}function h(s){return Array.isArray(s)?s:[s]}function b(s){return s instanceof File||s instanceof Blob||s instanceof FileList||"object"==typeof s&&null!==s&&void 0!==Object.values(s).find((s=>b(s)))}class y{constructor(){this.errors={},this.errors={}}set(s,t){"object"==typeof s?this.errors=s:this.set(d(d({},this.errors),{[s]:h(t)}))}all(){return this.errors}has(s){return Object.prototype.hasOwnProperty.call(this.errors,s)}hasAny(...s){return s.some((s=>this.has(s)))}any(){return Object.keys(this.errors).length>0}get(s){if(this.has(s))return this.getAll(s)[0]}getAll(s){return h(this.errors[s]||[])}only(...s){const t=[];return s.forEach((s=>{const e=this.get(s);e&&t.push(e)})),t}flatten(){return Object.values(this.errors).reduce(((s,t)=>s.concat(t)),[])}clear(s){const t={};s&&Object.keys(this.errors).forEach((e=>{e!==s&&(t[e]=this.errors[e])})),this.set(t)}}class g{constructor(s={}){this.originalData={},this.busy=!1,this.successful=!1,this.recentlySuccessful=!1,this.recentlySuccessfulTimeoutId=void 0,this.errors=new y,this.progress=void 0,this.update(s)}static make(s){return new this(s)}update(s){this.originalData=Object.assign({},this.originalData,_(s)),Object.assign(this,s)}fill(s={}){this.keys().forEach((t=>{this[t]=s[t]}))}data(){return this.keys().reduce(((s,t)=>d(d({},s),{[t]:this[t]})),{})}keys(){return Object.keys(this).filter((s=>!g.ignore.includes(s)))}startProcessing(){this.errors.clear(),this.busy=!0,this.successful=!1,this.progress=void 0,this.recentlySuccessful=!1,clearTimeout(this.recentlySuccessfulTimeoutId)}finishProcessing(){this.busy=!1,this.successful=!0,this.progress=void 0,this.recentlySuccessful=!0,this.recentlySuccessfulTimeoutId=setTimeout((()=>{this.recentlySuccessful=!1}),g.recentlySuccessfulTimeout)}clear(){this.errors.clear(),this.successful=!1,this.recentlySuccessful=!1,this.progress=void 0,clearTimeout(this.recentlySuccessfulTimeoutId)}reset(){Object.keys(this).filter((s=>!g.ignore.includes(s))).forEach((s=>{this[s]=_(this.originalData[s])}))}get(s,t={}){return this.submit("get",s,t)}post(s,t={}){return this.submit("post",s,t)}patch(s,t={}){return this.submit("patch",s,t)}put(s,t={}){return this.submit("put",s,t)}delete(s,t={}){return this.submit("delete",s,t)}submit(s,t,e={}){return this.startProcessing(),e=d({data:{},params:{},url:this.route(t),method:s,onUploadProgress:this.handleUploadProgress.bind(this)},e),"get"===s.toLowerCase()?e.params=d(d({},this.data()),e.params):(e.data=d(d({},this.data()),e.data),b(e.data)&&!e.transformRequest&&(e.transformRequest=[s=>f.serialize(s)])),new Promise(((s,t)=>{(g.axios||n()).request(e).then((t=>{this.finishProcessing(),s(t)})).catch((s=>{this.handleErrors(s),t(s)}))}))}handleErrors(s){this.busy=!1,this.progress=void 0,s.response&&this.errors.set(this.extractErrors(s.response))}extractErrors(s){return s.data&&"object"==typeof s.data?s.data.errors?d({},s.data.errors):s.data.message?{error:s.data.message}:d({},s.data):{error:g.errorMessage}}handleUploadProgress(s){this.progress={total:s.total,loaded:s.loaded,percentage:Math.round(100*s.loaded/s.total)}}route(s,t={}){let e=s;return Object.prototype.hasOwnProperty.call(g.routes,s)&&(e=decodeURI(g.routes[s])),"object"!=typeof t&&(t={id:t}),Object.keys(t).forEach((s=>{e=e.replace(`{${s}}`,t[s])})),e}onKeydown(s){const t=s.target;t.name&&this.errors.clear(t.name)}}g.routes={},g.errorMessage="Something went wrong. Please try again.",g.recentlySuccessfulTimeout=2e3,g.ignore=["busy","successful","errors","progress","originalData","recentlySuccessful","recentlySuccessfulTimeoutId"];const w=g},1277:(s,t,e)=>{e.r(t),e.d(t,{default:()=>u});var i=e(2097),n=e(629),o=e(2661),r=e(5714);function a(s){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},a(s)}function l(s,t){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(s,t).enumerable}))),e.push.apply(e,i)}return e}function c(s,t,e){return(t=function(s){var t=function(s,t){if("object"!==a(s)||null===s)return s;var e=s[Symbol.toPrimitive];if(void 0!==e){var i=e.call(s,t||"default");if("object"!==a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(s)}(s,"string");return"symbol"===a(t)?t:String(t)}(t))in s?Object.defineProperty(s,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[t]=e,s}const d={layout:"backend",middleware:["auth"],components:{NLDatatable:i.Z},data:function(){var s,t,e;return{controllersList:[],rowSelected:null,config:{data:null,namespace:"missions",state_key:"processes",rowKey:"id",columns:[{label:"Famille",field:"familly"},{label:"Domaine",field:"domain"},{label:"Processus",field:"name"},{label:"Total points de contrôle",field:"control_points_count"},{label:"Moyenne",field:"avg_score",methods:{style:function(s){var t=s.avg_score;return 1==t?"bg-success text-white text-bold":2==t?"bg-info text-white text-bold":3==t?"bg-warning text-bold":4==t?"bg-danger text-white text-bold":void 0}}},{label:"Progression",field:"progress_status",methods:{showField:function(s){return s.progress_status+"%"}}},{label:"Date d'exécution",field:"executed_at"},{label:"Date de traitement",field:"processed_at",hide:!(null!==(s=this.currentUser)&&void 0!==s&&s.authorizations.process_mission||null!==(t=this.currentUser)&&void 0!==t&&t.authorizations.assign_mission_processing||null!==(e=this.currentUser)&&void 0!==e&&e.authorizations.create_control_campaign)}],actions:{show:!0}},modals:{opinion:!1,report:!1,dispatch:!1},forms:{opinion:new r.l0({opinion:null,id:null,type:"Avis contrôleur",validated:!1,edit_mode:!0}),report:new r.l0({report:null,id:null,type:"Rapport",validated:!1,edit_mode:!0}),dispatch:new r.l0({controllers:null}),validations:{opinion:new r.l0({type:"Avis contrôleur"}),report:new r.l0({type:"Rapport"})}}}},breadcrumb:function(){var s,t;return{label:"Mission "+(null===(s=this.mission)||void 0===s||null===(t=s.current)||void 0===t?void 0:t.reference)}},computed:function(s){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?l(Object(e),!0).forEach((function(t){c(s,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):l(Object(e)).forEach((function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(e,t))}))}return s}({currentUser:function(){return localStorage.getItem("user")}},(0,n.Se)({mission:"missions/current",processes:"missions/processes",users:"users/all"})),created:function(){this.initData()},methods:{dispatchMission:function(){var s=this;this.forms.dispatch.put("/api/missions/"+this.mission.current.id+"/assign").then((function(t){t.data.status?(swal.toast_success(t.data.message),s.forms.dispatch.reset(),s.initData()):swal.alert_error(t.data.message)})).catch((function(s){console.log(s)}))},showDispatchForm:function(){var s=this;this.$store.dispatch("users/fetchAll",{roles_codes:"cc"}).then((function(){s.controllersList=s.users.all,s.forms.dispatch.controllers=s.mission.current.dcp_controllers.map((function(s){return s.id})),s.modals.dispatch=!0}))},saveReport:function(){var s=this;this.forms.report.post("/api/missions/reports/"+this.mission.current.id).then((function(t){t.data.status?(swal.toast_success(t.data.message),s.forms.opinion.reset(),s.initData()):swal.alert_error(t.data.message)})).catch((function(s){console.log(s)}))},validateReport:function(){var s=this;swal.confirm_update().then((function(t){t.isConfirmed&&s.forms.validations.report.put("/api/missions/reports/"+s.mission.current.id).then((function(t){t.data.status?(swal.toast_success(t.data.message),s.initData()):swal.alert_error(t.data.message)})).catch((function(s){console.log(s)}))}))},showReport:function(){this.modals.report=!0},showOpinion:function(){this.modals.opinion=!0},saveOpinion:function(){var s=this;this.forms.opinion.post("/api/missions/reports/"+this.mission.current.id).then((function(t){t.data.status?(swal.toast_success(t.data.message),s.forms.opinion.reset(),s.initData()):swal.alert_error(t.data.message)})).catch((function(s){console.log(s)}))},validateOpinion:function(){var s=this;swal.confirm_update().then((function(t){t.isConfirmed&&s.forms.validations.opinion.put("/api/missions/reports/"+s.mission.current.id).then((function(t){t.data.status?(swal.toast_success(t.data.message),s.initData()):swal.alert_error(t.data.message)})).catch((function(s){console.log(s)}))}))},enableEdition:function(s){"opinion"==s?(this.forms.opinion.edit_mode=!0,this.forms.opinion.opinion=this.mission.current.opinion.content,this.forms.opinion.id=this.mission.current.opinion.id):"report"==s&&(this.forms.report.edit_mode=!0,this.forms.report.report=this.mission.current.dre_report.content,this.forms.report.id=this.mission.current.dre_report.id)},initData:function(){var s=this;this.close(),this.$store.dispatch("missions/fetch",{missionId:this.$route.params.missionId}),this.$store.dispatch("missions/fetch",{missionId:this.$route.params.missionId,onlyProcesses:!0}).then((function(){return s.config.data=s.processes.processes})),this.forms.opinion.edit_mode=!1,this.forms.report.edit_mode=!1,this.modals.dispatch=!1},details:function(s){var t,e;s=null!==(t=s)&&void 0!==t&&null!==(e=t.item)&&void 0!==e&&e.id?s.item:s,this.$router.push({name:"missions-details",params:{missionId:this.mission.current.id,processId:s.id}})},destroy:function(){var s=this;swal.confirm_destroy().then((function(t){var e;t.isConfirmed&&o.Z.delete("missions/"+(null===(e=s.mission)||void 0===e?void 0:e.current.id)).then((function(t){t.data.status?(s.initData(),swal.toast_success(t.data.message)):swal.alert_error(t.data.message)})).catch((function(s){console.log(s)}))}))},show:function(s){this.rowSelected=s},close:function(){this.rowSelected=null}}};const u=(0,e(1900).Z)(d,(function(){var s,t,e,i,n,o,r,a,l,c,d,u,v,p,m,f,_,h,b,y,g,w,C,x,k,O,S,j,D,N,P,A,E,I,R,L,M,T,U,$,F,V,z,q,K,B,Z,H,W,G,J,Q,X,Y,ss,ts,es,is,ns,os,rs,as=this,ls=as._self._c;return ls("ContentBody",{directives:[{name:"can",rawName:"v-can",value:"view_mission",expression:"'view_mission'"}]},[ls("div",{staticClass:"d-flex justify-end align-center gap-3 my-2"},[ls("router-link",{directives:[{name:"can",rawName:"v-can",value:"view_mission",expression:"'view_mission'"}],staticClass:"btn",attrs:{to:{name:"campaign",params:{campaignId:null===(s=as.mission)||void 0===s?void 0:s.current.campaign.id}}}},[as._v("\n        Campagne de contrôle\n      ")]),as._v(" "),(null===(t=as.mission)||void 0===t||null===(e=t.current)||void 0===e?void 0:e.remaining_days_before_start)>5?ls("router-link",{directives:[{name:"can",rawName:"v-can",value:"edit_mission",expression:"'edit_mission'"}],staticClass:"btn btn-warning",attrs:{to:{name:"missions-edit",params:{missionId:null===(i=as.mission)||void 0===i?void 0:i.current.id}}}},[ls("i",{staticClass:"las la-edit icon"})]):as._e()],1),as._v(" "),ls("div",{staticClass:"box border-primary-dark border-1 mb-10"},[ls("div",{staticClass:"grid gap-6"},[ls("div",{staticClass:"col-4"},[ls("div",{staticClass:"grid gap-6"},[ls("div",{staticClass:"col-12"},[ls("span",{staticClass:"text-bold"},[as._v("\n                Mission:\n              ")]),as._v(" "),ls("span",[as._v("\n                "+as._s(null===(n=as.mission)||void 0===n||null===(o=n.current)||void 0===o?void 0:o.reference)+"\n              ")])]),as._v(" "),ls("div",{staticClass:"col-12"},[ls("span",{staticClass:"text-bold"},[as._v("\n                DRE:\n              ")]),as._v(" "),ls("span",[as._v("\n                "+as._s(null===(r=as.mission)||void 0===r||null===(a=r.current)||void 0===a?void 0:a.dre.full_name)+"\n              ")])]),as._v(" "),ls("div",{staticClass:"col-12"},[ls("span",{staticClass:"text-bold"},[as._v("\n                Agence:\n              ")]),as._v(" "),ls("span",[as._v("\n                "+as._s(null===(l=as.mission)||void 0===l||null===(c=l.current)||void 0===c?void 0:c.agency.full_name)+"\n              ")])])])]),as._v(" "),ls("div",{staticClass:"col-4"},[ls("div",{staticClass:"grid gap-6"},[ls("div",{staticClass:"col-12"},[ls("span",{staticClass:"text-bold"},[as._v("\n                Campagne:\n              ")]),as._v(" "),ls("span",[as._v("\n                "+as._s(null===(d=as.mission)||void 0===d||null===(u=d.current)||void 0===u?void 0:u.campaign.reference)+"\n              ")])]),as._v(" "),ls("div",{staticClass:"col-12"},[ls("span",{staticClass:"text-bold"},[as._v("\n                Début:\n              ")]),as._v(" "),ls("span",[as._v("\n                "+as._s((null===(v=as.mission)||void 0===v||null===(p=v.current)||void 0===p?void 0:p.start)+" / "+(null===(m=as.mission)||void 0===m||null===(f=m.current)||void 0===f?void 0:f.remaining_days_before_start_str))+"\n              ")])]),as._v(" "),ls("div",{staticClass:"col-12"},[ls("span",{staticClass:"text-bold"},[as._v("\n                Fin:\n              ")]),as._v(" "),ls("span",[as._v("\n                "+as._s((null===(_=as.mission)||void 0===_||null===(h=_.current)||void 0===h?void 0:h.end)+" / "+(null===(b=as.mission)||void 0===b||null===(y=b.current)||void 0===y?void 0:y.remaining_days_before_end_str))+"\n              ")])])])]),as._v(" "),ls("div",{staticClass:"col-4"},[ls("div",{staticClass:"grid gap-6"},[ls("div",{staticClass:"col-12"},[ls("span",{staticClass:"text-bold"},[as._v("\n                Contrôleurs dre:\n              ")]),as._v(" "),ls("span",[ls("ul",{staticClass:"d-inline-block ml-6"},as._l(null===(g=as.mission)||void 0===g||null===(w=g.current)||void 0===w?void 0:w.agency_controllers,(function(s){return ls("li",{key:"dre_controller-"+s.id},[as._v("\n                    "+as._s(s.full_name)+"\n                  ")])})),0)])]),as._v(" "),ls("div",{staticClass:"col-12"},[ls("span",{staticClass:"text-bold"},[as._v("\n                Contrôleurs dcp:\n              ")]),as._v(" "),ls("span",[ls("ul",{staticClass:"d-inline-block ml-6"},as._l(null===(C=as.mission)||void 0===C||null===(x=C.current)||void 0===x?void 0:x.dcp_controllers,(function(s){return ls("li",{key:"dcp-controller-"+s.id},[as._v("\n                    "+as._s(s.full_name)+"\n                  ")])})),0)])])])]),as._v(" "),ls("div",{staticClass:"col-12 col-lg-4"},[ls("span",{staticClass:"text-bold"},[as._v("\n            Moyenne:\n          ")]),as._v(" "),ls("span",[as._v("\n            "+as._s(null===(k=as.mission)||void 0===k||null===(O=k.current)||void 0===O?void 0:O.avg_score)+"\n          ")])]),as._v(" "),ls("div",{staticClass:"col-12 col-lg-4"},[ls("span",{staticClass:"text-bold"},[as._v("\n            Progression:\n          ")]),as._v(" "),ls("span",[as._v("\n            "+as._s(null===(S=as.mission)||void 0===S||null===(j=S.current)||void 0===j?void 0:j.progress_status)+"%\n          ")])]),as._v(" "),ls("div",{staticClass:"col-12 col-lg-4"},[ls("span",{staticClass:"text-bold"},[as._v("\n            Statut:\n          ")]),as._v(" "),ls("span",[as._v("\n            "+as._s(null===(D=as.mission)||void 0===D||null===(N=D.current)||void 0===N?void 0:N.realisation_state)+"\n          ")])]),as._v(" "),ls("div",{staticClass:"col-12"},[ls("span",{staticClass:"text-bold"},[as._v("\n            Note:\n          ")]),as._v(" "),ls("span",[as._v("\n            "+as._s((null===(P=as.mission)||void 0===P||null===(A=P.current)||void 0===A?void 0:A.note)||"-")+"\n          ")])])])]),as._v(" "),ls("div",{staticClass:"d-flex justify-between align-items"},[ls("div",[null!==(E=as.mission)&&void 0!==E&&E.current.opinion||null!==(I=as.mission)&&void 0!==I&&I.current.dre_report||100!=(null===(R=as.mission)||void 0===R?void 0:R.current.progress_status)?as._e():ls("button",{directives:[{name:"can",rawName:"v-can",value:"create_opinion",expression:"'create_opinion'"}],staticClass:"btn btn-info",on:{click:as.showOpinion}},[as._v("\n          Ajouter votre avis\n        ")]),as._v(" "),100!=(null===(L=as.mission)||void 0===L?void 0:L.current.progress_status)||null!==(M=as.mission)&&void 0!==M&&null!==(T=M.current.opinion)&&void 0!==T&&T.is_validated||null===(U=as.mission)||void 0===U||!U.current.opinion?as._e():ls("button",{directives:[{name:"can",rawName:"v-can",value:"validate_opinion",expression:"'validate_opinion'"}],staticClass:"btn btn-success",on:{click:function(s){return s.preventDefault(),as.validateOpinion.apply(null,arguments)}}},[as._v("\n          Valider la mission\n        ")]),as._v(" "),100!=(null===($=as.mission)||void 0===$?void 0:$.current.progress_status)||null!==(F=as.mission)&&void 0!==F&&F.current.dre_report||null===(V=as.mission)||void 0===V||null===(z=V.current.opinion)||void 0===z||!z.is_validated?as._e():ls("button",{directives:[{name:"can",rawName:"v-can",value:"create_dre_report",expression:"'create_dre_report'"}],staticClass:"btn btn-info",on:{click:as.showReport}},[as._v("\n          Ajouter votre rapport\n        ")]),as._v(" "),null!==(q=as.mission)&&void 0!==q&&null!==(K=q.current.dre_report)&&void 0!==K&&K.is_validated?ls("button",{directives:[{name:"can",rawName:"v-can",value:"assign_mission_processing",expression:"'assign_mission_processing'"}],staticClass:"btn btn-success",on:{click:function(s){return s.preventDefault(),as.showDispatchForm.apply(null,arguments)}}},[as._v("\n          Assigné\n        ")]):as._e(),as._v(" "),100!=(null===(B=as.mission)||void 0===B?void 0:B.current.progress_status)||null===(Z=as.mission)||void 0===Z||null===(H=Z.current.opinion)||void 0===H||!H.is_validated||null!==(W=as.mission)&&void 0!==W&&null!==(G=W.current.dre_report)&&void 0!==G&&G.is_validated||null===(J=as.mission)||void 0===J||!J.current.dre_report?as._e():ls("button",{directives:[{name:"can",rawName:"v-can",value:"validate_dre_report",expression:"'validate_dre_report'"}],staticClass:"btn btn-success",on:{click:function(s){return s.preventDefault(),as.validateReport.apply(null,arguments)}}},[as._v("\n          Valider la mission\n        ")]),as._v(" "),null!==(Q=as.mission)&&void 0!==Q&&Q.current.dre_report?ls("button",{directives:[{name:"can",rawName:"v-can",value:"view_dre_report",expression:"'view_dre_report'"},{name:"is-current-user",rawName:"v-is-current-user",value:null===(X=as.mission)||void 0===X?void 0:X.current.dre_report.created_by_id,expression:"mission?.current.dre_report.created_by_id"}],staticClass:"btn btn-info",on:{click:as.showReport}},[as._v("\n          Rapport de la mission\n        ")]):as._e(),as._v(" "),null!==(Y=as.mission)&&void 0!==Y&&null!==(ss=Y.current.dre_report)&&void 0!==ss&&ss.is_validated?ls("button",{directives:[{name:"can",rawName:"v-can",value:"view_dre_report",expression:"'view_dre_report'"},{name:"is-not-current-user",rawName:"v-is-not-current-user",value:null===(ts=as.mission)||void 0===ts?void 0:ts.current.dre_report.created_by_id,expression:"mission?.current.dre_report.created_by_id"}],staticClass:"btn btn-info",on:{click:as.showReport}},[as._v("\n          Rapport de la mission\n        ")]):as._e(),as._v(" "),null!==(es=as.mission)&&void 0!==es&&null!==(is=es.current.opinion)&&void 0!==is&&is.is_validated?ls("button",{directives:[{name:"can",rawName:"v-can",value:"view_opinion",expression:"'view_opinion'"},{name:"is-not-current-user",rawName:"v-is-not-current-user",value:null===(ns=as.mission)||void 0===ns?void 0:ns.current.opinion.created_by_id,expression:"mission?.current.opinion.created_by_id"}],staticClass:"btn btn-info",on:{click:as.showOpinion}},[as._v("\n          Avis sur la mission\n        ")]):as._e(),as._v(" "),null!==(os=as.mission)&&void 0!==os&&os.current.opinion?ls("button",{directives:[{name:"can",rawName:"v-can",value:"view_opinion",expression:"'view_opinion'"},{name:"is-current-user",rawName:"v-is-current-user",value:null===(rs=as.mission)||void 0===rs?void 0:rs.current.opinion.created_by_id,expression:"mission?.current.opinion.created_by_id"}],staticClass:"btn btn-info",on:{click:as.showOpinion}},[as._v("\n          Avis sur la mission\n        ")]):as._e()])]),as._v(" "),ls("NLDatatable",{attrs:{title:"Processus de la mission",namespace:"missions",stateKey:"processes",config:as.config},on:{show:as.show},scopedSlots:as._u([{key:"actions",fn:function(s){var t;return[ls("button",{directives:[{name:"can",rawName:"v-can",value:"control_agency,view_mission_detail",expression:"'control_agency,view_mission_detail'"}],staticClass:"btn btn-info has-icon",on:{click:function(t){return t.stopPropagation(),as.details(s)}}},[s.item.progress_status<100&&(null===(t=as.mission)||void 0===t||!t.current.opinion)?ls("i",{staticClass:"las la-tasks icon"}):ls("i",{staticClass:"las la-list-alt icon"})])]}}])}),as._v(" "),ls("NLModal",{attrs:{show:as.rowSelected},on:{close:as.close},scopedSlots:as._u([{key:"title",fn:function(){var s,t,e;return[ls("small",{staticClass:"tag is-info text-small"},[as._v("\n          "+as._s(null===(s=as.rowSelected)||void 0===s?void 0:s.familly)+"\n        ")]),as._v(" "),ls("small",{staticClass:"tag is-primary-dark text-small mx-1"},[as._v("\n          "+as._s(null===(t=as.rowSelected)||void 0===t?void 0:t.domain)+"\n        ")]),as._v(" "),ls("small",{staticClass:"tag is-warning text-small"},[as._v("\n          "+as._s(null===(e=as.rowSelected)||void 0===e?void 0:e.name)+"\n        ")])]},proxy:!0},{key:"default",fn:function(){var s;return[ls("p",{staticClass:"text-bold mb-6"},[as._v("\n          Points de contrôle\n        ")]),as._v(" "),ls("div",{staticClass:"grid list"},as._l(null===(s=as.rowSelected)||void 0===s?void 0:s.controlPoints,(function(s){return ls("div",{key:s.id,staticClass:"col-12 list-item"},[ls("div",{staticClass:"list-item-content"},[as._v("\n              "+as._s(s.name)+"\n            ")])])})),0)]},proxy:!0},{key:"footer",fn:function(){var s;return[100==(null===(s=as.rowSelected)||void 0===s?void 0:s.progress_status)?ls("button",{directives:[{name:"can",rawName:"v-can",value:"view_mission",expression:"'view_mission'"}],staticClass:"btn btn-info has-icon",on:{click:function(s){return s.stopPropagation(),as.details(as.rowSelected)}}},[ls("i",{staticClass:"las la-tasks icon"}),as._v("\n          Afficher\n        ")]):ls("button",{directives:[{name:"can",rawName:"v-can",value:"control_agency",expression:"'control_agency'"}],staticClass:"btn btn-info has-icon",on:{click:function(s){return s.stopPropagation(),as.details(as.rowSelected)}}},[ls("i",{staticClass:"las la-tasks icon"}),as._v("\n          Éffectuer\n        ")])]},proxy:!0}])}),as._v(" "),ls("NLModal",{attrs:{show:as.modals.opinion},on:{close:function(s){as.modals.opinion=!1}},scopedSlots:as._u([{key:"title",fn:function(){return[ls("h2",[as._v("Avis du contrôleur")])]},proxy:!0},{key:"default",fn:function(){var s,t,e,i,n;return[null===(s=as.mission)||void 0===s||!s.current.opinion||as.forms.opinion.edit_mode?ls("form",{on:{submit:function(s){return s.preventDefault(),as.saveOpinion.apply(null,arguments)},keydown:function(s){return as.forms.opinion.onKeydown(s)}}},[ls("div",{staticClass:"grid"},[ls("div",{staticClass:"col-12"},[ls("NLWyswyg",{attrs:{name:"opinion",form:as.forms.opinion,label:"Avis du contrôleur",labelRequired:""},model:{value:as.forms.opinion.opinion,callback:function(s){as.$set(as.forms.opinion,"opinion",s)},expression:"forms.opinion.opinion"}})],1),as._v(" "),ls("div",{staticClass:"col-12"},[ls("NLCheckbox",{attrs:{name:"validated",form:as.forms.opinion,label:"Validé la mission"},model:{value:as.forms.opinion.validated,callback:function(s){as.$set(as.forms.opinion,"validated",s)},expression:"forms.opinion.validated"}})],1)]),as._v(" "),ls("div",{staticClass:"d-flex justify-end align-center"},[ls("NLButton",{attrs:{loading:as.forms.opinion.busy,label:"Save"}})],1)]):ls("div",{staticClass:"grid"},[ls("div",{staticClass:"col-12",domProps:{innerHTML:as._s(null===(t=as.mission)||void 0===t?void 0:t.current.opinion.content)}}),as._v(" "),null!==(e=as.mission)&&void 0!==e&&null!==(i=e.current.opinion)&&void 0!==i&&i.is_validated?ls("div",{staticClass:"col-12"},[ls("b",[as._v("Validé le:")]),as._v(" "),ls("time",[as._v(as._s(null===(n=as.mission)||void 0===n?void 0:n.current.opinion.validated_at))])]):as._e()])]},proxy:!0},{key:"footer",fn:function(){var s,t,e,i,n,o;return[null!==(s=as.mission)&&void 0!==s&&null!==(t=s.current.opinion)&&void 0!==t&&t.is_validated||null===(e=as.mission)||void 0===e||!e.current.opinion||as.forms.opinion.edit_mode?as._e():ls("button",{directives:[{name:"can",rawName:"v-can",value:"create_opinion",expression:"'create_opinion'"}],staticClass:"btn btn-success has-icon",on:{click:function(s){return s.preventDefault(),as.validateOpinion.apply(null,arguments)}}},[ls("i",{staticClass:"las la-check-circle icon"}),as._v("\n          Valider la mission\n        ")]),as._v(" "),null!==(i=as.mission)&&void 0!==i&&null!==(n=i.current.opinion)&&void 0!==n&&n.is_validated||null===(o=as.mission)||void 0===o||!o.current.opinion||as.forms.opinion.edit_mode?as._e():ls("button",{directives:[{name:"can",rawName:"v-can",value:"create_opinion",expression:"'create_opinion'"}],staticClass:"btn btn-warning has-icon",on:{click:function(s){return s.preventDefault(),as.enableEdition("opinion")}}},[ls("i",{staticClass:"las la-edit icon"}),as._v("\n          Editer l'avis\n        ")])]},proxy:!0}])}),as._v(" "),ls("NLModal",{attrs:{show:as.modals.report},on:{close:function(s){as.modals.report=!1}},scopedSlots:as._u([{key:"title",fn:function(){return[ls("h2",[as._v("Rapport du chef de département")])]},proxy:!0},{key:"default",fn:function(){var s,t,e,i,n;return[null===(s=as.mission)||void 0===s||!s.current.dre_report||as.forms.report.edit_mode?ls("form",{on:{submit:function(s){return s.preventDefault(),as.saveReport.apply(null,arguments)},keydown:function(s){return as.forms.report.onKeydown(s)}}},[ls("div",{staticClass:"grid"},[ls("div",{staticClass:"col-12"},[ls("NLWyswyg",{attrs:{name:"report",form:as.forms.report,label:"Rapport du chef de département",labelRequired:""},model:{value:as.forms.report.report,callback:function(s){as.$set(as.forms.report,"report",s)},expression:"forms.report.report"}})],1),as._v(" "),ls("div",{staticClass:"col-12"},[ls("NLCheckbox",{attrs:{name:"validated",form:as.forms.report,label:"Validé la mission"},model:{value:as.forms.report.validated,callback:function(s){as.$set(as.forms.report,"validated",s)},expression:"forms.report.validated"}})],1)]),as._v(" "),ls("div",{staticClass:"d-flex justify-end align-center"},[ls("NLButton",{attrs:{loading:as.forms.report.busy,label:"Save"}})],1)]):ls("div",{staticClass:"grid"},[ls("div",{staticClass:"col-12",domProps:{innerHTML:as._s(null===(t=as.mission)||void 0===t?void 0:t.current.dre_report.content)}}),as._v(" "),null!==(e=as.mission)&&void 0!==e&&null!==(i=e.current.dre_report)&&void 0!==i&&i.is_validated?ls("div",{staticClass:"col-12"},[ls("b",[as._v("Validé le:")]),as._v(" "),ls("time",[as._v(as._s(null===(n=as.mission)||void 0===n?void 0:n.current.dre_report.validated_at))])]):as._e()])]},proxy:!0},{key:"footer",fn:function(){var s,t,e,i,n,o;return[null!==(s=as.mission)&&void 0!==s&&null!==(t=s.current.dre_report)&&void 0!==t&&t.is_validated||null===(e=as.mission)||void 0===e||!e.current.dre_report||as.forms.report.edit_mode?as._e():ls("button",{directives:[{name:"can",rawName:"v-can",value:"validate_dre_report",expression:"'validate_dre_report'"}],staticClass:"btn btn-success has-icon",on:{click:function(s){return s.preventDefault(),as.validateReport.apply(null,arguments)}}},[ls("i",{staticClass:"las la-check-circle icon"}),as._v("\n          Valider la mission\n        ")]),as._v(" "),null!==(i=as.mission)&&void 0!==i&&null!==(n=i.current.dre_report)&&void 0!==n&&n.is_validated||null===(o=as.mission)||void 0===o||!o.current.dre_report||as.forms.report.edit_mode?as._e():ls("button",{directives:[{name:"can",rawName:"v-can",value:"create_dre_report",expression:"'create_dre_report'"}],staticClass:"btn btn-warning has-icon",on:{click:function(s){return s.preventDefault(),as.enableEdition("report")}}},[ls("i",{staticClass:"las la-edit icon"}),as._v("\n          Editer le rapport\n        ")])]},proxy:!0}])}),as._v(" "),ls("NLModal",{attrs:{show:as.modals.dispatch},on:{close:function(s){as.modals.dispatch=!1}},scopedSlots:as._u([{key:"title",fn:function(){return[ls("h2",[as._v("Assigné le traitement de la mission")])]},proxy:!0},{key:"default",fn:function(){return[ls("form",{on:{submit:function(s){return s.preventDefault(),as.dispatchMission.apply(null,arguments)},keydown:function(s){return as.forms.dispatch.onKeydown(s)}}},[ls("div",{staticClass:"grid"},[ls("div",{staticClass:"col-12"},[ls("NLSelect",{attrs:{name:"controllers",form:as.forms.dispatch,options:as.controllersList,label:"Contrôleurs",placeholder:"Choisissez un ou plusieurs contrôleurs",multiple:"",labelRequired:""},model:{value:as.forms.dispatch.controllers,callback:function(s){as.$set(as.forms.dispatch,"controllers",s)},expression:"forms.dispatch.controllers"}})],1)]),as._v(" "),ls("div",{staticClass:"d-flex justify-end align-center"},[ls("NLButton",{attrs:{loading:as.forms.dispatch.busy,label:"Save"}})],1)])]},proxy:!0}])})],1)}),[],!1,null,null,null).exports}}]);