"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2751],{5714:(t,s,i)=>{i.d(s,{ZP:()=>C,l0:()=>y});var n=i(9669),o=i.n(n),e=Object.defineProperty,r=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.propertyIsEnumerable,c=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,d=(t,s)=>{for(var i in s||(s={}))r.call(s,i)&&c(t,i,s[i]);if(a)for(var i of a(s))l.call(s,i)&&c(t,i,s[i]);return t};const u=t=>void 0===t,v=t=>Array.isArray(t),p=t=>t&&"number"==typeof t.size&&"string"==typeof t.type&&"function"==typeof t.slice,m=(t,s,i,n)=>((s=s||{}).indices=!u(s.indices)&&s.indices,s.nullsAsUndefineds=!u(s.nullsAsUndefineds)&&s.nullsAsUndefineds,s.booleansAsIntegers=!u(s.booleansAsIntegers)&&s.booleansAsIntegers,s.allowEmptyArrays=!u(s.allowEmptyArrays)&&s.allowEmptyArrays,i=i||new FormData,u(t)||(null===t?s.nullsAsUndefineds||i.append(n,""):(t=>"boolean"==typeof t)(t)?s.booleansAsIntegers?i.append(n,t?1:0):i.append(n,t):v(t)?t.length?t.forEach(((t,o)=>{const e=n+"["+(s.indices?o:"")+"]";m(t,s,i,e)})):s.allowEmptyArrays&&i.append(n+"[]",""):(t=>t instanceof Date)(t)?i.append(n,t.toISOString()):!(t=>t===Object(t))(t)||(t=>p(t)&&"string"==typeof t.name&&("object"==typeof t.lastModifiedDate||"number"==typeof t.lastModified))(t)||p(t)?i.append(n,t):Object.keys(t).forEach((o=>{const e=t[o];if(v(e))for(;o.length>2&&o.lastIndexOf("[]")===o.length-2;)o=o.substring(0,o.length-2);m(e,s,i,n?n+"["+o+"]":o)}))),i);var _={serialize:m};function f(t){if(null===t||"object"!=typeof t)return t;const s=Array.isArray(t)?[]:{};return Object.keys(t).forEach((i=>{s[i]=f(t[i])})),s}function h(t){return Array.isArray(t)?t:[t]}function b(t){return t instanceof File||t instanceof Blob||t instanceof FileList||"object"==typeof t&&null!==t&&void 0!==Object.values(t).find((t=>b(t)))}class g{constructor(){this.errors={},this.errors={}}set(t,s){"object"==typeof t?this.errors=t:this.set(d(d({},this.errors),{[t]:h(s)}))}all(){return this.errors}has(t){return Object.prototype.hasOwnProperty.call(this.errors,t)}hasAny(...t){return t.some((t=>this.has(t)))}any(){return Object.keys(this.errors).length>0}get(t){if(this.has(t))return this.getAll(t)[0]}getAll(t){return h(this.errors[t]||[])}only(...t){const s=[];return t.forEach((t=>{const i=this.get(t);i&&s.push(i)})),s}flatten(){return Object.values(this.errors).reduce(((t,s)=>t.concat(s)),[])}clear(t){const s={};t&&Object.keys(this.errors).forEach((i=>{i!==t&&(s[i]=this.errors[i])})),this.set(s)}}class y{constructor(t={}){this.originalData={},this.busy=!1,this.successful=!1,this.recentlySuccessful=!1,this.recentlySuccessfulTimeoutId=void 0,this.errors=new g,this.progress=void 0,this.update(t)}static make(t){return new this(t)}update(t){this.originalData=Object.assign({},this.originalData,f(t)),Object.assign(this,t)}fill(t={}){this.keys().forEach((s=>{this[s]=t[s]}))}data(){return this.keys().reduce(((t,s)=>d(d({},t),{[s]:this[s]})),{})}keys(){return Object.keys(this).filter((t=>!y.ignore.includes(t)))}startProcessing(){this.errors.clear(),this.busy=!0,this.successful=!1,this.progress=void 0,this.recentlySuccessful=!1,clearTimeout(this.recentlySuccessfulTimeoutId)}finishProcessing(){this.busy=!1,this.successful=!0,this.progress=void 0,this.recentlySuccessful=!0,this.recentlySuccessfulTimeoutId=setTimeout((()=>{this.recentlySuccessful=!1}),y.recentlySuccessfulTimeout)}clear(){this.errors.clear(),this.successful=!1,this.recentlySuccessful=!1,this.progress=void 0,clearTimeout(this.recentlySuccessfulTimeoutId)}reset(){Object.keys(this).filter((t=>!y.ignore.includes(t))).forEach((t=>{this[t]=f(this.originalData[t])}))}get(t,s={}){return this.submit("get",t,s)}post(t,s={}){return this.submit("post",t,s)}patch(t,s={}){return this.submit("patch",t,s)}put(t,s={}){return this.submit("put",t,s)}delete(t,s={}){return this.submit("delete",t,s)}submit(t,s,i={}){return this.startProcessing(),i=d({data:{},params:{},url:this.route(s),method:t,onUploadProgress:this.handleUploadProgress.bind(this)},i),"get"===t.toLowerCase()?i.params=d(d({},this.data()),i.params):(i.data=d(d({},this.data()),i.data),b(i.data)&&!i.transformRequest&&(i.transformRequest=[t=>_.serialize(t)])),new Promise(((t,s)=>{(y.axios||o()).request(i).then((s=>{this.finishProcessing(),t(s)})).catch((t=>{this.handleErrors(t),s(t)}))}))}handleErrors(t){this.busy=!1,this.progress=void 0,t.response&&this.errors.set(this.extractErrors(t.response))}extractErrors(t){return t.data&&"object"==typeof t.data?t.data.errors?d({},t.data.errors):t.data.message?{error:t.data.message}:d({},t.data):{error:y.errorMessage}}handleUploadProgress(t){this.progress={total:t.total,loaded:t.loaded,percentage:Math.round(100*t.loaded/t.total)}}route(t,s={}){let i=t;return Object.prototype.hasOwnProperty.call(y.routes,t)&&(i=decodeURI(y.routes[t])),"object"!=typeof s&&(s={id:s}),Object.keys(s).forEach((t=>{i=i.replace(`{${t}}`,s[t])})),i}onKeydown(t){const s=t.target;s.name&&this.errors.clear(s.name)}}y.routes={},y.errorMessage="Something went wrong. Please try again.",y.recentlySuccessfulTimeout=2e3,y.ignore=["busy","successful","errors","progress","originalData","recentlySuccessful","recentlySuccessfulTimeoutId"];const C=y},2751:(t,s,i)=>{i.r(s),i.d(s,{default:()=>v});var n=i(8056),o=i(629),e=i(2661),r=i(5714),a=i(7565);function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function c(t,s){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);s&&(n=n.filter((function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),i.push.apply(i,n)}return i}function d(t,s,i){return(s=function(t){var s=function(t,s){if("object"!==l(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,s||"default");if("object"!==l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(t)}(t,"string");return"symbol"===l(s)?s:String(s)}(s))in t?Object.defineProperty(t,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[s]=i,t}const u={layout:"backend",middleware:["auth"],components:{NLDatatable:n.Z},data:function(){return{controllersList:[],rowSelected:null,config:{data:null,namespace:"missions",state_key:"processes",rowKey:"id",columns:[{label:"Famille",field:"familly"},{label:"Domaine",field:"domain"},{label:"Processus",field:"name"},{label:"Total points de contrôle",field:"control_points_count"},{label:"Moyenne",field:"avg_score",hide:!(0,a.nu)(["dcp","cdcr","cc"]),methods:{style:function(t){var s=t.avg_score;return 1==s?"bg-success text-white text-bold":2==s?"bg-info text-white text-bold":3==s?"bg-warning text-bold":4==s?"bg-danger text-white text-bold":void 0}}}],actions:{show:!0}},modals:{opinion:!1,report:!1,dispatch:!1},forms:{opinion:new r.l0({opinion:null,id:null,type:"Avis contrôleur",validated:!1,edit_mode:!0}),report:new r.l0({report:null,id:null,type:"Rapport",validated:!1,edit_mode:!0}),dispatch:new r.l0({controllers:null}),validations:{opinion:new r.l0({type:"Avis contrôleur"}),report:new r.l0({type:"Rapport"})}}}},breadcrumb:function(){var t,s;return{label:"Mission "+(null===(t=this.mission)||void 0===t||null===(s=t.current)||void 0===s?void 0:s.reference)}},computed:function(t){for(var s=1;s<arguments.length;s++){var i=null!=arguments[s]?arguments[s]:{};s%2?c(Object(i),!0).forEach((function(s){d(t,s,i[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))}))}return t}({},(0,o.Se)({mission:"missions/current",processes:"missions/processes",controlPoints:"processes/controlPoints",users:"users/all"})),created:function(){this.initData()},methods:{validateMission:function(t){var s=this;swal.confirm({title:"Mission "+this.mission.current.reference,message:"Vous êtes sur de vouloir valider la mission "+this.mission.current.reference}).then((function(i){i.isConfirmed&&e.Z.post("missions/"+s.mission.current.id+"/validate/"+t).then((function(t){swal.toast_success(t.data.message),s.initData()})).catch((function(t){console.log(t)}))}))},dispatchMission:function(){var t=this;this.forms.dispatch.put("/api/missions/"+this.mission.current.id+"/assign").then((function(s){s.data.status?(swal.toast_success(s.data.message),t.forms.dispatch.reset(),t.initData()):swal.alert_error(s.data.message)})).catch((function(t){console.log(t)}))},showDispatchForm:function(){var t=this;this.$store.dispatch("users/fetchAll",{roles_codes:"cc"}).then((function(){t.controllersList=t.users.all,t.forms.dispatch.controllers=t.mission.current.dcp_controllers.map((function(t){return t.id})),t.modals.dispatch=!0}))},saveReport:function(){var t=this;this.forms.report.post("/api/missions/reports/"+this.mission.current.id).then((function(s){s.data.status?(swal.toast_success(s.data.message),t.forms.opinion.reset(),t.initData()):swal.alert_error(s.data.message)})).catch((function(t){console.log(t)}))},validateReport:function(){var t=this;swal.confirm({title:"Mission "+this.mission.current.reference,message:"Vous êtes sur de vouloir valider la mission "+this.mission.current.reference}).then((function(s){s.isConfirmed&&t.forms.validations.report.put("/api/missions/reports/"+t.mission.current.id).then((function(s){s.data.status?(swal.toast_success(s.data.message),t.initData()):swal.alert_error(s.data.message)})).catch((function(t){console.log(t)}))}))},showReport:function(){this.modals.report=!0},showOpinion:function(){this.modals.opinion=!0},saveOpinion:function(){var t=this;this.forms.opinion.post("/api/missions/reports/"+this.mission.current.id).then((function(s){s.data.status?(swal.toast_success(s.data.message),t.forms.opinion.reset(),t.initData()):swal.alert_error(s.data.message)})).catch((function(t){console.log(t)}))},validateOpinion:function(){var t=this;swal.confirm({title:"Mission "+this.mission.current.reference,message:"Vous êtes sur de vouloir valider la mission "+this.mission.current.reference}).then((function(s){s.isConfirmed&&t.forms.validations.opinion.put("/api/missions/reports/"+t.mission.current.id).then((function(s){s.data.status?(swal.toast_success(s.data.message),t.initData()):swal.alert_error(s.data.message)})).catch((function(t){console.log(t)}))}))},enableEdition:function(t){"opinion"==t?(this.forms.opinion.edit_mode=!0,this.forms.opinion.opinion=this.mission.current.opinion.content,this.forms.opinion.id=this.mission.current.opinion.id):"report"==t&&(this.forms.report.edit_mode=!0,this.forms.report.report=this.mission.current.dre_report.content,this.forms.report.id=this.mission.current.dre_report.id)},initData:function(){var t=this;this.close(),this.$store.dispatch("missions/fetch",{missionId:this.$route.params.missionId}).catch((function(t){return swal.alert_error(t)})),this.$store.dispatch("missions/fetch",{missionId:this.$route.params.missionId,onlyProcesses:!0}).then((function(){var s;t.config.data=null===(s=t.processes)||void 0===s?void 0:s.processes})).catch((function(t){return swal.alert_error(t)})),this.forms.opinion.edit_mode=!1,this.forms.report.edit_mode=!1,this.modals.dispatch=!1},details:function(t){var s,i,n,o="mission-details";(t=null!==(s=t)&&void 0!==s&&null!==(i=s.item)&&void 0!==i&&i.id?t.item:t).progress_status<100&&(null===(n=this.mission)||void 0===n||!n.current.opinion)&&(o="mission-details-execute"),this.$router.push({name:o,params:{missionId:this.mission.current.id,processId:t.id}})},destroy:function(){var t=this;swal.confirm_destroy().then((function(s){var i;s.isConfirmed&&e.Z.delete("missions/"+(null===(i=t.mission)||void 0===i?void 0:i.current.id)).then((function(s){s.data.status?(t.initData(),swal.toast_success(s.data.message)):swal.alert_error(s.data.message)})).catch((function(t){console.log(t)}))}))},show:function(t){var s=this;this.$store.dispatch("processes/fetch",{id:t.id,onlyControlPoints:!0}).then((function(){t.controlPoints=s.controlPoints.controlPoints,s.rowSelected=t}))},close:function(){this.rowSelected=null}}};const v=(0,i(1900).Z)(u,(function(){var t,s,i,n,o,e,r,a,l,c,d,u,v,p,m,_,f,h,b,g,y,C,w,k,x,O,S,j,P,D,A,E,R,M,I,L,N,T,V,$,U,F,q,K,B,Z,z,H,W,G,J,Q,X,Y,tt,st,it,nt,ot,et,rt,at,lt,ct,dt,ut,vt,pt,mt,_t,ft,ht,bt,gt,yt,Ct,wt,kt,xt,Ot,St,jt,Pt,Dt,At=this,Et=At._self._c;return At.can("view_mission")?Et("ContentBody",[Et("div",{staticClass:"d-flex justify-end align-center gap-3 my-2"},[At.can("view_control_campaign,view_page_control_campaigns")?Et("router-link",{staticClass:"btn",attrs:{to:{name:"campaign",params:{campaignId:null===(t=At.mission)||void 0===t?void 0:t.current.campaign.id}}}},[At._v("\n      Campagne de contrôle\n    ")]):At._e(),At._v(" "),(null===(s=At.mission)||void 0===s||null===(i=s.current)||void 0===i?void 0:i.remaining_days_before_start)>5&&At.can("edit_mission")?Et("router-link",{staticClass:"btn btn-warning",attrs:{to:{name:"missions-edit",params:{missionId:null===(n=At.mission)||void 0===n?void 0:n.current.id}}}},[Et("i",{staticClass:"las la-edit icon"})]):At._e()],1),At._v(" "),Et("div",{staticClass:"box border-primary-dark border-1 mb-10"},[Et("div",{staticClass:"grid gap-6"},[Et("div",{staticClass:"col-4"},[Et("div",{staticClass:"grid gap-6"},[Et("div",{staticClass:"col-12"},[Et("span",{staticClass:"text-bold"},[At._v("\n              Mission:\n            ")]),At._v(" "),Et("span",[At._v("\n              "+At._s(null===(o=At.mission)||void 0===o||null===(e=o.current)||void 0===e?void 0:e.reference)+"\n            ")])]),At._v(" "),Et("div",{staticClass:"col-12"},[Et("span",{staticClass:"text-bold"},[At._v("\n              DRE:\n            ")]),At._v(" "),Et("span",[At._v("\n              "+At._s(null===(r=At.mission)||void 0===r||null===(a=r.current)||void 0===a?void 0:a.dre.full_name)+"\n            ")])]),At._v(" "),Et("div",{staticClass:"col-12"},[Et("span",{staticClass:"text-bold"},[At._v("\n              Agence:\n            ")]),At._v(" "),Et("span",[At._v("\n              "+At._s(null===(l=At.mission)||void 0===l||null===(c=l.current)||void 0===c?void 0:c.agency.full_name)+"\n            ")])])])]),At._v(" "),Et("div",{staticClass:"col-4"},[Et("div",{staticClass:"grid gap-6"},[Et("div",{staticClass:"col-12"},[Et("span",{staticClass:"text-bold"},[At._v("\n              Campagne:\n            ")]),At._v(" "),Et("span",[At._v("\n              "+At._s(null===(d=At.mission)||void 0===d||null===(u=d.current)||void 0===u?void 0:u.campaign.reference)+"\n            ")])]),At._v(" "),Et("div",{staticClass:"col-12"},[Et("span",{staticClass:"text-bold"},[At._v("\n              Début:\n            ")]),At._v(" "),Et("span",[At._v("\n              "+At._s((null===(v=At.mission)||void 0===v||null===(p=v.current)||void 0===p?void 0:p.start)+" / "+(null===(m=At.mission)||void 0===m||null===(_=m.current)||void 0===_?void 0:_.remaining_days_before_start_str))+"\n            ")])]),At._v(" "),Et("div",{staticClass:"col-12"},[Et("span",{staticClass:"text-bold"},[At._v("\n              Fin:\n            ")]),At._v(" "),Et("span",[At._v("\n              "+At._s((null===(f=At.mission)||void 0===f||null===(h=f.current)||void 0===h?void 0:h.end)+" / "+(null===(b=At.mission)||void 0===b||null===(g=b.current)||void 0===g?void 0:g.remaining_days_before_end_str))+"\n            ")])])])]),At._v(" "),Et("div",{staticClass:"col-4"},[Et("div",{staticClass:"grid gap-6"},[Et("div",{staticClass:"col-12"},[Et("span",{staticClass:"text-bold"},[At._v("\n              Contrôleurs dre:\n            ")]),At._v(" "),Et("span",[Et("ul",{staticClass:"d-inline-block ml-6"},At._l(null===(y=At.mission)||void 0===y||null===(C=y.current)||void 0===C?void 0:C.agency_controllers,(function(t){return Et("li",{key:"dre_controller-"+t.id},[At._v("\n                  "+At._s(t.full_name)+"\n                ")])})),0)])]),At._v(" "),Et("div",{staticClass:"col-12"},[Et("span",{staticClass:"text-bold"},[At._v("\n              Contrôleurs dcp:\n            ")]),At._v(" "),Et("span",[Et("ul",{staticClass:"d-inline-block ml-6"},At._l(null===(w=At.mission)||void 0===w||null===(k=w.current)||void 0===k?void 0:k.dcp_controllers,(function(t){return Et("li",{key:"dcp-controller-"+t.id},[At._v("\n                  "+At._s(t.full_name)+"\n                ")])})),0)])])])]),At._v(" "),Et("div",{staticClass:"col-12 col-lg-4"},[Et("span",{staticClass:"text-bold"},[At._v("\n          Taux de progression:\n        ")]),At._v(" "),Et("span",[At._v("\n          "+At._s(null===(x=At.mission)||void 0===x||null===(O=x.current)||void 0===O?void 0:O.progress_status)+"%\n        ")])]),At._v(" "),Et("div",{staticClass:"col-12 col-lg-4"},[Et("span",{staticClass:"text-bold"},[At._v("\n          Statut:\n        ")]),At._v(" "),Et("span",[At._v("\n          "+At._s(null===(S=At.mission)||void 0===S||null===(j=S.current)||void 0===j?void 0:j.realisation_state)+"\n        ")])]),At._v(" "),Et("div",{directives:[{name:"has-role",rawName:"v-has-role",value:"cdc,cdcr,cc",expression:"'cdc,cdcr,cc'"}],staticClass:"col-12 col-lg-4"},[Et("span",{staticClass:"text-bold"},[At._v("\n          Moyenne:\n        ")]),At._v(" "),Et("span",[At._v("\n          "+At._s(null===(P=At.mission)||void 0===P||null===(D=P.current)||void 0===D?void 0:D.avg_score)+"\n        ")])]),At._v(" "),null!==(A=At.mission)&&void 0!==A&&null!==(E=A.current)&&void 0!==E&&E.cdcr_validation_at?Et("div",{staticClass:"col-12 col-lg-4"},[Et("span",{staticClass:"text-bold"},[At._v("\n          1"),Et("sup",[At._v("ère")]),At._v(" validation\n        ")]),At._v(" "),Et("span",[At._v("\n          "+At._s(null===(R=At.mission)||void 0===R||null===(M=R.current)||void 0===M?void 0:M.cdcr_validation_at)+"\n        ")])]):At._e(),At._v(" "),null!==(I=At.mission)&&void 0!==I&&null!==(L=I.current)&&void 0!==L&&L.cdcr_validation_at?Et("div",{staticClass:"col-12 col-lg-4"},[Et("span",{staticClass:"text-bold"},[At._v("\n          Validé par:\n        ")]),At._v(" "),Et("span",[At._v("\n          "+At._s(null===(N=At.mission)||void 0===N||null===(T=N.current)||void 0===T||null===(V=T.cdcr_validator)||void 0===V?void 0:V.full_name)+"\n        ")])]):At._e(),At._v(" "),Et("div",{staticClass:"col-12 col-lg-4 d-none d-lg-block"}),At._v(" "),null!==($=At.mission)&&void 0!==$&&null!==(U=$.current)&&void 0!==U&&U.dcp_validation_at?Et("div",{staticClass:"col-12 col-lg-4"},[Et("span",{staticClass:"text-bold"},[At._v("\n          2"),Et("sup",[At._v("ème")]),At._v(" validation\n        ")]),At._v(" "),Et("span",[At._v("\n          "+At._s(null===(F=At.mission)||void 0===F||null===(q=F.current)||void 0===q?void 0:q.dcp_validation_at)+"\n        ")])]):At._e(),At._v(" "),null!==(K=At.mission)&&void 0!==K&&null!==(B=K.current)&&void 0!==B&&B.dcp_validation_at?Et("div",{staticClass:"col-12 col-lg-4"},[Et("span",{staticClass:"text-bold"},[At._v("\n          Validé par:\n        ")]),At._v(" "),Et("span",[At._v("\n          "+At._s(null===(Z=At.mission)||void 0===Z||null===(z=Z.current)||void 0===z||null===(H=z.dcp_validator)||void 0===H?void 0:H.full_name)+"\n        ")])]):At._e(),At._v(" "),Et("div",{staticClass:"col-12"},[Et("span",{staticClass:"text-bold"},[At._v("\n          Note:\n        ")]),At._v(" "),Et("span",[At._v("\n          "+At._s((null===(W=At.mission)||void 0===W||null===(G=W.current)||void 0===G?void 0:G.note)||"-")+"\n        ")])])])]),At._v(" "),Et("div",{staticClass:"d-flex align-items gap-2"},[100!=(null===(J=At.mission)||void 0===J?void 0:J.current.progress_status)||null!==(Q=At.mission)&&void 0!==Q&&Q.current.dre_report||null===(X=At.mission)||void 0===X||null===(Y=X.current.opinion)||void 0===Y||!Y.is_validated||!At.can("create_dre_report")?At._e():Et("button",{staticClass:"btn btn-info",on:{click:At.showReport}},[At._v("\n      Ajouter votre rapport\n    ")]),At._v(" "),100==(null===(tt=At.mission)||void 0===tt?void 0:tt.current.progress_status)&&null!==(st=At.mission)&&void 0!==st&&null!==(it=st.current.opinion)&&void 0!==it&&it.is_validated&&(null===(nt=At.mission)||void 0===nt||null===(ot=nt.current.dre_report)||void 0===ot||!ot.is_validated)&&null!==(et=At.mission)&&void 0!==et&&et.current.dre_report&&At.can("validate_dre_report")?Et("button",{staticClass:"btn btn-success",on:{click:function(t){return t.preventDefault(),At.validateReport.apply(null,arguments)}}},[At._v("\n      Valider la mission\n    ")]):At._e(),At._v(" "),null!==(rt=At.mission)&&void 0!==rt&&rt.current.dre_report&&At.can("create_dre_report")?Et("button",{staticClass:"btn btn-info",on:{click:At.showReport}},[At._v("\n      Rapport de la mission\n    ")]):At._e(),At._v(" "),100!=(null===(at=At.mission)||void 0===at?void 0:at.current.progress_status)||null!==(lt=At.mission)&&void 0!==lt&&lt.current.controller_opinion_is_validated||null===(ct=At.mission)||void 0===ct||null===(dt=ct.current)||void 0===dt||!dt.controller_opinion_exist||!At.can("validate_opinion")?At._e():Et("button",{staticClass:"btn btn-success",on:{click:function(t){return t.preventDefault(),At.validateOpinion.apply(null,arguments)}}},[At._v("\n      Valider la mission\n    ")]),At._v(" "),null!==(ut=At.mission)&&void 0!==ut&&ut.current.controller_opinion_exist||null!==(vt=At.mission)&&void 0!==vt&&null!==(pt=vt.current)&&void 0!==pt&&pt.dre_report_exist||100!=(null===(mt=At.mission)||void 0===mt?void 0:mt.current.progress_status)||!At.can("create_opinion")?At._e():Et("button",{staticClass:"btn btn-info",on:{click:At.showOpinion}},[At._v("\n      Ajouter votre avis\n    ")]),At._v(" "),null!==(_t=At.mission)&&void 0!==_t&&null!==(ft=_t.current.opinion)&&void 0!==ft&&ft.is_validated&&At.can("view_opinion")?Et("button",{staticClass:"btn btn-info",on:{click:At.showOpinion}},[At._v("\n      Avis sur la mission\n    ")]):At._e(),At._v(" "),null===(ht=At.mission)||void 0===ht||null===(bt=ht.current)||void 0===bt||!bt.controller_opinion_exist||null!==(gt=At.mission)&&void 0!==gt&&null!==(yt=gt.current.opinion)&&void 0!==yt&&yt.is_validated||!At.can("create_opinion")?At._e():Et("button",{staticClass:"btn btn-info",on:{click:At.showOpinion}},[At._v("\n      Avis sur la mission\n    ")]),At._v(" "),null!==(Ct=At.mission)&&void 0!==Ct&&Ct.current.cdcr_validation_at||!At.can("make_first_validation")?At._e():Et("button",{staticClass:"btn btn-success",on:{click:function(t){return t.preventDefault(),At.validateMission(1)}}},[At._v("\n      Valider la mission\n    ")]),At._v(" "),null!==(wt=At.mission)&&void 0!==wt&&wt.current.cdcr_validation_at||!At.can("assign_mission_processing")?At._e():Et("button",{staticClass:"btn btn-success",on:{click:function(t){return t.preventDefault(),At.showDispatchForm.apply(null,arguments)}}},[At._v("\n      Assigné\n    ")]),At._v(" "),null!==(kt=At.mission)&&void 0!==kt&&null!==(xt=kt.current.dre_report)&&void 0!==xt&&xt.is_validated&&At.can("make_first_validation,process_mission")?Et("button",{staticClass:"btn btn-info",on:{click:At.showReport}},[At._v("\n      Rapport de la mission\n    ")]):At._e(),At._v(" "),null===(Ot=At.mission)||void 0===Ot||!Ot.current.cdcr_validation_at||null!==(St=At.mission)&&void 0!==St&&St.current.dcp_validation_at||!At.can("make_second_validation")?At._e():Et("button",{staticClass:"btn btn-success",on:{click:function(t){return t.preventDefault(),At.validateMission(2)}}},[At._v("\n      Valider la mission\n    ")]),At._v(" "),null!==(jt=At.mission)&&void 0!==jt&&null!==(Pt=jt.current.dre_report)&&void 0!==Pt&&Pt.is_validated&&At.can("make_second_validation")?Et("button",{staticClass:"btn btn-info",on:{click:At.showReport}},[At._v("\n      Rapport de la mission\n    ")]):At._e(),At._v(" "),Et("div",{directives:[{name:"has-role",rawName:"v-has-role",value:"dg,cdrcp,da,cc",expression:"'dg,cdrcp,da,cc'"}]},[null!==(Dt=At.mission)&&void 0!==Dt&&Dt.current.cdcr_validation_at?Et("button",{staticClass:"btn btn-info",on:{click:At.showReport}},[At._v("\n        Rapport de la mission\n      ")]):At._e()])]),At._v(" "),Et("NLDatatable",{attrs:{title:"Processus de la mission",namespace:"missions",stateKey:"processes",config:At.config},on:{show:At.show},scopedSlots:At._u([{key:"actions",fn:function(t){var s,i,n;return[At.can("control_agency,view_mission_detail")&&(null===(s=At.mission)||void 0===s||null===(i=s.current)||void 0===i?void 0:i.remaining_days_before_start)<=0?Et("button",{staticClass:"btn btn-info has-icon",on:{click:function(s){return s.stopPropagation(),At.details(t)}}},[t.item.progress_status<100&&(null===(n=At.mission)||void 0===n||!n.current.opinion)?Et("i",{staticClass:"las la-tasks icon"}):Et("i",{staticClass:"las la-list-alt icon"})]):At._e()]}}],null,!1,3042604947)}),At._v(" "),Et("NLModal",{attrs:{show:At.rowSelected},on:{close:At.close},scopedSlots:At._u([{key:"title",fn:function(){var t,s,i;return[Et("small",{staticClass:"tag is-info text-small"},[At._v("\n        "+At._s(null===(t=At.rowSelected)||void 0===t?void 0:t.familly)+"\n      ")]),At._v(" "),Et("small",{staticClass:"tag is-primary-dark text-small mx-1"},[At._v("\n        "+At._s(null===(s=At.rowSelected)||void 0===s?void 0:s.domain)+"\n      ")]),At._v(" "),Et("small",{staticClass:"tag is-warning text-small"},[At._v("\n        "+At._s(null===(i=At.rowSelected)||void 0===i?void 0:i.name)+"\n      ")])]},proxy:!0},{key:"default",fn:function(){var t;return[Et("p",{staticClass:"text-bold mb-6"},[At._v("\n        Points de contrôle\n      ")]),At._v(" "),Et("div",{staticClass:"grid list"},At._l(null===(t=At.rowSelected)||void 0===t?void 0:t.controlPoints,(function(t){return Et("div",{key:t.id,staticClass:"col-12 list-item"},[Et("div",{staticClass:"list-item-content"},[At._v("\n            "+At._s(t.label)+"\n          ")])])})),0)]},proxy:!0},At.can("edit_mission")?{key:"footer",fn:function(){var t;return[100==(null===(t=At.rowSelected)||void 0===t?void 0:t.progress_status)&&At.can("view_mission")?Et("button",{staticClass:"btn btn-info has-icon",on:{click:function(t){return t.stopPropagation(),At.details(At.rowSelected)}}},[Et("i",{staticClass:"las la-tasks icon"}),At._v("\n        Afficher\n      ")]):At.can("control_agency")?Et("button",{staticClass:"btn btn-info has-icon",on:{click:function(t){return t.stopPropagation(),At.details(At.rowSelected)}}},[Et("i",{staticClass:"las la-tasks icon"}),At._v("\n        Éffectuer\n      ")]):At._e()]},proxy:!0}:null],null,!0)}),At._v(" "),Et("NLModal",{attrs:{show:At.modals.opinion},on:{close:function(t){At.modals.opinion=!1}},scopedSlots:At._u([{key:"title",fn:function(){return[Et("h2",[At._v("Avis du contrôleur")])]},proxy:!0},{key:"default",fn:function(){var t,s,i,n,o;return[null===(t=At.mission)||void 0===t||!t.current.opinion||At.forms.opinion.edit_mode?Et("form",{on:{submit:function(t){return t.preventDefault(),At.saveOpinion.apply(null,arguments)},keydown:function(t){return At.forms.opinion.onKeydown(t)}}},[Et("div",{staticClass:"grid"},[Et("div",{staticClass:"col-12"},[Et("NLWyswyg",{attrs:{name:"opinion",form:At.forms.opinion,label:"Avis du contrôleur",labelRequired:""},model:{value:At.forms.opinion.opinion,callback:function(t){At.$set(At.forms.opinion,"opinion",t)},expression:"forms.opinion.opinion"}})],1),At._v(" "),Et("div",{staticClass:"col-12"},[Et("NLCheckbox",{attrs:{name:"validated",form:At.forms.opinion,label:"Validé la mission"},model:{value:At.forms.opinion.validated,callback:function(t){At.$set(At.forms.opinion,"validated",t)},expression:"forms.opinion.validated"}})],1)]),At._v(" "),Et("div",{staticClass:"d-flex justify-end align-center"},[Et("NLButton",{attrs:{loading:At.forms.opinion.busy,label:"Save"}})],1)]):Et("div",{staticClass:"grid"},[Et("div",{staticClass:"col-12",domProps:{innerHTML:At._s(null===(s=At.mission)||void 0===s?void 0:s.current.opinion.content)}}),At._v(" "),null!==(i=At.mission)&&void 0!==i&&null!==(n=i.current.opinion)&&void 0!==n&&n.is_validated?Et("div",{staticClass:"col-12"},[Et("b",[At._v("Validé le:")]),At._v(" "),Et("time",[At._v(At._s(null===(o=At.mission)||void 0===o?void 0:o.current.opinion.validated_at))])]):At._e()])]},proxy:!0},{key:"footer",fn:function(){var t,s,i,n,o,e;return[null!==(t=At.mission)&&void 0!==t&&null!==(s=t.current.opinion)&&void 0!==s&&s.is_validated||null===(i=At.mission)||void 0===i||!i.current.opinion||At.forms.opinion.edit_mode||!At.can("create_opinion")?At._e():Et("button",{staticClass:"btn btn-success has-icon",on:{click:function(t){return t.preventDefault(),At.validateOpinion.apply(null,arguments)}}},[Et("i",{staticClass:"las la-check-circle icon"}),At._v("\n        Valider la mission\n      ")]),At._v(" "),null!==(n=At.mission)&&void 0!==n&&null!==(o=n.current.opinion)&&void 0!==o&&o.is_validated||null===(e=At.mission)||void 0===e||!e.current.opinion||At.forms.opinion.edit_mode||!At.can("create_opinion")?At._e():Et("button",{staticClass:"btn btn-warning has-icon",on:{click:function(t){return t.preventDefault(),At.enableEdition("opinion")}}},[Et("i",{staticClass:"las la-edit icon"}),At._v("\n        Editer l'avis\n      ")])]},proxy:!0}],null,!1,3674825186)}),At._v(" "),Et("NLModal",{attrs:{show:At.modals.report},on:{close:function(t){At.modals.report=!1}},scopedSlots:At._u([{key:"title",fn:function(){return[Et("h2",[At._v("Rapport du chef de département")])]},proxy:!0},{key:"default",fn:function(){var t,s,i,n,o;return[null===(t=At.mission)||void 0===t||!t.current.dre_report||At.forms.report.edit_mode?Et("form",{on:{submit:function(t){return t.preventDefault(),At.saveReport.apply(null,arguments)},keydown:function(t){return At.forms.report.onKeydown(t)}}},[Et("div",{staticClass:"grid"},[Et("div",{staticClass:"col-12"},[Et("NLWyswyg",{attrs:{name:"report",form:At.forms.report,label:"Rapport du chef de département",labelRequired:""},model:{value:At.forms.report.report,callback:function(t){At.$set(At.forms.report,"report",t)},expression:"forms.report.report"}})],1),At._v(" "),Et("div",{staticClass:"col-12"},[Et("NLCheckbox",{attrs:{name:"validated",form:At.forms.report,label:"Validé la mission"},model:{value:At.forms.report.validated,callback:function(t){At.$set(At.forms.report,"validated",t)},expression:"forms.report.validated"}})],1)]),At._v(" "),Et("div",{staticClass:"d-flex justify-end align-center"},[Et("NLButton",{attrs:{loading:At.forms.report.busy,label:"Save"}})],1)]):Et("div",{staticClass:"grid"},[Et("div",{staticClass:"col-12",domProps:{innerHTML:At._s(null===(s=At.mission)||void 0===s?void 0:s.current.dre_report.content)}}),At._v(" "),null!==(i=At.mission)&&void 0!==i&&null!==(n=i.current.dre_report)&&void 0!==n&&n.is_validated?Et("div",{staticClass:"col-12"},[Et("b",[At._v("Validé le:")]),At._v(" "),Et("time",[At._v(At._s(null===(o=At.mission)||void 0===o?void 0:o.current.dre_report.validated_at))])]):At._e()])]},proxy:!0},{key:"footer",fn:function(){var t,s,i,n,o,e,r,a,l,c;return[null===(t=At.mission)||void 0===t||null===(s=t.current.opinion)||void 0===s||!s.is_validated||null===(i=At.mission)||void 0===i||!i.current.dre_report||null!==(n=At.mission)&&void 0!==n&&null!==(o=n.current.dre_report)&&void 0!==o&&o.is_validated||At.forms.report.edit_mode||!At.can("validate_dre_report")?At._e():Et("button",{staticClass:"btn btn-success has-icon",on:{click:function(t){return t.preventDefault(),At.validateReport.apply(null,arguments)}}},[Et("i",{staticClass:"las la-check-circle icon"}),At._v("\n        Valider la mission\n      ")]),At._v(" "),null===(e=At.mission)||void 0===e||null===(r=e.current.opinion)||void 0===r||!r.is_validated||null===(a=At.mission)||void 0===a||!a.current.dre_report||null!==(l=At.mission)&&void 0!==l&&null!==(c=l.current.dre_report)&&void 0!==c&&c.is_validated||At.forms.report.edit_mode||!At.can("create_dre_report")?At._e():Et("button",{staticClass:"btn btn-warning has-icon",on:{click:function(t){return t.preventDefault(),At.enableEdition("report")}}},[Et("i",{staticClass:"las la-edit icon"}),At._v("\n        Editer le rapport\n      ")])]},proxy:!0}],null,!1,2514394549)}),At._v(" "),Et("NLModal",{attrs:{show:At.modals.dispatch},on:{close:function(t){At.modals.dispatch=!1}},scopedSlots:At._u([{key:"title",fn:function(){return[Et("h2",[At._v("Assigné le traitement de la mission")])]},proxy:!0},{key:"default",fn:function(){return[Et("form",{on:{submit:function(t){return t.preventDefault(),At.dispatchMission.apply(null,arguments)},keydown:function(t){return At.forms.dispatch.onKeydown(t)}}},[Et("div",{staticClass:"grid"},[Et("div",{staticClass:"col-12"},[Et("NLSelect",{attrs:{name:"controllers",form:At.forms.dispatch,options:At.controllersList,label:"Contrôleurs",placeholder:"Choisissez un ou plusieurs contrôleurs",multiple:"",labelRequired:""},model:{value:At.forms.dispatch.controllers,callback:function(t){At.$set(At.forms.dispatch,"controllers",t)},expression:"forms.dispatch.controllers"}})],1)]),At._v(" "),Et("div",{staticClass:"d-flex justify-end align-center"},[Et("NLButton",{attrs:{loading:At.forms.dispatch.busy,label:"Save"}})],1)])]},proxy:!0}],null,!1,1055958166)})],1):At._e()}),[],!1,null,null,null).exports}}]);