"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6372],{5714:(e,t,a)=>{a.d(t,{ZP:()=>w,l0:()=>g});var s=a(9669),l=a.n(s),i=Object.defineProperty,r=Object.prototype.hasOwnProperty,o=Object.getOwnPropertySymbols,n=Object.prototype.propertyIsEnumerable,d=(e,t,a)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,c=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&d(e,a,t[a]);if(o)for(var a of o(t))n.call(t,a)&&d(e,a,t[a]);return e};const u=e=>void 0===e,m=e=>Array.isArray(e),f=e=>e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.slice,p=(e,t,a,s)=>((t=t||{}).indices=!u(t.indices)&&t.indices,t.nullsAsUndefineds=!u(t.nullsAsUndefineds)&&t.nullsAsUndefineds,t.booleansAsIntegers=!u(t.booleansAsIntegers)&&t.booleansAsIntegers,t.allowEmptyArrays=!u(t.allowEmptyArrays)&&t.allowEmptyArrays,a=a||new FormData,u(e)||(null===e?t.nullsAsUndefineds||a.append(s,""):(e=>"boolean"==typeof e)(e)?t.booleansAsIntegers?a.append(s,e?1:0):a.append(s,e):m(e)?e.length?e.forEach(((e,l)=>{const i=s+"["+(t.indices?l:"")+"]";p(e,t,a,i)})):t.allowEmptyArrays&&a.append(s+"[]",""):(e=>e instanceof Date)(e)?a.append(s,e.toISOString()):!(e=>e===Object(e))(e)||(e=>f(e)&&"string"==typeof e.name&&("object"==typeof e.lastModifiedDate||"number"==typeof e.lastModified))(e)||f(e)?a.append(s,e):Object.keys(e).forEach((l=>{const i=e[l];if(m(i))for(;l.length>2&&l.lastIndexOf("[]")===l.length-2;)l=l.substring(0,l.length-2);p(i,t,a,s?s+"["+l+"]":l)}))),a);var v={serialize:p};function _(e){if(null===e||"object"!=typeof e)return e;const t=Array.isArray(e)?[]:{};return Object.keys(e).forEach((a=>{t[a]=_(e[a])})),t}function h(e){return Array.isArray(e)?e:[e]}function b(e){return e instanceof File||e instanceof Blob||e instanceof FileList||"object"==typeof e&&null!==e&&void 0!==Object.values(e).find((e=>b(e)))}class y{constructor(){this.errors={},this.errors={}}set(e,t){"object"==typeof e?this.errors=e:this.set(c(c({},this.errors),{[e]:h(t)}))}all(){return this.errors}has(e){return Object.prototype.hasOwnProperty.call(this.errors,e)}hasAny(...e){return e.some((e=>this.has(e)))}any(){return Object.keys(this.errors).length>0}get(e){if(this.has(e))return this.getAll(e)[0]}getAll(e){return h(this.errors[e]||[])}only(...e){const t=[];return e.forEach((e=>{const a=this.get(e);a&&t.push(a)})),t}flatten(){return Object.values(this.errors).reduce(((e,t)=>e.concat(t)),[])}clear(e){const t={};e&&Object.keys(this.errors).forEach((a=>{a!==e&&(t[a]=this.errors[a])})),this.set(t)}}class g{constructor(e={}){this.originalData={},this.busy=!1,this.successful=!1,this.recentlySuccessful=!1,this.recentlySuccessfulTimeoutId=void 0,this.errors=new y,this.progress=void 0,this.update(e)}static make(e){return new this(e)}update(e){this.originalData=Object.assign({},this.originalData,_(e)),Object.assign(this,e)}fill(e={}){this.keys().forEach((t=>{this[t]=e[t]}))}data(){return this.keys().reduce(((e,t)=>c(c({},e),{[t]:this[t]})),{})}keys(){return Object.keys(this).filter((e=>!g.ignore.includes(e)))}startProcessing(){this.errors.clear(),this.busy=!0,this.successful=!1,this.progress=void 0,this.recentlySuccessful=!1,clearTimeout(this.recentlySuccessfulTimeoutId)}finishProcessing(){this.busy=!1,this.successful=!0,this.progress=void 0,this.recentlySuccessful=!0,this.recentlySuccessfulTimeoutId=setTimeout((()=>{this.recentlySuccessful=!1}),g.recentlySuccessfulTimeout)}clear(){this.errors.clear(),this.successful=!1,this.recentlySuccessful=!1,this.progress=void 0,clearTimeout(this.recentlySuccessfulTimeoutId)}reset(){Object.keys(this).filter((e=>!g.ignore.includes(e))).forEach((e=>{this[e]=_(this.originalData[e])}))}get(e,t={}){return this.submit("get",e,t)}post(e,t={}){return this.submit("post",e,t)}patch(e,t={}){return this.submit("patch",e,t)}put(e,t={}){return this.submit("put",e,t)}delete(e,t={}){return this.submit("delete",e,t)}submit(e,t,a={}){return this.startProcessing(),a=c({data:{},params:{},url:this.route(t),method:e,onUploadProgress:this.handleUploadProgress.bind(this)},a),"get"===e.toLowerCase()?a.params=c(c({},this.data()),a.params):(a.data=c(c({},this.data()),a.data),b(a.data)&&!a.transformRequest&&(a.transformRequest=[e=>v.serialize(e)])),new Promise(((e,t)=>{(g.axios||l()).request(a).then((t=>{this.finishProcessing(),e(t)})).catch((e=>{this.handleErrors(e),t(e)}))}))}handleErrors(e){this.busy=!1,this.progress=void 0,e.response&&this.errors.set(this.extractErrors(e.response))}extractErrors(e){return e.data&&"object"==typeof e.data?e.data.errors?c({},e.data.errors):e.data.message?{error:e.data.message}:c({},e.data):{error:g.errorMessage}}handleUploadProgress(e){this.progress={total:e.total,loaded:e.loaded,percentage:Math.round(100*e.loaded/e.total)}}route(e,t={}){let a=e;return Object.prototype.hasOwnProperty.call(g.routes,e)&&(a=decodeURI(g.routes[e])),"object"!=typeof t&&(t={id:t}),Object.keys(t).forEach((e=>{a=a.replace(`{${e}}`,t[e])})),a}onKeydown(e){const t=e.target;t.name&&this.errors.clear(t.name)}}g.routes={},g.errorMessage="Something went wrong. Please try again.",g.recentlySuccessfulTimeout=2e3,g.ignore=["busy","successful","errors","progress","originalData","recentlySuccessful","recentlySuccessfulTimeoutId"];const w=g},6372:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var s=a(629),l=a(5714),i=a(7565);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function n(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){d(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function d(e,t,a){return(t=function(e){var t=function(e,t){if("object"!==r(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var s=a.call(e,t||"default");if("object"!==r(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===r(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const c={layout:"backend",middleware:["auth"],components:{Notification:a(8181).Z},computed:n(n({},(0,s.Se)({details:"details/majorFacts",config:"details/config",filtersData:"details/filters"})),{},{formErrorsCount:function(){return this.modals.edit?Object.entries(this.forms.detail.errors.all()).length:this.modals.regularize?Object.entries(this.forms.regularization.errors.all()).length:void 0},files:function(){return this.rowSelected.media.map((function(e){return e.id}))}}),data:function(){return{rowSelected:null,mission:null,process:null,regularizationTypes:[{id:"Cause",label:"Cause"},{id:"Action à engagée",label:"Action à engagée"}],tableConfig:{data:null,columns:[{label:"CDC-ID",field:"cdc_reference"},{label:"RAP-ID",field:"mission_reference"},{label:"DRE",field:"dre_full_name"},{label:"Agence",field:"agency_full_name"},{label:"Famille",field:"familly_name"},{label:"Domaine",field:"domain_name"},{label:"Processus",field:"process_name"},{label:"Point de contrôle",field:"control_point_name"},{label:"Notation",field:"score",hide:!(0,i.nu)(["dcp","cdcr","cc"]),isHtml:!0,methods:{style:function(){return"text-center"},showField:function(e){var t=e.score;return'<div class="container">\n                  <div class="has-border-radius py-1 text-center '.concat(1==t?"bg-success text-white text-bold":2==t?"bg-info text-white text-bold":3==t?"bg-warning text-bold":4==t?"bg-danger text-white text-bold":"bg-grey text-dark text-bold",'">').concat(t,"</div>\n                </div>")}}}],actions:{show:!1}},forms:{detail:new l.l0(d({process_mode:!1,mission:null,process:null,media:[],detail:null,report:null,recovery_plan:null,score:null,major_fact:null,metadata:[]},"process_mode",null))},modals:{show:!1,edit:!1,regularize:!1},filters:{campaign:{label:"Campagne de contrôle",multiple:!0,data:null,value:null},mission_id:{label:"Mission",multiple:!0,data:null,value:null},agency:{label:"Agence",multiple:!0,data:null,value:null},familly:{label:"Famille",multiple:!0,data:null,value:null},domain:{label:"Domaine",multiple:!0,data:null,value:null},process:{label:"Processus",multiple:!0,data:null,value:null},score:{label:"Notation",multiple:!0,data:[{id:1,label:1},{id:2,label:2},{id:3,label:3},{id:4,label:4}],value:null}},currentMetadata:{}}},created:function(){this.initData(),this.initFilters()},methods:{initFilters:function(){var e=this;this.$store.dispatch("details/fetchFilters").then((function(){e.filters.campaign.data=e.filtersData.filters.campaigns,e.filters.mission_id.data=e.filtersData.filters.missions,e.filters.agency.data=e.filtersData.filters.agencies,e.filters.familly.data=e.filtersData.filters.famillies,e.filters.domain.data=e.filtersData.filters.domains,e.filters.process.data=e.filtersData.filters.processes}))},initData:function(){var e=this;this.$store.dispatch("details/fetchMajorFacts").then((function(){return e.tableConfig.data=e.details.majorFacts}))},regularize:function(e){this.modals.edit=!1,this.modals.show=!1,this.modals.regularize=!0,this.initRegularizationForm()},show:function(e){var t=this;this.$store.dispatch("details/fetchConfig",{missionId:e.mission_id,processId:e.process_id,detailId:e.id}).then((function(){var e=t.config.config;t.rowSelected=e.detail,t.mission=e.mission,t.process=e.process,t.modals.show=!0,t.modals.edit=!1,t.currentMetadata.keys=Object.keys(t.rowSelected.parsed_metadata)}))},edit:function(){this.modals.edit=!0,this.modals.show=!1,this.initDetailForm()},close:function(e){this.modals.hasOwnProperty(e)&&(this.modals[e]=!1),this.forms.detail.reset(),this.initData(),this.currentMetadata={},this.rowSelected=null},initDetailForm:function(){var e,t=this;this.$store.dispatch("details/fetchConfig",{missionId:this.$route.params.missionId,processId:this.$route.params.processId,detailId:null===(e=this.rowSelected)||void 0===e?void 0:e.id}).then((function(){var e=t.config.config;t.rowSelected=e.detail,t.forms.detail.process_mode=(0,i.nu)(["cc","cdcr","dcp"]),t.forms.detail.mission=e.mission.id,t.forms.detail.process=e.process.id,t.forms.detail.detail=e.detail.id,t.forms.detail.media=e.detail.media.length?e.detail.media.map((function(e){return e.id})):[],t.forms.detail.detail=e.detail.id,t.forms.detail.report=e.detail.report,t.forms.detail.recovery_plan=e.detail.recovery_plan,t.forms.detail.score=e.detail.score,t.forms.detail.major_fact=!!e.detail.major_fact,t.forms.detail.metadata=e.detail.metadata||[]}))},initRegularizationForm:function(){},setupFields:function(e){return null==e?void 0:e.map((function(e){return{type:e.hasOwnProperty(0)?e[0].type:"",label:e.hasOwnProperty(1)?e[1].label:"",name:e.hasOwnProperty(2)?e[2].name:"",length:e.hasOwnProperty(3)?e[3].length:null,style:e.hasOwnProperty(4)?e[4].style:"",id:e.hasOwnProperty(5)?e[5].id:"",placeholder:e.hasOwnProperty(6)?e[6].placeholder:"",help_text:e.hasOwnProperty(7)?e[7].help_text:"",rules:e.hasOwnProperty(8)?e[8].rules:[]}}))},setupScores:function(e){return"object"==r(e)?null==e?void 0:e.map((function(e){return{id:e[0].score,label:e[1].label}})):[]},save:function(e){var t,a,s=this;"edit"==e?(t=this.forms.detail,a="/api/missions/details/"+this.forms.detail.mission):"regularize"==e&&(t=this.forms.regularization,a="/api/regularize/"+this.forms.regularization.detail_id),t.post(a).then((function(e){e.data.status?(swal.toast_success(e.data.message),s.initData(),t.reset(),s.close("edit"),s.close("show"),s.close("regularize")):swal.alert_error(e.data.message)})).catch((function(e){var t=e.message;422==e.response.status&&(t="Les données fournies sont invalides."),swal.toast_error(t)}))},isInput:function(e){return["text","date","datetime","time","week","number","tel","email","month","url"].includes(e)},notify:function(){var e=this;swal.confirm({title:"Dispatch notification",message:"Voulez-vous notifier les autorités concernées?"}).then((function(t){t.isConfirmed&&api.post("notifications/major-fact/"+e.rowSelected.id).then((function(t){swal.toast_success(t.data.message),e.rowSelected=null})).catch((function(e){swal.alert_error(e)}))}))}}};const u=(0,a(1900).Z)(c,(function(){var e=this,t=e._self._c;return t("ContentBody",[t("NLDatatable",{attrs:{filters:e.filters,namespace:"details",stateKey:"global",config:e.tableConfig},on:{show:e.show}}),e._v(" "),t("NLModal",{attrs:{show:e.modals.show,defaultMode:!0},on:{close:function(t){return e.close("show")}},scopedSlots:e._u([{key:"title",fn:function(){var a,s,l;return[t("div",{staticClass:"tags"},[t("small",{staticClass:"tag is-primary-dark text-small"},[e._v("\n          "+e._s(null===(a=e.mission)||void 0===a||null===(s=a.campaign)||void 0===s?void 0:s.reference)+"\n        ")]),e._v(" "),t("small",{staticClass:"tag is-primary-extra-light text-small mx-1"},[e._v("\n          "+e._s(null===(l=e.mission)||void 0===l?void 0:l.reference)+"\n        ")])])]},proxy:!0},{key:"default",fn:function(){var a,s,l,i,r,o,n,d,c,u,m,f,p,v,_,h,b,y,g,w,C,S,j,O,k,x,P,D,A,I,E,F,N,z,R;return[t("div",{staticClass:"grid gap-6"},[t("div",{staticClass:"col-12"},[t("span",{staticClass:"label"},[e._v("Fait majeur: ")]),e._v(" "),t("span",{domProps:{innerHTML:e._s(null===(a=e.rowSelected)||void 0===a?void 0:a.major_fact_str)}})]),e._v(" "),t("div",{staticClass:"col-12 col-lg-6"},[t("span",{staticClass:"label"},[e._v("Dre: ")]),e._v(" "),t("span",[e._v(e._s(null===(s=e.mission)||void 0===s||null===(l=s.dre)||void 0===l?void 0:l.full_name))])]),e._v(" "),t("div",{staticClass:"col-12 col-lg-6"},[t("span",{staticClass:"label"},[e._v("Agence: ")]),e._v(" "),t("span",[e._v(e._s(null===(i=e.mission)||void 0===i||null===(r=i.agency)||void 0===r?void 0:r.full_name))])]),e._v(" "),t("div",{staticClass:"col-12 col-lg-6"},[t("span",{staticClass:"label"},[e._v("Famille: ")]),e._v(" "),t("span",[e._v(e._s(null===(o=e.process)||void 0===o||null===(n=o.familly)||void 0===n?void 0:n.name))])]),e._v(" "),t("div",{staticClass:"col-12 col-lg-6"},[t("span",{staticClass:"label"},[e._v("Domaine: ")]),e._v(" "),t("span",[e._v(e._s(null===(d=e.rowSelected)||void 0===d||null===(c=d.domain)||void 0===c?void 0:c.name))])]),e._v(" "),t("div",{staticClass:"col-12"},[t("span",{staticClass:"label"},[e._v("Processus: ")]),e._v(" "),t("span",[e._v(e._s(null===(u=e.process)||void 0===u?void 0:u.name))])]),e._v(" "),t("div",{staticClass:"col-12"},[t("span",{staticClass:"label"},[e._v("Point de contrôle: ")]),e._v(" "),t("span",[e._v(e._s(null===(m=e.rowSelected)||void 0===m||null===(f=m.control_point)||void 0===f?void 0:f.name))])]),e._v(" "),t("div",{staticClass:"col-12 col-lg-6"},[t("span",{staticClass:"label"},[e._v("Appréciation: ")]),e._v(" "),t("span",[e._v(e._s(null===(p=e.rowSelected)||void 0===p?void 0:p.appreciation))])]),e._v(" "),t("div",{staticClass:"col-12 col-lg-6"},[t("span",{staticClass:"label"},[e._v("Notation: ")]),e._v(" "),t("span",[e._v(e._s(null===(v=e.rowSelected)||void 0===v?void 0:v.score))])]),e._v(" "),null!==(_=e.rowSelected)&&void 0!==_&&_.metadata?t("div",{staticClass:"col-12",class:{"col-lg-4":!(null!==(h=e.rowSelected)&&void 0!==h&&h.metadata)}},[t("span",{staticClass:"label"},[e._v("\n            Informations supplémentaires:\n          ")])]):e._e(),e._v(" "),null!==(b=e.rowSelected)&&void 0!==b&&b.metadata?t("div",{staticClass:"col-12",class:{"col-lg-8":!(null!==(y=e.rowSelected)&&void 0!==y&&y.parsed_metadata)}},[null!==(g=e.rowSelected)&&void 0!==g&&g.parsed_metadata?t("table",[t("thead",[t("tr",e._l(Object.keys(null===(w=e.rowSelected)||void 0===w?void 0:w.parsed_metadata),(function(a){return t("th",{staticClass:"text-left"},[e._v("\n                  "+e._s(a)+"\n                ")])})),0)]),e._v(" "),t("tbody",e._l(null===(C=e.rowSelected)||void 0===C?void 0:C.metadata,(function(a,s){return t("tr",{key:"metadata-row-"+s},e._l(a,(function(a,l){return t("td",{key:"metadata-row-"+s+"-item-"+l,staticClass:"text-left"},e._l(a,(function(a,i){return"label"!==i&&"rules"!==i?t("span",{key:"metadata-row-"+s+"-item-"+l+"-content"},[e._v("\n                    "+e._s(a)+"\n                  ")]):e._e()})),0)})),0)})),0)]):t("span",[e._v("-")])]):e._e(),e._v(" "),t("div",{staticClass:"col-12"},[t("span",{staticClass:"label"},[e._v("Constat: ")]),e._v(" "),t("span",[e._v(e._s((null===(S=e.rowSelected)||void 0===S?void 0:S.report)||"-"))])]),e._v(" "),t("div",{staticClass:"col-12"},[t("span",{staticClass:"label"},[e._v("Plan de redressement: ")]),e._v(" "),t("span",[e._v(e._s((null===(j=e.rowSelected)||void 0===j?void 0:j.recovery_plan)||"-"))])]),e._v(" "),null!==(O=e.rowSelected)&&void 0!==O&&O.media.length?t("div",{staticClass:"col-12 list-item"},[t("NLFile",{attrs:{label:"Pièces jointes",name:"media",canDelete:!1,readonly:""},model:{value:e.files,callback:function(t){e.files=t},expression:"files"}})],1):e._e(),e._v(" "),t("div",{staticClass:"col-12 d-flex justify-end align-center"},[t("div",{staticClass:"d-flex align-center gap-2"},[null!==(k=e.mission)&&void 0!==k&&k.controller_opinion_is_validated||null!==(x=e.rowSelected)&&void 0!==x&&x.major_fact||!e.can("create_opinion")?e._e():t("button",{staticClass:"btn btn-warning has-icon",on:{click:function(t){return e.edit(e.rowSelected)}}},[t("i",{staticClass:"las la-pen icon"}),e._v("\n              Modifier\n            ")]),e._v(" "),null!==(P=e.mission)&&void 0!==P&&P.dre_report_is_validated||null!==(D=e.rowSelected)&&void 0!==D&&D.major_fact||!e.can("create_dre_report,validate_dre_report")?e._e():t("button",{staticClass:"btn btn-warning has-icon",on:{click:function(t){return e.edit(e.rowSelected)}}},[t("i",{staticClass:"las la-pen icon"}),e._v("\n              Modifier\n            ")]),e._v(" "),null!==(A=e.rowSelected)&&void 0!==A&&A.major_fact_dispatched_at||!e.can("make_first_validation,make_second_validation")?e._e():t("button",{staticClass:"btn btn-warning has-icon",on:{click:function(t){return e.edit(e.rowSelected)}}},[t("i",{staticClass:"las la-pen icon"}),e._v("\n              Traiter\n            ")]),e._v(" "),null!==(I=e.rowSelected)&&void 0!==I&&I.major_fact_dispatched_at||null===(E=e.rowSelected)||void 0===E||!E.major_fact||!e.can("dispatch_major_fact")?e._e():t("button",{staticClass:"btn btn-info has-icon",on:{click:function(t){return t.preventDefault(),e.notify(e.rowSelected)}}},[t("i",{staticClass:"las la-bell icon"}),e._v("\n              Notifier\n            ")]),e._v(" "),null===(F=e.mission)||void 0===F||!F.dcp_validation_at||null!==(N=e.rowSelected)&&void 0!==N&&null!==(z=N.regularization)&&void 0!==z&&z.regularized_at||1===(null===(R=e.rowSelected)||void 0===R?void 0:R.score)||!e.can("regularize_mission_detail")?e._e():t("button",{staticClass:"btn btn-warning has-icon",on:{click:function(t){return e.edit(e.rowSelected)}}},[t("i",{staticClass:"las la-pen icon"}),e._v("\n              Régulariser\n            ")])])])])]},proxy:!0}])}),e._v(" "),e.modals.edit?t("NLModal",{attrs:{show:e.modals.edit,defaultMode:!0},on:{close:function(t){return e.close("edit")}},scopedSlots:e._u([{key:"title",fn:function(){var a,s;return[t("small",[e._v("\n        "+e._s(null===(a=e.rowSelected)||void 0===a||null===(s=a.control_point)||void 0===s?void 0:s.name)+"\n      ")])]},proxy:!0},{key:"default",fn:function(){var a,s,l,i,r,o,n,d,c,u,m,f;return[e.forms.detail.errors.any()?t("Notification",{attrs:{type:"is-danger"}},[e._v("\n        Il y a "+e._s(e.formErrorsCount)+"\n        "+e._s(e.formErrorsCount>1?"problèmes avec vos entrées":"problème avec une entrée")+".\n      ")]):e._e(),e._v(" "),t("form",{staticClass:"grid gap-6",attrs:{enctype:"multipart/form-data"},on:{submit:function(t){return t.preventDefault(),e.save("edit")},keydown:function(t){return e.forms.detail.onKeydown(t)}}},[t("div",{staticClass:"col-12"},[t("NLSwitch",{attrs:{name:"major_fact",form:e.forms.detail,label:"Fait majeur"},model:{value:e.forms.detail.major_fact,callback:function(t){e.$set(e.forms.detail,"major_fact",t)},expression:"forms.detail.major_fact"}})],1),e._v(" "),t("div",{staticClass:"col-12"},[t("NLSelect",{attrs:{name:"score",label:"Notation",form:e.forms.detail,options:e.setupScores(null===(a=e.rowSelected)||void 0===a||null===(s=a.control_point)||void 0===s?void 0:s.scores),labelRequired:""},model:{value:e.forms.detail.score,callback:function(t){e.$set(e.forms.detail,"score",t)},expression:"forms.detail.score"}})],1),e._v(" "),null!==(l=e.rowSelected)&&void 0!==l&&null!==(i=l.control_point)&&void 0!==i&&i.fields&&e.forms.detail.score>1&&!e.forms.detail.process_mode?t("div",{staticClass:"col-12"},[t("div",{staticClass:"repeater"},[t("h2",{staticClass:"mb-6"},[e._v("Informations supplémentaires")]),e._v(" "),e._l(e.forms.detail.metadata,(function(a,s){var l,i;return t("div",{key:"metadata-"+s,staticClass:"grid my-6 repeater-row"},[t("div",{staticClass:"col-12"},[t("div",{staticClass:"grid gap-2"},[t("div",{staticClass:"col-11"},[t("div",{staticClass:"grid"},e._l(e.setupFields(null===(l=e.rowSelected)||void 0===l||null===(i=l.control_point)||void 0===i?void 0:i.fields),(function(a,l){return t("div",{key:"metadata-input-"+a.name+"-"+s+"-id",class:a.style},[e.isInput(a.type)?t("NLInput",{attrs:{form:e.forms.detail,label:a.label,placeholder:a.placeholder,type:a.type,labelRequired:a.required,name:"metadata."+s+"."+l+"."+a.name,id:"metadata."+s+"."+l+"."+a.name},model:{value:e.forms.detail.metadata[s][l][a.name],callback:function(t){e.$set(e.forms.detail.metadata[s][l],a.name,t)},expression:"forms.detail.metadata[dataRow][index][input.name]"}}):e._e(),e._v(" "),"textarea"==a.type?t("NLTextarea",{attrs:{form:e.forms.detail,label:a.label,placeholder:a.placeholder,type:a.type,labelRequired:a.required,name:"metadata."+s+"."+l+"."+a.name,id:"metadata."+s+"."+l+"."+a.name,length:a.length},model:{value:e.forms.detail.metadata[s][l][a.name],callback:function(t){e.$set(e.forms.detail.metadata[s][l],a.name,t)},expression:"forms.detail.metadata[dataRow][index][input.name]"}}):e._e(),e._v(" "),"wyswyg"==a.type?t("NLWyswyg",{attrs:{form:e.forms.detail,label:a.label,placeholder:a.placeholder,type:a.type,labelRequired:a.required,name:"metadata."+s+"."+l+"."+a.name,id:"metadata."+s+"."+l+"."+a.name,length:a.length},model:{value:e.forms.detail.metadata[s][l][a.name],callback:function(t){e.$set(e.forms.detail.metadata[s][l],a.name,t)},expression:"forms.detail.metadata[dataRow][index][input.name]"}}):e._e(),e._v(" "),"select"==a.type?t("NLSelect",{attrs:{form:e.forms.detail,label:a.label,type:a.type,labelRequired:a.required,name:"metadata."+s+"."+l+"."+a.name,id:"metadata."+s+"."+l+"."+a.name,options:a.options,placeholder:a.placeholder||"Choisissez une option...",multiple:a.multiple},model:{value:e.forms.detail.metadata[s][l][a.name],callback:function(t){e.$set(e.forms.detail.metadata[s][l],a.name,t)},expression:"forms.detail.metadata[dataRow][index][input.name]"}}):e._e()],1)})),0)]),e._v(" "),s>=0?t("div",{staticClass:"col-1 p-0 d-flex justify-start align-center"},[t("div",{staticClass:"btn btn-danger",on:{click:function(t){return e.removeRow(s)}}},[e._v("\n                      Supprimer\n                    ")])]):e._e()])])])})),e._v(" "),t("div",{staticClass:"d-flex justify-start align-center"},[t("span",{staticClass:"btn",on:{click:function(t){var a,s;return e.addRow(null===(a=e.rowSelected)||void 0===a||null===(s=a.control_point)||void 0===s?void 0:s.fields)}}},[t("i",{staticClass:"las la-plus"})])])],2)]):null!==(r=e.rowSelected)&&void 0!==r&&null!==(o=r.control_point)&&void 0!==o&&o.fields||!e.forms.detail.process_mode?e._e():t("div",{staticClass:"col-12",class:{"col-lg-8":!(null!==(n=e.rowSelected)&&void 0!==n&&n.parsed_metadata)}},[t("div",{staticClass:"label"},[e._v("\n            Informations supplémentaires\n          ")]),e._v(" "),null!==(d=e.rowSelected)&&void 0!==d&&d.parsed_metadata?t("table",[t("thead",[t("tr",e._l(Object.keys(null===(c=e.rowSelected)||void 0===c?void 0:c.parsed_metadata),(function(a){return t("th",{staticClass:"text-left"},[e._v("\n                  "+e._s(a)+"\n                ")])})),0)]),e._v(" "),t("tbody",e._l(null===(u=e.rowSelected)||void 0===u?void 0:u.metadata,(function(a,s){return t("tr",{key:"metadata-row-"+s},e._l(a,(function(a,l){return t("td",{key:"metadata-row-"+s+"-item-"+l,staticClass:"text-left"},e._l(a,(function(a,i){return"label"!==i&&"rules"!==i?t("span",{key:"metadata-row-"+s+"-item-"+l+"-content"},[e._v("\n                    "+e._s(a)+"\n                  ")]):e._e()})),0)})),0)})),0)]):t("span",[e._v("-")])]),e._v(" "),e.forms.detail.process_mode?t("div",{staticClass:"col-12"},[t("span",{staticClass:"label"},[e._v("Constat: ")]),e._v(" "),t("span",[e._v(e._s((null===(m=e.rowSelected)||void 0===m?void 0:m.report)||"-"))])]):t("div",{staticClass:"col-12"},[t("NLTextarea",{attrs:{name:"report",label:"Constat",form:e.forms.detail,placeholder:1==e.forms.detail.score||null==e.forms.detail.score&&!e.forms.detail.major_fact?"":"Ajouter votre constat",labelRequired:e.forms.detail.score>1||e.forms.detail.major_fact,readonly:1==e.forms.detail.score||null==e.forms.detail.score&&!e.forms.detail.major_fact},model:{value:e.forms.detail.report,callback:function(t){e.$set(e.forms.detail,"report",t)},expression:"forms.detail.report"}})],1),e._v(" "),t("div",{staticClass:"col-12"},[t("NLFile",{attrs:{name:"media",label:"Pièces jointes",attachableType:"App\\Models\\MissionDetail",attachableId:e.forms.detail.detail,form:e.forms.detail,multiple:"",canDelete:!(null!==(f=e.rowSelected)&&void 0!==f&&f.major_fact||e.forms.detail.process_mode),readonly:e.forms.detail.process_mode},model:{value:e.forms.detail.media,callback:function(t){e.$set(e.forms.detail,"media",t)},expression:"forms.detail.media"}})],1),e._v(" "),t("div",{staticClass:"col-12"},[t("NLTextarea",{attrs:{name:"recovery_plan",label:"Plan de redressement",form:e.forms.detail,placeholder:1==e.forms.detail.score||null==e.forms.detail.score&&!e.forms.detail.major_fact?"":"Ajouter votre plan de redressement",labelRequired:e.forms.detail.score>1||e.forms.detail.major_fact,readonly:1==e.forms.detail.score||null==e.forms.detail.score&&!e.forms.detail.major_fact},model:{value:e.forms.detail.recovery_plan,callback:function(t){e.$set(e.forms.detail,"recovery_plan",t)},expression:"forms.detail.recovery_plan"}})],1),e._v(" "),t("div",{staticClass:"col-12 d-flex justify-end align-center"},[e.forms.detail.process_mode?t("NLButton",{staticClass:"is-radius",attrs:{loading:e.forms.detail.busy,label:"Validate"}}):t("NLButton",{staticClass:"is-radius",attrs:{loading:e.forms.detail.busy,label:"Save"}})],1)])]},proxy:!0}],null,!1,2746785313)}):e._e()],1)}),[],!1,null,null,null).exports}}]);