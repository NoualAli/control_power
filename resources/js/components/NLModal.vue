<template>
  <div class="modal" :class="{ 'active': isOpen, 'reduced': isReduced, 'expanded': isExpanded }" tabindex="0"
       @keyup.esc="close"
  >
    <div class="modal-overlay" @click.stop="(e) => close(e, true)" />
    <div class="modal-card">
      <header class="modal-header">
        <div class="grid w-100">
          <div class="col-11">
            <h3>
              <slot name="title" />
            </h3>
          </div>
          <div class="col-1">
            <div class="d-flex align-center justify-end gap-3">
              <!-- <svg class="icon modal-action-icon" @click="handleReduce" width="24" height="24" viewBox="0 0 24 24"
                  fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M19 13H5C4.73478 13 4.48043 12.8946 4.29289 12.7071C4.10536 12.5196 4 12.2652 4 12C4 11.7348 4.10536 11.4804 4.29289 11.2929C4.48043 11.1054 4.73478 11 5 11H19C19.2652 11 19.5196 11.1054 19.7071 11.2929C19.8946 11.4804 20 11.7348 20 12C20 12.2652 19.8946 12.5196 19.7071 12.7071C19.5196 12.8946 19.2652 13 19 13Z"
                    fill="black" />
                </svg> -->

              <svg id="Layer_1" class="icon modal-action-icon modal-close-icon" version="1.1"
                   xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 50 50"
                   enable-background="new 0 0 50 50" xml:space="preserve" @click="(e) => close(e, true)"
              >
                <path fill="#231F20" d="M9.016,40.837c0.195,0.195,0.451,0.292,0.707,0.292c0.256,0,0.512-0.098,0.708-0.293l14.292-14.309
          l14.292,14.309c0.195,0.196,0.451,0.293,0.708,0.293c0.256,0,0.512-0.098,0.707-0.292c0.391-0.39,0.391-1.023,0.001-1.414
          L26.153,25.129L40.43,10.836c0.39-0.391,0.39-1.024-0.001-1.414c-0.392-0.391-1.024-0.391-1.414,0.001L24.722,23.732L10.43,9.423
          c-0.391-0.391-1.024-0.391-1.414-0.001c-0.391,0.39-0.391,1.023-0.001,1.414l14.276,14.293L9.015,39.423
          C8.625,39.813,8.625,40.447,9.016,40.837z"
                />
              </svg>

              <svg v-if="!isExpanded" class="icon modal-action-icon" xmlns="http://www.w3.org/2000/svg"
                   viewBox="0 0 64 64" @click="handleExpansion"
              >
                <g id="Layer_73" data-name="Layer 73">
                  <path
                    d="M22.26,58.25h-16a.5.5,0,0,1-.5-.5v-16a.5.5,0,0,1,.5-.5h3a.5.5,0,0,1,.5.5v9.68L51.42,9.75H41.74a.5.5,0,0,1-.5-.5v-3a.5.5,0,0,1,.5-.5h16a.5.5,0,0,1,.5.5v16a.5.5,0,0,1-.5.5h-3a.5.5,0,0,1-.5-.5V12.58L12.58,54.25h9.68a.5.5,0,0,1,.5.5v3A.5.5,0,0,1,22.26,58.25Zm-15.51-1h15v-2H11.37A.5.5,0,0,1,11,54.4L54.4,11a.5.5,0,0,1,.85.35V21.76h2v-15h-15v2H52.63A.5.5,0,0,1,53,9.6L9.6,53a.5.5,0,0,1-.85-.35V42.24h-2Z"
                  />
                </g>
              </svg>

              <svg v-else class="icon modal-action-icon" width="64" height="64" viewBox="0 0 64 64"
                   fill="none" xmlns="http://www.w3.org/2000/svg" @click="handleExpansion"
              >
                <path
                  d="M22.3098 37.7501H7.12985C6.46236 37.7256 5.80064 37.8817 5.21453 38.2021C4.62843 38.5224 4.13967 38.995 3.79985 39.5701C3.4363 40.2175 3.24536 40.9475 3.24536 41.6901C3.24536 42.4326 3.4363 43.1626 3.79985 43.8101C4.14207 44.3829 4.63133 44.8538 5.21687 45.1738C5.8024 45.4938 6.4629 45.6513 7.12985 45.6301H7.36985C7.95677 45.4763 8.57416 45.4823 9.15795 45.6476C9.74174 45.8129 10.2707 46.1314 10.6898 46.5701C10.9398 46.9801 10.7998 47.5701 10.2498 48.2201C9.74985 48.6601 8.98985 49.4201 7.73985 50.6701L5.21985 53.2101C4.72591 53.6611 4.36501 54.2389 4.17637 54.8806C3.98773 55.5223 3.97856 56.2035 4.14985 56.8501C4.3496 57.5659 4.73066 58.2182 5.2562 58.7437C5.78174 59.2692 6.43397 59.6503 7.14985 59.8501C7.79167 60.021 8.46797 60.0135 9.10587 59.8285C9.74377 59.6435 10.3191 59.2879 10.7698 58.8001L15.9098 53.6601C16.11 53.4591 16.3651 53.3218 16.6431 53.2653C16.921 53.2088 17.2095 53.2356 17.4722 53.3424C17.735 53.4492 17.9603 53.6313 18.12 53.8657C18.2797 54.1001 18.3666 54.3764 18.3698 54.6601C18.2298 56.2601 18.3698 58.4201 19.5498 59.7501C19.8936 60.1128 20.3099 60.3992 20.7717 60.5904C21.2334 60.7816 21.7302 60.8735 22.2298 60.8601H22.3098C23.35 60.8446 24.3432 60.4245 25.0787 59.6889C25.8143 58.9534 26.2344 57.9602 26.2498 56.9201V41.6901C26.2344 40.6499 25.8143 39.6567 25.0787 38.9212C24.3432 38.1856 23.35 37.7655 22.3098 37.7501V37.7501ZM23.7498 56.8901C23.7499 57.0809 23.712 57.2698 23.6384 57.4458C23.5647 57.6218 23.4569 57.7814 23.321 57.9154C23.1852 58.0494 23.0241 58.1551 22.8471 58.2262C22.67 58.2974 22.4806 58.3327 22.2898 58.3301C22.1259 58.3572 21.9577 58.3431 21.8006 58.289C21.6435 58.2349 21.5023 58.1424 21.3898 58.0201C20.8249 57.0441 20.6364 55.8953 20.8598 54.7901C20.8648 54.7536 20.8648 54.7166 20.8598 54.6801C20.8784 53.8934 20.6568 53.1197 20.2244 52.4622C19.792 51.8047 19.1695 51.2947 18.4398 51.0001C17.9552 50.7972 17.4353 50.6919 16.9098 50.6901C16.3959 50.691 15.8873 50.794 15.4135 50.9931C14.9397 51.1923 14.5101 51.4835 14.1498 51.8501L8.99985 57.0001C8.85961 57.1749 8.67131 57.305 8.45811 57.3743C8.24491 57.4436 8.01611 57.4491 7.79985 57.3901C7.5106 57.3051 7.24731 57.1489 7.03415 56.9358C6.82099 56.7226 6.66477 56.4593 6.57985 56.1701C6.53404 55.9553 6.54909 55.732 6.62329 55.5253C6.69749 55.3186 6.8279 55.1367 6.99985 55.0001C6.99985 55.0001 11.9998 50.0001 12.0998 49.8601L12.1998 49.7601C13.9398 47.6001 13.1998 45.8701 12.8198 45.2301C11.8198 43.5801 9.31985 42.6901 6.98985 43.1301C6.787 43.1293 6.58792 43.0753 6.41245 42.9735C6.23698 42.8717 6.09127 42.7257 5.98985 42.5501C5.84718 42.2859 5.77249 41.9903 5.77249 41.6901C5.77249 41.3898 5.84718 41.0943 5.98985 40.8301C6.10658 40.6341 6.27676 40.4754 6.48044 40.3727C6.68412 40.27 6.91286 40.2274 7.13985 40.2501H22.3398C22.721 40.2527 23.0857 40.4052 23.3552 40.6747C23.6247 40.9442 23.7772 41.3089 23.7798 41.6901L23.7498 56.8901Z"
                  fill="black"
                />
                <path
                  d="M55.0499 46.0499C56.6499 46.1899 58.8099 46.0499 60.1399 44.8599C60.5112 44.5079 60.8025 44.0801 60.994 43.6056C61.1855 43.1312 61.2728 42.6211 61.2499 42.1099C61.2344 41.0698 60.8144 40.0766 60.0788 39.3411C59.3432 38.6055 58.3501 38.1854 57.3099 38.1699H42.1099C41.0698 38.1854 40.0766 38.6055 39.3411 39.3411C38.6055 40.0766 38.1854 41.0698 38.1699 42.1099V57.2899C38.1421 57.9591 38.2978 58.6232 38.6204 59.2102C38.943 59.7972 39.4201 60.2847 39.9999 60.6199C40.6483 60.9807 41.378 61.17 42.1199 61.17C42.8619 61.17 43.5916 60.9807 44.2399 60.6199C44.8164 60.2817 45.2903 59.7933 45.6108 59.2068C45.9314 58.6203 46.0866 57.9578 46.0599 57.2899C46.0696 57.2102 46.0696 57.1296 46.0599 57.0499C45.9061 56.463 45.9122 55.8456 46.0775 55.2618C46.2428 54.678 46.5613 54.1491 46.9999 53.7299C47.3999 53.4799 47.9399 53.6199 48.5999 54.1299L53.6699 59.1999C54.1203 59.6948 54.698 60.0563 55.34 60.245C55.9819 60.4337 56.6634 60.4423 57.3099 60.2699C58.0249 60.0684 58.6762 59.6868 59.2015 59.1615C59.7268 58.6362 60.1084 57.9849 60.3099 57.2699C60.4812 56.6233 60.472 55.9422 60.2834 55.3005C60.0948 54.6587 59.7339 54.081 59.2399 53.6299C58.7899 53.0999 58.0099 52.3099 56.7299 51.0299L54.1599 48.4699C53.9552 48.2705 53.816 48.0135 53.7606 47.7332C53.7053 47.4528 53.7364 47.1622 53.8499 46.8999C53.9505 46.6602 54.1162 46.4535 54.3283 46.3032C54.5404 46.153 54.7904 46.0652 55.0499 46.0499V46.0499ZM52.3099 50.2699L57.4599 55.4199C57.6346 55.5626 57.7644 55.7527 57.8336 55.9673C57.9028 56.182 57.9085 56.4121 57.8499 56.6299C57.7634 56.9183 57.6066 57.1808 57.3937 57.3937C57.1808 57.6066 56.9183 57.7634 56.6299 57.8499C56.4097 57.9081 56.1773 57.9014 55.9608 57.8304C55.7443 57.7594 55.553 57.6273 55.4099 57.4499L50.2699 52.3099L50.1699 52.2199C48.0099 50.4799 46.2899 51.2199 45.6499 51.5999C43.9999 52.5999 43.1099 55.0999 43.5499 57.4299C43.5481 57.6326 43.4937 57.8313 43.3921 58.0066C43.2904 58.1819 43.1449 58.3277 42.9699 58.4299C42.7057 58.5726 42.4102 58.6473 42.1099 58.6473C41.8097 58.6473 41.5141 58.5726 41.2499 58.4299C41.0522 58.315 40.8922 58.1452 40.7892 57.941C40.6862 57.7369 40.6448 57.5072 40.6699 57.2799V42.1099C40.6686 41.9204 40.7049 41.7326 40.7768 41.5573C40.8487 41.382 40.9548 41.2227 41.0887 41.0887C41.2227 40.9547 41.382 40.8487 41.5573 40.7768C41.7326 40.7049 41.9205 40.6686 42.1099 40.6699H57.3099C57.5007 40.6699 57.6896 40.7078 57.8657 40.7814C58.0417 40.855 58.2013 40.9629 58.3353 41.0987C58.4693 41.2346 58.5749 41.3957 58.6461 41.5727C58.7173 41.7497 58.7526 41.9391 58.7499 42.1299C58.7704 42.2937 58.7532 42.4599 58.6994 42.6159C58.6457 42.7719 58.5569 42.9136 58.4399 43.0299C57.464 43.595 56.3139 43.7802 55.2099 43.5499H55.0999C54.3216 43.5503 53.5608 43.7813 52.9135 44.2136C52.2662 44.6459 51.7615 45.2603 51.4631 45.9792C51.1646 46.698 51.0858 47.4892 51.2365 48.2528C51.3872 49.0165 51.7607 49.7184 52.3099 50.2699Z"
                  fill="black"
                />
                <path
                  d="M6.62993 25.83H21.8899C22.9301 25.8145 23.9232 25.3945 24.6588 24.6589C25.3944 23.9233 25.8144 22.9302 25.8299 21.89V6.69004C25.8299 5.64854 25.4176 4.6494 24.683 3.91108C23.9484 3.17276 22.9514 2.75532 21.9099 2.75004C21.3953 2.72292 20.881 2.80816 20.4026 2.99985C19.9243 3.19153 19.4934 3.48506 19.1399 3.86004C17.9099 5.19004 17.8099 7.35004 17.9999 9.00004C17.9965 9.27791 17.9099 9.54839 17.7513 9.77656C17.5926 10.0047 17.3692 10.1801 17.1099 10.28C16.8477 10.3936 16.5571 10.4247 16.2767 10.3693C15.9963 10.314 15.7394 10.1747 15.5399 9.97004L10.3699 4.80004C9.91956 4.30518 9.34183 3.94364 8.69987 3.75493C8.05792 3.56622 7.37644 3.55761 6.72993 3.73004C6.01493 3.93154 5.36363 4.3132 4.83836 4.83847C4.31309 5.36374 3.93143 6.01504 3.72993 6.73004C3.5604 7.3735 3.56852 8.05089 3.75342 8.6901C3.93832 9.32931 4.29307 9.90643 4.77993 10.36L7.34993 12.92C8.59993 14.18 9.34993 14.92 9.85993 15.37C10.4099 16.05 10.5499 16.61 10.2999 17.02C9.88685 17.4623 9.36323 17.7863 8.78312 17.9585C8.20301 18.1308 7.58742 18.1451 6.99993 18C6.92022 17.9904 6.83964 17.9904 6.75993 18H6.64993C5.99192 17.9832 5.34144 18.1432 4.7663 18.4633C4.19116 18.7834 3.7124 19.252 3.37993 19.82C3.01638 20.4675 2.82544 21.1975 2.82544 21.94C2.82544 22.6826 3.01638 23.4126 3.37993 24.06C3.71628 24.6165 4.19444 25.0737 4.76549 25.3847C5.33654 25.6957 5.97997 25.8494 6.62993 25.83V25.83ZM5.53993 21C5.64211 20.825 5.78799 20.6796 5.96329 20.5779C6.13859 20.4762 6.33729 20.4218 6.53993 20.42C8.86993 20.86 11.3599 19.97 12.3699 18.32C12.7599 17.68 13.4899 15.96 11.7499 13.8L11.6599 13.69L6.53993 8.58004C6.36521 8.4374 6.23544 8.2473 6.16625 8.03263C6.09705 7.81795 6.09139 7.58786 6.14993 7.37004C6.23485 7.08079 6.39107 6.8175 6.60423 6.60434C6.81739 6.39118 7.08068 6.23496 7.36993 6.15004C7.59019 6.09182 7.8226 6.09861 8.03909 6.16959C8.25558 6.24057 8.44689 6.3727 8.58993 6.55004L13.7299 11.69C14.2815 12.2392 14.9834 12.6128 15.747 12.7635C16.5107 12.9142 17.3018 12.8354 18.0207 12.5369C18.7396 12.2384 19.3539 11.7337 19.7863 11.0865C20.2186 10.4392 20.4495 9.6784 20.4499 8.90004V8.79004C20.2287 7.68238 20.4246 6.53205 20.9999 5.56004C21.1137 5.44527 21.2519 5.35776 21.4044 5.30407C21.5568 5.25038 21.7194 5.23191 21.8799 5.25004C22.0717 5.24739 22.262 5.28254 22.4402 5.35348C22.6183 5.42442 22.7808 5.52976 22.9182 5.66348C23.0556 5.7972 23.1654 5.95668 23.2412 6.13282C23.317 6.30896 23.3573 6.4983 23.3599 6.69004V21.89C23.3613 22.0795 23.3249 22.2674 23.253 22.4427C23.1811 22.618 23.0751 22.7773 22.9411 22.9112C22.8071 23.0452 22.6479 23.1512 22.4726 23.2231C22.2972 23.295 22.1094 23.3314 21.9199 23.33H6.66993C6.44587 23.3512 6.22045 23.3078 6.02023 23.205C5.82002 23.1023 5.65336 22.9444 5.53993 22.75C5.39198 22.4821 5.31437 22.1811 5.31437 21.875C5.31437 21.569 5.39198 21.2679 5.53993 21Z"
                  fill="black"
                />
                <path
                  d="M42.11 25.83H57.31C58.3515 25.83 59.3507 25.4176 60.089 24.6831C60.8273 23.9485 61.2448 22.9515 61.25 21.91C61.2745 21.3957 61.188 20.8821 60.9965 20.4042C60.805 19.9262 60.5129 19.4951 60.14 19.14C58.81 17.91 56.65 17.81 55.05 17.95C54.7722 17.9466 54.5017 17.86 54.2735 17.7013C54.0454 17.5427 53.87 17.3193 53.77 17.06C53.6565 16.7977 53.6254 16.5071 53.6807 16.2267C53.7361 15.9464 53.8753 15.6894 54.08 15.49L56.65 12.93C57.93 11.65 58.71 10.86 59.16 10.33C59.6549 9.87961 60.0164 9.30188 60.2051 8.65992C60.3939 8.01797 60.4025 7.33649 60.23 6.68998C60.0285 5.97498 59.6469 5.32368 59.1216 4.79841C58.5963 4.27314 57.945 3.89148 57.23 3.68998C56.5866 3.52045 55.9092 3.52857 55.27 3.71347C54.6308 3.89837 54.0536 4.25312 53.6 4.73997L48.56 9.86998C47.9 10.38 47.36 10.52 46.96 10.27C46.5264 9.85761 46.2093 9.3381 46.0408 8.76394C45.8722 8.18978 45.8581 7.5813 46 6.99998C46.0097 6.92027 46.0097 6.83969 46 6.75998C46.0267 6.09213 45.8715 5.42958 45.5509 4.84308C45.2304 4.25658 44.7566 3.76816 44.18 3.42998C43.5326 3.06643 42.8026 2.87549 42.06 2.87549C41.3175 2.87549 40.5875 3.06643 39.94 3.42998C39.3644 3.76407 38.8907 4.24881 38.57 4.83204C38.2493 5.41527 38.0938 6.07491 38.12 6.73997V21.94C38.1486 22.9799 38.5813 23.9678 39.3262 24.6941C40.0711 25.4203 41.0697 25.8278 42.11 25.83ZM40.67 6.66998C40.6464 6.44563 40.6886 6.21924 40.7916 6.01854C40.8947 5.81784 41.054 5.65153 41.25 5.53997C41.5138 5.396 41.8095 5.32036 42.11 5.31998C42.4107 5.31907 42.7067 5.39478 42.97 5.53997C43.145 5.64216 43.2905 5.78804 43.3922 5.96334C43.4938 6.13864 43.5482 6.33733 43.55 6.53997C43.11 8.86997 44 11.36 45.65 12.37C46.29 12.76 48.01 13.49 50.17 11.75L50.27 11.66L55.42 6.50998C55.5627 6.33526 55.7528 6.20549 55.9674 6.13629C56.1821 6.0671 56.4122 6.06143 56.63 6.11997C56.9185 6.20653 57.1809 6.3633 57.3938 6.57622C57.6067 6.78914 57.7635 7.05157 57.85 7.33998C57.9084 7.56114 57.9007 7.79458 57.8279 8.01142C57.755 8.22825 57.6202 8.41897 57.44 8.55998L52.31 13.7C51.7608 14.2515 51.3873 14.9534 51.2366 15.7171C51.0859 16.4807 51.1647 17.2719 51.4632 17.9907C51.7616 18.7096 52.2663 19.324 52.9136 19.7563C53.5609 20.1886 54.3217 20.4196 55.1 20.42H55.21C56.3141 20.1945 57.4625 20.3794 58.44 20.94C58.5587 21.0594 58.6483 21.2044 58.702 21.3639C58.7558 21.5234 58.7722 21.6931 58.75 21.86C58.75 22.2419 58.5983 22.6082 58.3283 22.8782C58.0582 23.1483 57.692 23.3 57.31 23.3H42.11C41.9206 23.3013 41.7327 23.265 41.5574 23.1931C41.3821 23.1212 41.2228 23.0152 41.0888 22.8812C40.9549 22.7472 40.8488 22.5879 40.7769 22.4126C40.7051 22.2373 40.6687 22.0495 40.67 21.86V6.66998Z"
                  fill="black"
                />
              </svg>
            </div>
          </div>
        </div>
      </header>
      <main class="modal-body">
        <slot />
      </main>
      <footer v-if="showFooter" class="modal-footer">
        <slot name="footer" />
      </footer>
    </div>
  </div>
</template>

<script>
export default {
  name: 'NLModal',
  props: {
    show: { type: [Boolean, Array, Object], required: true },
    defaultMode: { type: Boolean, default: false }
  },
  data () {
    return {
      isExpanded: false,
      isReduced: false,
      showFooter: false
    }
  },
  computed: {
    isOpen () {
      return this.show
    }
  },
  watch: {
    show () {
      if (!this.show) {
        window.removeEventListener('keyup', this.close)
      } else {
        window.addEventListener('keyup', this.close)
      }
    }
  },
  created () {
    this.setShowSlots()
    this.isExpanded = this.defaultMode
  },
  beforeUpdate () {
    this.setShowSlots()
  },
  methods: {
    close (e, close = false) {
      if (e?.key === 'Escape' || close) {
        this.$emit('close')
      }
    },
    setShowSlots () {
      this.showFooter = this.$slots.footer
    },
    handleExpansion () {
      this.isExpanded = !this.isExpanded
    },
    handleReduce () {
      this.isReduced = !this.isReduced
    }
  }
}
</script>
